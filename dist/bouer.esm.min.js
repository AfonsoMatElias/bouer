/*!
 * Bouer.js v3.0.0
 * Copyright Easy.js 2018-2020 | 2021-2021 Afonso Matumona
 * Released under the MIT License.
 */
function e(e,t){return fetch(e,t)}function t(e,t,r){for(var n="01234567890ABCDEFGHIJKLMNOPQRSTUVWXYZ",o=!1,i="",a=0;a<(e||8);a++){var s=Math.floor(Math.random()*n.length);i+=o?n[s].toLowerCase():n[s],o=!o}return(t||"")+i+(r||"")}function r(e){return void 0===e||null==e}function n(e){return"object"==typeof e&&"[object Object]"===String(e)}function o(e){return void 0!==e&&"string"==typeof e}function i(e){return!e||!n(e)||0===Object.keys(e).length}function a(e){return"function"==typeof e}function s(e){return e?e.trim():e}function u(e,t){return e.substr(0,t.length)===t}function l(e){return e.toLowerCase()}function c(e){return function(e){return"string"==typeof e||"number"==typeof e||"symbol"==typeof e||"boolean"==typeof e}(e)?String(e):n(e)?JSON.stringify(e):a(e.toString)?e.toString():String(e)}function f(e,t,r){return Object.defineProperty(e,t,r),e}function d(e,t,r){f(e,r,p(t,r))}function p(e,t){return Object.getOwnPropertyDescriptor(e,t)}function h(e,t,n){void 0===n&&(n=!1);var o=null;if(!e)return null;for(var i=0,a=t;i<a.length;i++){var s=a[i];if(o=e.attributes[s])break}return!r(o)&&n&&e.removeAttribute(o.name),o}function v(e,t,r){for(var n=0;n<e.length;n++)a(t)&&t.call(r,e[n],n)}function m(e,t,r){for(var n=[],o=0;o<e.length;o++){var i=e[o];a(t)&&t.call(r,i,o)&&n.push(i)}return n}function y(e){return e?[].slice.call(e):[]}function b(e,t){var r=E.createElement(e);a(t)&&t(r,E);var n={appendTo:function(e){return e.appendChild(r),n},build:function(){return r}};return n}function g(e,t){var r=E.createElement(e);a(t)&&t(r,E);var n={appendTo:function(e){return e.appendChild(r),n},build:function(){return r}};return n}function N(e,t){v(Object.keys(e),(function(r){var o=e[r];if(r in t)return n(o)?N(o,t[r]):t[r]=o;d(t,e,r)}))}function w(e){var t=e;"documentMode"in E&&(O.setAttribute("href",t),t=O.href),O.setAttribute("href",t);var r=O.hostname;!("[::1]"===O.hostname)&&r.indexOf(":")>-1&&(r="["+r+"]");var n={href:O.href,baseURI:O.baseURI,protocol:O.protocol?O.protocol.replace(/:$/,""):"",host:O.host,search:O.search?O.search.replace(/^\?/,""):"",hash:O.hash?O.hash.replace(/^#/,""):"",hostname:r,port:O.port,pathname:"/"===O.pathname.charAt(0)?O.pathname:"/"+O.pathname,origin:""};return n.origin=n.protocol+"://"+n.host,n}function x(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=e.split(/\/\//),o=n.length>1?n[0]+"//":"",i=""===o?n[0]:n[1],a=i.split(/\//),u=[];return v(a,(function(e){return s(e)?u.push(e):null})),v(t,(function(e){return v(e.split(/\//),(function(e){return s(e)?u.push(e):null}))})),o+u.join("/")}function A(e,t){return e.stack="",e}function k(e,t){return f(e,"isConnected",{get:function(){return t.isConnected}}),e}var E=document,C=globalThis,O=g("a").build(),R=setInterval,j={ignore:"e-ignore",build:"e-build",array:"e-array",if:"e-if",elseif:"e-else-if",else:"e-else",show:"e-show",req:"e-req",tmp:"e-tmp",fill:"e-fill",for:"e-for",use:"e-use",id:"e-id",order:"e-order",filter:"e-filter",data:"data",def:"e-def",wait:"wait-data",toggle:"e-toggle",content:"e-content",bind:"e-bind",property:"e-",anm:"e-anm",skeleton:"e-skeleton",route:"route-view",href:":href",ihref:"!href",entry:"e-entry",component:":name",on:"on:",tagContent:"content",ref:"ref",put:"put",connector:"connector",builtInEvents:{add:"add",compile:"compile",request:"request",response:"response",fail:"fail",done:"done"},check:function(e,t){return u(e.nodeName,t)},isConstant:function(e){var t=this;return-1!==Object.keys(this).map((function(e){return t[e]})).indexOf(e)}},T=function(){function e(){}return e.Register=function(e){this.container[e.__proto__.constructor.name]=e},e.Resolve=function(e){return this.container[e]},e.Dispose=function(e){delete this.container[e]},e.container={},e}(),V=function(){function e(){}return e.observe=function(e,t){var r=new MutationObserver((function(n){t({element:e,mutation:r,records:n})}));r.observe(e,{childList:!0})},e}();function D(e,t,r){if(r||2===arguments.length)for(var n,o=0,i=t.length;o<i;o++)!n&&o in t||(n||(n=Array.prototype.slice.call(t,0,o)),n[o]=t[o]);return e.concat(n||Array.prototype.slice.call(t))}var I=function(){function e(){}return e.log=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];console.log.apply(console,D([e.prefix],t,!1))},e.error=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];console.error.apply(console,D([e.prefix],t,!1))},e.warn=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];console.warn.apply(console,D([e.prefix],t,!1))},e.info=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];console.info.apply(console,D([e.prefix],t,!1))},e.prefix="[Bouer]",e}(),L=function(){function e(){}return e.on=function(t,r){return this[t].push(r),{eventName:t,callback:r,off:function(){return e.off(t,r)}}},e.off=function(e,t){var r=this[e];return r.splice(r.indexOf(t),1),!0},e.once=function(t,r){var n={},o=e.on(t,(function(e,t,r){n.onemit&&n.onemit(e)}));try{r(n)}catch(e){I.error(A(e))}finally{e.off(t,o.callback)}},e.emit=function(e,t){try{v(this[e],(function(e){return e(t)}))}catch(e){I.error(A(e))}},e.BeforeGet=[],e.AfterGet=[],e.BeforeSet=[],e.AfterSet=[],e}(),S=function(){function e(e){this.binds=[],this.DEFAULT_BINDER_PROPERTIES={text:"value",number:"valueAsNumber",checkbox:"checked",radio:"checked"},this.BindingDirection={fromInputToData:"to-data-property",fromDataToInput:"to-input"},T.Register(this),this.evaluator=T.Resolve("Evaluator"),this.bouer=e,this.cleanup()}return e.prototype.create=function(e){var t,o=this,i=e.node,u=e.data,l=e.fields,f=e.replaceProperty,d=s(null!==(t=i.nodeValue)&&void 0!==t?t:""),p=i.nodeName,h=i.ownerElement||i.parentNode,m=e.onChange||function(e,t){},b={node:i,data:u,nodeName:p,nodeValue:d,fields:e.fields,parent:h,value:""};if(p.substr(0,j.bind.length)===j.bind){var N="";if(j.bind===p){var w=h.type||h.localName;N=this.DEFAULT_BINDER_PROPERTIES[w]||"value"}else N=p.split(":")[1];var x,A,k,E=h instanceof HTMLSelectElement,C=E&&!0===h.multiple,O=d.split("|").map((function(e){return s(e)})),R=O[0],V=function(e,t){if(!(k=O[1])){var i=s(h.getAttribute("value"));i&&(k="'"+i+"'")}if(E&&!C&&Array.isArray(x)&&!k)return I.error("Since it's a <select> array binding, it expects the \u201cmultiple\u201d attribute in order to bind the multi values.");if(!C&&Array.isArray(x)&&!k)return I.error("Since it's an array binding it expects a model but it has not been defined, provide a model as it follows "+p+'="'+R+' | Model" or value="String-Model".');switch(e){case o.BindingDirection.fromDataToInput:if(Array.isArray(x)){if(C)return v(y(h.options),(function(e){e.selected=-1!==x.indexOf(s(e.value))}));if(-1===x.indexOf(A))switch(typeof h[N]){case"boolean":h[N]=!1;break;case"number":h[N]=0;break;default:h[N]=""}return}return h[N]=n(t)?c(t):r(t)?"":t;case o.BindingDirection.fromInputToData:if(Array.isArray(x)){if(C){var a=[];return v(y(h.options),(function(e){!0===e.selected&&a.push(s(e.value))})),x.splice(0,x.length),x.push.apply(x,a)}return A=A||o.evaluator.exec({data:u,expression:k}),void(t?x.push(A):x.splice(x.indexOf(A),1))}return u[R]=t}},D=L.on("AfterGet",(function(e){o.binds.push(e.watch((function(e){V(o.BindingDirection.fromDataToInput,e),m(e,i)}),i))})),S=x=this.evaluator.exec({expression:R,data:u});D.off(),V(this.BindingDirection.fromDataToInput,S);var H=[h.nodeName.toLowerCase(),"propertychange","change"],M=function(){V(o.BindingDirection.fromInputToData,h[N])};return v(H,(function(e){"change"===e&&"select"!==h.localName||h.addEventListener(e,M,!1)})),h.removeAttribute(i.nodeName),b}var q=i;p.substr(0,j.property.length)===j.property&&r(f)&&(b.nodeName=p.substr(j.property.length),h.setAttribute(b.nodeName,d),q=h.attributes[b.nodeName],h.removeAttribute(i.nodeName));var _=function(){var e=b.nodeValue,t=!1;if(v(l,(function(n){var s=n.delimiter;s&&"html"===s.name&&(t=!0);var l=o.evaluator.exec({expression:n.expression,data:u});l=r(l)?"":l,e=e.replace(n.field,c(l)),s&&a(s.action)&&(e=s.action(e,i,u))})),b.value=e,t){var n=g("div",(function(t){t.innerHTML=e})).build().children[0];h.appendChild(n),T.Resolve("Compiler").compile({el:n,data:u})}else q.nodeValue=e};return L.once("AfterGet",(function(e){e.onemit=function(e){o.binds.push(e.watch((function(e){_(),m(e,i)}),i))},_()})),b.node=q,b},e.prototype.watch=function(e,t,r){var n=null,o=r||this.bouer.data;return L.once("AfterGet",(function(r){r.onemit=function(e){return n=e.watch(t)},o[e]})),n},e.prototype.cleanup=function(){var e=this;R((function(){e.binds=m(e.binds,(function(e){return!e.node||(!!e.node.isConnected||void e.destroy())}))}),1e3)},e}(),H=function(){function e(e){T.Register(this),this.bouer=e}return e.prototype.create=function(e){var r=E.createComment("e");return r.id=e||t(8),r},e.prototype.get=function(e,t){if(!r(e))return t=t||this.bouer.el,this.retrieve(t).find((function(t){return t.id===e}))},e.prototype.retrieve=function(e){if(!e)return[];for(var t,r=E.createNodeIterator(e,NodeFilter.SHOW_COMMENT,(function(){return NodeFilter.FILTER_ACCEPT})),n=[];t=r.nextNode();)"id"in t&&n.push(t);return n},e}(),M=function(){function e(){}return e.obj=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n={};return v(e,(function(e){r(e)||v(Object.keys(e),(function(t){r(e[t])||d(n,e,t)}))})),n},e.addToObj=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return v(t,(function(t){r(t)||v(Object.keys(t),(function(n){r(t[n])||d(e,t,n)}))})),e},e.array=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=[];return v(e,(function(e){if(!r(e))return Array.isArray(e)?void v(Object.keys(e),(function(t){var o=e[t];r(o)||(Array.isArray(o)?[].push.apply(n,o):n.push(o))})):n.push(e)})),n},e}(),q=function(e,t,r){var n=this;this.destroy=function(){var e=n.reactive.watches.indexOf(n);-1!==e&&n.reactive.watches.splice(e,1),n.onDestroy&&n.onDestroy()},this.reactive=e,this.property=e.propertyName,this.callback=t,r&&(this.node=r.node,this.onDestroy=r.onDestroy)},_=function(){function e(t){var o=this;if(this.watches=[],this.get=function(){L.emit("BeforeGet",o),o.propertyValue=o.isComputed?o.computedGetter():o.propertyValue;var e=o.propertyValue;return L.emit("AfterGet",o),e},this.set=function(t){var i=o.propertyValue;if(i!==t){if(L.emit("BeforeSet",o),n(t)||Array.isArray(t)){if(typeof o.propertyValue!=typeof t)return I.error("Cannot set \u201c"+typeof t+"\u201d in \u201c"+o.propertyName+"\u201d property.");if(Array.isArray(t)){e.transform(t,o);var a=o.propertyValue;a.splice(0,a.length),a.push.apply(a,t)}else n(t)&&(t instanceof Node?o.propertyValue=t:(e.transform(t),r(o.propertyValue)?o.propertyValue=t:N(t,o.propertyValue)))}else o.propertyValue=t;o.isComputed&&o.computedSetter&&o.computedSetter(t),L.emit("AfterSet",o),v(o.watches,(function(e){return e.callback(o.propertyValue,i)}))}},this.propertyName=t.propertyName,this.propertySource=t.sourceObject,this.propertyDescriptor=p(this.propertySource,this.propertyName),this.propertyValue=this.propertyDescriptor.value,this.isComputed="function"==typeof this.propertyValue&&"$computed"===this.propertyValue.name,this.isComputed){var i=this.propertyValue.call(T.Resolve("Bouer"));if(("get"in i||a(i))&&(this.computedGetter=i.get||i),"set"in i&&(this.computedSetter=i.set),!this.computedGetter)throw new Error("Computed property must be a function \u201cfunction $computed(){...}\u201d that returns a function for \u201cgetter only\u201d or an object with a \u201cget\u201d and/or \u201cset\u201d function");this.propertyValue=void 0}}var t;return e.prototype.watch=function(e,t){var r=new q(this,e,{node:t});return this.watches.push(r),r},e.setData=function(t,r){return n(t)?n(r)&&null!==r?I.error('Invalid targetObject value, expected an "Object Literal" and got "'+typeof r+'".'):(e.transform(t),v(Object.keys(t),(function(e){return d(r,t,e)})),r):I.error('Invalid inputData value, expected an "Object Literal" and got "'+typeof t+'".')},t=e,e.transform=function(o,i){if(Array.isArray(o)){if(null==i)return I.warn("Cannot transform this array to a reactive one because no reactive objecto was provided"),o;var a=o,s={},u=a.__proto__=Object.create(Array.prototype);return v(["push","pop","unshift","shift","splice"],(function(t){s[t]=a[t].bind(a),u[t]=function(){var r=a.slice();switch(t){case"push":case"unshift":v(y(arguments),(function(t){(n(t)||Array.isArray(t))&&e.transform(t)}))}var o=s[t].apply(a,arguments);return v(i.watches,(function(e){return e.callback(a,r)})),o}})),a}return n(o)?(v(Object.keys(o),(function(i){var a=o;if(!r(p(o,i).value)){var s=new e({propertyName:i,sourceObject:o});f(o,i,s);var u=a[i];n(u)?t.transform(u):Array.isArray(u)&&(t.transform(u,s),v(u,(function(e){return t.transform(e)})))}})),o):o},e}(),P=function(){function e(){this.wait={},this.data={},this.req={},T.Register(this)}return e.set=function(t,r,n){if("wait"===t)return I.warn("Only \u201cget\u201d is allowed for type of data");T.Resolve(e.name)[t][r]=n},e.get=function(t,r,n){var o=T.Resolve(e.name)[t][r];return!0===n&&e.unset(t,r),o},e.unset=function(t,r){delete T.Resolve(e.name)[t][r]},e}(),$=function(){function t(e,t){this.$custom={},this.errorMsgEmptyNode=function(e){return"Expected an expression in \u201c"+e.nodeName+"\u201d and got an <empty string>."},this.errorMsgNodeValue=function(e){var t;return"Expected an expression in \u201c"+e.nodeName+"\u201d and got \u201c"+(null!==(t=e.nodeValue)&&void 0!==t?t:"")+"\u201d."},this.compiler=t,this.bouer=t.bouer,this.$custom=e,this.evaluator=T.Resolve("Evaluator"),this.delimiter=T.Resolve("DelimiterHandler"),this.comment=T.Resolve("CommentHandler"),this.binder=T.Resolve("Binder"),this.eventHandler=T.Resolve("EventHandler")}return t.prototype.toOwnerNode=function(e){return e.ownerElement||e.parentNode},t.prototype.ignore=function(e){e.nodeValue="true"},t.prototype.if=function(e,t){var r,n,o=this,i=this.toOwnerNode(e),a=i.parentElement;if(a){var u=[],l=this.comment.create(),c=e.nodeName,f=function(){};if(c!==j.elseif&&c!==j.else){var d=i,p=[],m=function(){if(null==d)return"break";var e=h(d,["e-if","e-else-if","e-else"]);return e?"e-else"!==e.nodeName&&""===s(null!==(r=e.nodeValue)&&void 0!==r?r:"")?{value:I.error(y.errorMsgEmptyNode(e))}:0!==y.delimiter.run(null!==(n=e.nodeValue)&&void 0!==n?n:"").length?{value:I.error(y.errorMsgNodeValue(e))}:(u.push({node:e,element:d}),k(d,a),k(e,a),"e-else"===e.nodeName?(d.removeAttribute(e.nodeName),"break"):(L.once("AfterGet",(function(r){r.onemit=function(t){-1===p.findIndex((function(e){return e.reactive.propertyName==t.propertyName}))&&p.push({attr:e,reactive:t})},o.evaluator.exec({data:t,expression:e.value})})),void d.removeAttribute(e.nodeName))):"break"},y=this;do{var b=m();if("object"==typeof b)return b.value;if("break"===b)break}while(d=d.nextElementSibling);v(p,(function(e){return o.binder.binds.push(e.reactive.watch((function(){return f()}),e.attr))})),(f=function(){v(u,(function(e){e.element.parentElement&&(l.isConnected?a.removeChild(e.element):a.replaceChild(l,e.element))}));var e=u.map((function(e,t){var r=e.node.value;switch(e.node.name){case j.if:return"if("+r+"){ _cb("+t+"); }";case j.elseif:return"else if("+r+"){ _cb("+t+"); }";case j.else:return"else{ _cb("+t+"); }"}})).join(" ");o.evaluator.exec({data:t,isReturn:!1,expression:e,aditional:{_cb:function(e){var r=u[e].element;a.replaceChild(r,l),o.compiler.compile({el:r,data:t})}}})})()}}},t.prototype.show=function(e,t){var r,n=this,o=this.toOwnerNode(e),i=s(null!==(r=e.nodeValue)&&void 0!==r?r:"");if(""===i)return I.error(this.errorMsgEmptyNode(e));if(0!==this.delimiter.run(i).length)return I.error(this.errorMsgNodeValue(e));var a=function(e){var r=n.evaluator.exec({expression:i,data:t});e.style.display=r?"":"none"};k(e,o);var u=this.binder.create({data:t,node:e,fields:[{expression:i,field:i}],onChange:function(){return a(o)}});a(o),o.removeAttribute(u.node.nodeName)},t.prototype.for=function(e,t){var n,o=this,i=this.toOwnerNode(e),a=i.parentElement;if(a){var u=this.comment.create(),l=e.nodeName,f=s(null!==(n=e.nodeValue)&&void 0!==n?n:""),d=[],p=function(){};if(""===f)return I.error(this.errorMsgEmptyNode(e));if(!f.includes(" of ")&&!f.includes(" in "))return I.error("Expected a valid \u201cfor\u201d expression in \u201c"+l+"\u201d and got \u201c"+f+'\u201d.\nValid: e-for="item of items".');var h=this.delimiter.run(f);0!==h.length&&this.binder.create({data:t,fields:h,replaceProperty:!0,node:e,onChange:function(){return p()}}),i.removeAttribute(l);var m=i.cloneNode(!0);a.replaceChild(u,i),k(m,u),k(e,u);var y=function(e){var r=e.split("|").map((function(e){return s(e)})),n=r[0].replace(/\(|\)/g,"");r.shift();var i=" of ",a=n.split(i);a.length>1||(a=n.split(i=" in "));var u=a[0],l=a[1],c=u.split(",").map((function(e){return s(e)})),f="of"===s(i)?l:"Object.keys("+l+")";return{filters:r,type:i,leftHand:u,rightHand:l,sourceValue:o.evaluator.exec({data:t,expression:l}),leftHandParts:c,iterableExpression:f,isForOf:"of"===s(i)}},b=L.on("AfterGet",(function(t){return o.binder.binds.push(t.watch((function(){return p()}),e))})),g=y(f);b.off(),(p=function(){var n,i=(g=g||y(s(null!==(n=e.nodeValue)&&void 0!==n?n:""))).iterableExpression,p=g.leftHandParts,h=g.sourceValue,b=g.isForOf,N=g.filters;v(d,(function(e){e.parentElement&&a.removeChild(e)})),d=[],o.evaluator.exec({data:t,isReturn:!1,expression:"_for(_filters("+i+"), ($$itm, $$idx) => { _each($$itm, $$idx); })",aditional:{_for:v,_each:function(e,r){var n=M.obj(t),i=p[0],s=p[1]||"_index_or_value",l=p[2]||"_for_in_index";n[i]=e,n[s]=b?r:h[e],n[l]=r;var c=a.insertBefore(m.cloneNode(!0),u);o.compiler.compile({el:c,data:n,onDone:function(e){return o.eventHandler.emit({eventName:"add",attachedNode:e,once:!0})}}),d.push(c)},_filters:function(e){var n=M.array(e),i=function(e){return N.find((function(t){return t.substr(0,e.length)===e}))},a=i("filter");if(a){var u=a.split(":").map((function(e){return s(e)}));1==u.length?I.error("Invalid \u201c"+l+"\u201d filter expression \u201c"+f+"\u201d, at least a filter-value and filter-keys, or a filter-function must be provided"):n=function(e,n){var i=n[1],a=n[2];if(r(i)||""===i)return I.error("Invalid filter-value in \u201c"+l+"\u201d with \u201c"+f+"\u201d expression."),e;if("function"==typeof(i=o.evaluator.exec({data:t,expression:i})))e=i(e);else{if(r(a)||""===a)return I.error("Invalid filter-keys in \u201c"+l+"\u201d with \u201c"+f+"\u201d expression, at least one filter-key to be provided."),e;var u=[];v(e,(function(e){for(var t=0,r=a.split(",").map((function(e){return s(e)}));t<r.length;t++){var n=r[t];if(!c(o.evaluator.exec({data:e,expression:n})).includes(i))break;u.push(e)}})),e=u}return e}(n,u)}var d=i("order");if(d){var p=d.split(":").map((function(e){return s(e)}));1==p.length?I.error("Invalid \u201c"+l+"\u201d order  expression \u201c"+f+"\u201d, at least the order type must be provided"):n=function(e,t,n){return t||(t="asc"),e.sort((function(e,o){var i=function(e,n){if(r(e)||r(n))return 0;switch(t.toLowerCase()){case"asc":return e?1:-1;case"desc":return n?-1:1;default:return I.log("The \u201c"+t+"\u201d order type is invalid: \u201c"+f+"\u201d. Available types are: \u201casc\u201d  for order ascendent and \u201cdesc\u201d for order descendent."),0}};return n?i(e[n]>o[n],o[n]<e[n]):i(e>o,o<e)}))}(n,p[1],p[2])}return n}}}),g=null})()}},t.prototype.def=function(e,t){var r,o=this.toOwnerNode(e),i=s(null!==(r=e.nodeValue)&&void 0!==r?r:"");if(""===i)return I.error(this.errorMsgEmptyNode(e));if(0!==this.delimiter.run(i).length)return I.error(this.errorMsgNodeValue(e));var a=this.evaluator.exec({data:t,expression:i});if(!n(a))return I.error("Expected a valid Object Literal expression in \u201c"+e.nodeName+"\u201d and got \u201c"+i+"\u201d.");this.bouer.setData(a,t),o.removeAttribute(e.nodeName)},t.prototype.content=function(e){var t,r=this.toOwnerNode(e),n=s(null!==(t=e.nodeValue)&&void 0!==t?t:"");if(""===n)return I.error(this.errorMsgEmptyNode(e));r.innerText=n,r.removeAttribute(e.nodeName)},t.prototype.bind=function(e,t){var r,n=this.toOwnerNode(e),o=s(null!==(r=e.nodeValue)&&void 0!==r?r:"");return""===o?I.error(this.errorMsgEmptyNode(e)):0!==this.delimiter.run(o).length?I.error(this.errorMsgNodeValue(e)):(this.binder.create({node:k(e,n),fields:[{field:o,expression:o}],data:t}),void n.removeAttribute(e.nodeName))},t.prototype.property=function(e,t){var r,o=this,i=this.toOwnerNode(e),a=s(null!==(r=e.nodeValue)&&void 0!==r?r:""),u=function(e){},l=function(e){var t;return"Invalid value, expected an Object/Object Literal in \u201c"+e.nodeName+"\u201d and got \u201c"+(null!==(t=e.nodeValue)&&void 0!==t?t:"")+"\u201d."};if(""===a)return I.error(l(e));if(0===this.delimiter.run(a).length){var c=this.evaluator.exec({data:t,expression:a});if(!n(c))return I.error(l(e));this.binder.create({data:t,node:k(e,i),replaceProperty:!1,fields:[{expression:a,field:a}],onChange:function(){return u(o.evaluator.exec({data:t,expression:a}))}}),i.removeAttribute(e.nodeName),(u=function(t){var r=e.nodeName.substr(j.property.length),n=i.attributes[r];if(n||(i.setAttribute(r,""),n=i.attributes[r]),v(Object.keys(t),(function(e){if(!t[e])return n.value=s(n.value.replace(e,""));n.value=n.value.includes(e)?n.value:s(n.value+" "+e)})),""===n.value)return i.removeAttribute(r)})(c)}},t.prototype.data=function(e,t){var r,o=this.toOwnerNode(e),i=s(null!==(r=e.nodeValue)&&void 0!==r?r:"");if(0!==this.delimiter.run(i).length)return I.error("The \u201cdata\u201d attribute cannot contain delimiter.");o.removeAttribute(e.nodeName);var a={},u=M.obj(t,{$this:t}),l=L.on("AfterGet",(function(e){a[e.propertyName]=void 0,f(a,e.propertyName,e)}));if(""===i)a=M.obj(this.bouer.data);else{var c=this.evaluator.exec({data:u,expression:i});if(!n(c))return I.error("Expected a valid Object Literal expression in \u201c"+e.nodeName+"\u201d and got \u201c"+i+"\u201d.");v(Object.keys(c),(function(e){e in a||(a[e]=c[e])}))}L.off("AfterGet",l.callback);var d=e.nodeName.split(":")[1];return d&&(d=d.replace(/\[|\]/g,""),P.set("data",d,a)),_.transform(a),this.compiler.compile({data:a,el:o})},t.prototype.href=function(e,t){var r,n,o=this.toOwnerNode(e),i=e.nodeName,a=s(null!==(r=e.nodeValue)&&void 0!==r?r:"");if(""===a)return I.error(this.errorMsgEmptyNode(e));o.removeAttribute(e.nodeName);var u=x(null===(n=(this.bouer.config||{}).usehash)||void 0===n||n?"#":"",a);o.setAttribute("href",u);var l=o.attributes.href,c=this.delimiter.run(a);0!==c.length&&this.binder.create({data:t,node:k(l,o),fields:c}),o.addEventListener("click",(function(e){e.preventDefault(),T.Resolve("Routing").navigate(l.value)}),!1),l.markable=":"===i[0]},t.prototype.entry=function(e,t){var r,n=this.toOwnerNode(e),o=s(null!==(r=e.nodeValue)&&void 0!==r?r:"");return""===o?I.error(this.errorMsgEmptyNode(e)):0!==this.delimiter.run(o).length?I.error(this.errorMsgNodeValue(e)):(n.removeAttribute(e.nodeName),void T.Resolve("ComponentHandler").prepare([{name:o,template:n.outerHTML,data:t}]))},t.prototype.put=function(e,t){var r,n=this.toOwnerNode(e),o=s(null!==(r=e.nodeValue)&&void 0!==r?r:""),i=function(){};if(""===o)return I.error(this.errorMsgEmptyNode(e),"Direct <empty string> injection value is allowed only with a delimiter.");var a=this.delimiter.run(o);n.removeAttribute(e.nodeName),0!==a.length&&this.binder.create({data:t,node:k(e,n),fields:a,onChange:function(){return i()}}),(i=function(){var r;if(n.innerHTML="",""!==(o=s(null!==(r=e.nodeValue)&&void 0!==r?r:""))){var i=b(o).appendTo(n).build();T.Resolve("ComponentHandler").order(i,t)}})()},t.prototype.req=function(t,r){var n,o=this,i=this.toOwnerNode(t),a=t.nodeName,u=s(null!==(n=t.nodeValue)&&void 0!==n?n:"");if(!u.includes(" of ")&&!u.includes(" as "))return I.error("Expected a valid \u201cfor\u201d expression in \u201c"+a+"\u201d and got \u201c"+u+'\u201d.\nValid: e-req="item of [url]".');u.includes(" of ")&&k(i,i.parentNode),k(t,i);var l=this.delimiter.run(u),c={},f=function(){};0!==l.length&&this.binder.create({data:r,node:t,fields:l,replaceProperty:!1,onChange:function(){return f()}}),i.removeAttribute(t.nodeName);var p=function(e){var t=i.attributes[j.on+e];return t&&o.eventHandler.handle(t,r),{emit:function(t){o.eventHandler.emit({attachedNode:i,eventName:e,init:{detail:t}})}}},h=T.Resolve("Interceptor"),v=p(j.builtInEvents.request),m=p(j.builtInEvents.response),y=p(j.builtInEvents.fail),b=p(j.builtInEvents.done);(f=function(){var n=(u=s(t.nodeValue||"")).split("|").map((function(e){return s(e)})),a=n[0].replace(/\(|\)/g,"");n.shift();var l=" of ",f=a.split(l);f.length>1||(f=a.split(l=" as "));var g=s(l),N=t.nodeName.split(":")[1];N=N?N.replace(/\[|\]/g,""):"",v.emit(),h.run("req",{http:e,type:g,path:f[1].replace(/\[|\]/g,""),success:function(e){var t;if(!e)return I.error("the \u201csuccess\u201d parameter must be an object containing \u201cdata\u201d property. Example: { data: {} | [] }");if(!("data"in e))return I.error("the \u201csuccess\u201d parameter must be contain the \u201cdata\u201d property. Example: { data: {} | [] }");if("of"===g&&!Array.isArray(e.data))return I.error('Using e-ref="... \u201cof\u201d ..." the response must be a list of items, and got \u201c'+typeof e.data+"\u201d.");if("as"===g&&"object"!=typeof e.data)return I.error('Using e-ref="... \u201cas\u201d ..." the response must be a list of items, and got \u201c'+typeof e.data+"\u201d.");if(_.transform(e),m.emit({response:e}),"data"in c)return c.data=e.data;switch(c.data=void 0,d(c,e,"data"),N&&P.set("req",N,e),g){case"as":var n=s(f[0].split(",")[0].replace(/\(|\)/g,""));return o.compiler.compile({el:i,data:M.obj((t={},t[n]=e.data,t),r),onDone:function(e,t){p(j.builtInEvents.compile).emit({data:t})}});case"of":var a=u.replace(f[1],"_response_");return i.setAttribute(j.for,a),o.compiler.compile({el:i,data:M.obj({_response_:e.data},r),onDone:function(e,t){p(j.builtInEvents.compile).emit({data:t})}})}},fail:function(e){return y.emit({error:e})},done:function(){return b.emit()}})})()},t.prototype.wait=function(e){var t,r=this,n=this.toOwnerNode(e),o=s(null!==(t=e.nodeValue)&&void 0!==t?t:"");if(""===o)return I.error(this.errorMsgEmptyNode(e));if(0!==this.delimiter.run(o).length)return I.error(this.errorMsgNodeValue(e));n.removeAttribute(e.nodeName);var i=T.Resolve("DataStore"),a=i.wait[o];if(a){if(a.nodes.push(n),!a.data)return;return v(a.nodes,(function(e){r.compiler.compile({el:e,data:_.transform(a.data)})}))}return i.wait[o]={nodes:[n]}},t.prototype.custom=function(e,t){var r,n,o,i=this.toOwnerNode(e),a=e.nodeName,u=s(null!==(r=e.nodeValue)&&void 0!==r?r:""),l=this.delimiter.run(u),c=this.$custom[a],f=this.binder.create({data:t,node:k(e,i),fields:l,replaceProperty:!1,onChange:function(){"function"==typeof c.updated&&c.updated(e,f)}});(null===(n=c.removable)||void 0===n||n)&&i.removeAttribute(a);var d=a.split(".");d.shift();var p=(a.split(":")[1]||"").split(".")[0];return f.modifiers=d,f.argument=p,"function"==typeof c.bind&&(null!==(o=c.bind(e,f))&&void 0!==o&&o)},t.prototype.skeleton=function(e){var t;""===s(null!==(t=e.nodeValue)&&void 0!==t?t:"")&&this.toOwnerNode(e).removeAttribute(e.nodeName)},t}(),B=function(){function e(e,t){this.NODES_TO_IGNORE_IN_COMPILATION={SCRIPT:1,"#comment":8},T.Register(this),this.bouer=e,this.binder=T.Resolve("Binder"),this.delimiter=T.Resolve("DelimiterHandler"),this.eventHandler=T.Resolve("EventHandler"),this.component=T.Resolve("ComponentHandler"),this.directive=new $(t.directives||{},this)}return e.prototype.compile=function(e){var t=this,r=e.el,n=e.data||this.bouer.data;if(this.analize(r.outerHTML)){var i=function(n,a){if(!(n.nodeName in t.NODES_TO_IGNORE_IN_COMPILATION)){if(n instanceof Element){if(j.ignore in n.attributes)return t.directive.ignore(n);if(n.localName===j.tagContent&&e.componentContent){var s=function(e,t){v(y(e.childNodes),(function(e){var n=e.cloneNode(!0);r.insertBefore(n,t),i(n,a)})),r.removeChild(t)};if(n.hasAttribute("default"))return s(e.componentContent,n);if(n.hasAttribute("target")){var l=n.attributes.target;return v(y(e.componentContent.children),(function(e){e.localName===j.tagContent&&e.getAttribute("target")!==l.value||s(e,n)}))}}if(j.def in n.attributes&&t.directive.def(n.attributes[j.def],a),j.entry in n.attributes&&t.directive.entry(n.attributes[j.entry],a),j.wait in n.attributes)return t.directive.wait(n.attributes[j.wait]);if(t.component.check(n.localName))return t.component.order(n,a);if(j.for in n.attributes)return t.directive.for(n.attributes[j.for],a);if(j.if in n.attributes)return t.directive.if(n.attributes[j.if],a);(j.elseif in n.attributes||j.else in n.attributes)&&I.warn('The "'+j.elseif+'" or "'+j.else+'" requires an element with "'+j.if+'" above.'),j.show in n.attributes&&t.directive.show(n.attributes[j.show],a);var c=null;if((c=n.attributes[j.req])||(c=y(n.attributes).find((function(e){return j.check(e,j.req)}))))return t.directive.req(c,a);var f;if(f=y(n.attributes).find((function(e){var t=e.name;return t===j.data||u(t,j.data+":")})))return t.directive.data(f,a);if(j.put in n.attributes)return t.directive.put(n.attributes[j.put],a);v(y(n.attributes),(function(e){i(e,a)}))}if(j.check(n,j.href)||j.check(n,j.ihref))return t.directive.href(n,a);if(j.check(n,j.content))return t.directive.content(n);if(j.check(n,j.bind))return t.directive.bind(n,a);if(!Object.keys(t.directive.$custom).find((function(e){return j.check(n,e)}))||!t.directive.custom(n,a)){if(j.check(n,j.property)&&!j.isConstant(n.nodeName)&&t.directive.property(n,a),j.check(n,j.skeleton)&&t.directive.skeleton(n),j.check(n,j.on))return t.eventHandler.handle(n,a);var d;o(n.nodeValue)&&(d=t.delimiter.run(n.nodeValue))&&0!==d.length&&t.binder.create({node:k(n,r),fields:d,data:a}),v(y(n.childNodes),(function(e){return i(e,a)}))}}};i(r,n),a(e.onDone)&&e.onDone.call(this.bouer,r)}},e.prototype.analize=function(e){return!0},e}(),F=function(){function e(e){T.Register(this),this.bouer=e}return e.prototype.htmlToJsObj=function(e,t,s){var u=void 0,l=this;if(e instanceof Element)u=e;else{if(n(e))return e;if(o(e))try{u=this.bouer.el.querySelector(e)}catch(t){return e}}if(r(u))throw I.error("Invalid element passed in app.toJsObj(...).");var c=((t=t||{}).names||"[name]").replace(/\[|\]/g,"").split(","),f=(t.values||"[value]").replace(/\[|\]/g,"").split(","),d=function(e,t){return t in e?e[t]:e.getAttribute(t)||e.innerText},p=function(e){var t={},r={BUTTON:!0},n={checkbox:!0,radio:!0};return function e(o){var i=h(o,c);if(i){var u=i.value;if(!0===r[o.tagName])return;if(o instanceof HTMLInputElement&&!0===n[o.type]&&!1===o.checked)return;var p=t[u],m=o.hasAttribute(j.array),b=function(e){var t=void 0;return f.find((function(r){return!!(t=d(e,r))})),t}(o);t[u]=m?p?M.array(p,b):[b]:p?M.array(p,b):b,a(s)&&s.call(l,t,u,b,o)}v(y(o.children),(function(t){h(t,[j.build])||e(t)}))}(e),t},m=p(u);return v(y(u.querySelectorAll("["+j.build+"]")),(function(e){var t=d(e,j.build),o=e.hasAttribute(j.array),u=p(e);(function(e){if(i(e))return!1;for(var t=!1,n=Object.keys(e),o=0;o<n.length;o++)if(!r(n[o])){t=!0;break}return t})(u)&&function t(c,f){var d=c.split("."),p=d[0];d.shift();var h=f[p];return r(h)&&(f[p]={}),0===d.length?(o?n(h)&&!i(h)?f[p]=[M.obj(h,u)]:Array.isArray(h)?h.push(u):f[p]=[u]:r(h)?f[p]=u:f[p]=M.obj(h,u),void(a(s)&&s.call(l,f,p,u,e))):Array.isArray(h)?v(h,(function(e){t(d.join("."),e)})):void t(d.join("."),f[p])}(t,m)})),m},e}(),G=function(){function e(e){this.url=e||E.location.href}return e.prototype.params=function(e){var t=this,r={};if(e&&o(e)){var n=this.url.split("?")[0].split("/").reverse();""===n[0]&&n.shift(),v(e.split("/").reverse(),(function(e,t){var o=RegExp("{([\\S\\s]*?)}").exec(e);Array.isArray(o)&&(r[o[1]]=n[t])}))}return function(){var e=t.url.split("?")[1];if(!e)return t;v(e.split("&"),(function(e){var t=e.split("=");r[t[0]]=(t[1]||"").split("#")[0]}))}(),r},e.prototype.add=function(e){var t=[];v(Object.keys(e),(function(r){t.push(r+"="+e[r])}));var r=t.join("&");return this.url.includes("?")?"&"+r:"?"+r},e.prototype.remove=function(e){return e},e}(),U=function(){function e(e){this.scripts=[],this.styles=[],this.events=[],this.name=e.name,this.path=e.path,Object.assign(this,e),this.data=_.transform(this.data||{})}return Object.defineProperty(e.prototype,"isReady",{get:function(){return!r(this.template)},enumerable:!1,configurable:!0}),e.prototype.export=function(e){var t=this;return n(e)?v(Object.keys(e),(function(r){t.data[r]=e[r],d(t.data,e,r)})):I.log('Invalid object for component.export(...), only "Object Literal" is allowed.')},e.prototype.destroy=function(){var e=this;if(!this.el)return!1;this.emit("beforeDestroy");var t=this.el.parentElement;t&&t.removeChild(this.el),v(this.events,(function(t){return e.off(t.eventName,t.callback)})),this.events=[],this.emit("destroyed"),v(this.styles,(function(e){return v(y(E.head.children),(function(t){t===e&&E.removeChild(e)}))}))},e.prototype.params=function(){return(new G).params(this.route)},e.prototype.emit=function(e,t){T.Resolve("EventHandler").emit({eventName:e,attachedNode:this.el,init:t})},e.prototype.on=function(e,t){var r=T.Resolve("EventHandler").on(e,t,this.el);return this.events.push(r),r},e.prototype.off=function(e,t){T.Resolve("EventHandler").off(e,t,this.el),this.events=m(this.events,(function(r){return!(r.eventName==e&&r.callback==t)}))},e}(),W=function(){function o(e,t){this.components={},this.requests={},T.Register(this),this.bouer=e,this.delimiter=T.Resolve("DelimiterHandler"),this.eventHandler=T.Resolve("EventHandler"),t.components&&this.prepare(t.components)}return o.prototype.check=function(e){return e in this.components},o.prototype.request=function(t,n){var o=this;if(!r(this.requests[t]))return this.requests[t].push(n);this.requests[t]=[n];var i=null!=E.head.querySelector("base"),a=w(O.baseURI),s=a.baseURI;i||(s=a.origin),e(x(s,t),{headers:{"Content-Type":"text/plain"}}).then((function(e){if(!e.ok)throw e.statusText;return e.text()})).then((function(e){v(o.requests[t],(function(r){r.success(e,t)}))})).catch((function(e){i||I.warn('It seems like you are not using the \u201c<base href="/" />\u201d element, try to add as the first child into \u201c<head></head>\u201d element.'),v(o.requests[t],(function(r){r.fail(e,t)}))})).finally((function(){delete o.requests[t]}))},o.prototype.prepare=function(e,n){var o=this;v(e,(function(e){var i;return r(e.name)&&(e.name=t(9,"component-").toLowerCase()),r(e.path)&&r(e.template)?I.warn("The component with name \u201c"+e.name+"\u201d"+e.route?" and the route \u201c"+e.route+"\u201d":" has not \u201cpath\u201d or \u201ctemplate\u201d property defined, then it was ignored."):(Array.isArray(e.children)&&o.prepare(e.children,e),r(e.route)||(e.route="/"+x(r(n)?"":n.route,e.route)),r(o.components[e.name])?(T.Resolve("Routing").configure(o.components[e.name]=e),void((null===(i=(o.bouer.config||{}).preload)||void 0===i||i)&&(r(e.path)||o.request(e.path,{success:function(t){e.template=t},fail:function(e){I.error(A(e))}})))):I.warn("The component name \u201c"+e.name+"\u201d is already define, try changing the name."))}))},o.prototype.order=function(e,t,r){var n=this,o=e.nodeName.toLowerCase(),i=this.components,s=i[o];if(!s)return I.error("No component with name \u201c"+o+"\u201d registered.");var u=s,l=M.obj(t,{$this:t});if(u.template){var c=new U(u);return c.bouer=this.bouer,a(r)&&r(c),this.insert(e,c,l),void(!0===c.keepAlive&&(i[o]=c))}var f=this.$addEvent("requested",e,u);f&&f.emit(),this.request(u.path,{success:function(t){u.template=t;var s=new U(u);s.bouer=n.bouer,a(r)&&r(s),n.insert(e,s,l),!0===s.keepAlive&&(i[o]=s)},fail:function(e){I.error("Failed to request <"+o+"></"+o+"> component with path \u201c"+u.path+"\u201d."),I.error(A(e)),"function"==typeof u.failed&&u.failed(new CustomEvent("failed"))}})},o.prototype.find=function(e){for(var t=Object.keys(this.components),r=0;r<t.length;r++){var n=this.components[t[r]];if(e(n))return n}return null},o.prototype.$addEvent=function(e,t,r){var n=r[e];if("function"!=typeof n)return{emit:function(){}};var o=this.eventHandler.on(e,(function(e){return n(e)}),t).emit;return{emit:function(){o({eventName:e,attachedNode:t})}}},o.prototype.insert=function(o,i,a){var s,u=this,l=o.nodeName.toLowerCase(),c=o.parentElement;if(o.isConnected&&c){if(!i.isReady)return I.error("The <"+l+"></"+l+"> component is not ready yet to be inserted.");var p=g("div",(function(e){e.innerHTML=o.innerHTML,o.innerHTML=""})).build();(!1===(o.hasAttribute("keep-alive")||null!==(s=i.keepAlive)&&void 0!==s&&s)||r(i.el))&&g("body",(function(e){return e.innerHTML=i.template,v([].slice.apply(e.querySelectorAll("script")),(function(t){i.scripts.push(t),e.removeChild(t)})),v([].slice.apply(e.querySelectorAll('link[rel="stylesheet"]')),(function(t){i.styles.push(t),e.removeChild(t)})),v([].slice.apply(e.querySelectorAll("style")),(function(t){i.styles.push(t),e.removeChild(t)})),0===e.children.length?I.error("The component <"+l+"></"+l+"> seems to be empty or it has not a root element. Example: <div></div>, to be included."):e.children.length>1?I.error("The component <"+l+"></"+l+"> seems to have multiple root element, it must have only one root."):(i.el=e.children[0],u.$addEvent("created",i.el,i),void i.emit("created"))}));var h=i.el;v(y(o.attributes),(function(e){if(o.removeAttribute(e.name),"class"===e.nodeName)return o.classList.forEach((function(e){h.classList.add(e)}));if("data"===e.nodeName){if(0!==u.delimiter.run(e.value).length)return I.error("The \u201cdata\u201d attribute cannot contain delimiter, source element: <"+l+"></"+l+">.");var t={},r=M.obj(a,{$this:a}),s=L.on("AfterGet",(function(e){t[e.propertyName]=void 0,f(t,e.propertyName,e)}));if(""===e.value)t=M.obj(u.bouer.data);else{var c=T.Resolve("Evaluator").exec({data:r,expression:e.value});if(!n(c))return I.error("Expected a valid Object Literal expression in \u201c"+e.nodeName+"\u201d and got \u201c"+e.value+"\u201d.");v(Object.keys(c),(function(e){e in t||(t[e]=c[e])}))}return s.off(),_.transform(t),v(Object.keys(t),(function(e){d(i.data,t,e)}))}h.attributes.setNamedItem(e)})),this.$addEvent("beforeMount",i.el,i),i.emit("beforeMount"),c.replaceChild(h,o);var m={};h.classList.forEach((function(e){return m[e]=!0}));var b=function(e,t){var r="STYLE"===e.nodeName,n=[];if(e.sheet){for(var o=e.sheet.cssRules,i=0;i<o.length;i++){var a=o.item(i);if(a){var s=a,u=s.selectorText.substr(1),l=m[u]?"":" ";s.selectorText="."+t+l+s.selectorText,r&&n.push(s.cssText)}}r&&(e.innerText=n.join("\n"))}};v(i.styles,(function(e){var r=e.cloneNode(!0),n=t(7,"bouer-s");if(r instanceof HTMLLinkElement&&r.hasAttribute("scoped")&&(r.onload=function(e){return b(e.target,n)}),E.head.appendChild(r),r.hasAttribute("scoped"))return h.classList.add(n),r instanceof HTMLStyleElement?b(r,n):void 0}));var N=function(e){try{T.Resolve("Evaluator").execRaw(e||"",i),u.$addEvent("mounted",i.el,i),i.emit("mounted"),u.$addEvent("beforeLoad",i.el,i),i.emit("beforeLoad"),T.Resolve("Compiler").compile({data:_.transform(i.data),el:h,componentContent:p,onDone:function(){u.$addEvent("loaded",i.el,i),i.emit("loaded")}}),V.observe(c,(function(e){if(!h.isConnected){var t=e.mutation;e.element;i.destroy(),t.disconnect()}}))}catch(e){I.error("Error in <"+l+"></"+l+"> component."),I.error(A(e))}};if(0===i.scripts.length)return N();var w=[],x=[],k=[],C={};return v(i.scripts,(function(e){""==e.src||e.innerHTML?w.push(e.innerHTML):k.push(e.src)})),0==k.length?N(w.join("\n\n")):v(k,(function(t,r){C[t]=!0,e(t,{headers:{"Content-Type":"text/plain"}}).then((function(e){if(!e.ok)throw e.statusText;return e.text()})).then((function(e){if(delete C[t],x[r]=e,0===Object.keys(C).length)return N(M.array(x,w).join("\n\n"))})).catch((function(e){e.stack="",I.error('Error loading the <script src="'+t+'"><\/script> in <'+l+"></"+l+"> component, remove it in order to be compiled."),I.log(e),u.$addEvent("failed",o,i).emit()}))}))}},o}(),J=function(){function e(e){this.delimiters=[],T.Register(this),this.delimiters=e}return e.prototype.add=function(e){this.delimiters.push(e)},e.prototype.remove=function(e){var t=this.delimiters.findIndex((function(t){return t.name===e}));this.delimiters.splice(t,1)},e.prototype.run=function(e){var t=this;if(r(e)||""===s(e))return[];var n=null,o=function(e,r){for(var o=0;o<t.delimiters.length;o++){var i=t.delimiters[o],a=e.match(RegExp(i.delimiter.open+"([\\S\\s]*?)"+i.delimiter.close,r||""));if(a)return n=i,a}},i=o(e,"g");return i?i.map((function(e){var t=o(e);return{field:t[0],expression:s(t[1]),delimiter:n}})):[]},e}(),z=function(){function e(e){T.Register(this),this.bouer=e,this.global=this.createWindow()}return e.prototype.createWindow=function(){var e;return g("iframe",(function(t,r){t.style.display="none!important",r.body.appendChild(t),e=t.contentWindow,r.body.removeChild(t)})),delete e.name,e},e.prototype.execRaw=function(e,t){try{var r="(function(){ "+e+" }).apply(this, arguments)";C.Function(r).apply(t||this.bouer)}catch(e){I.error(A(e))}},e.prototype.exec=function(e){var t=this,r=e.data,n=e.args,o=e.expression,i=e.isReturn,a=e.aditional,s=this.global,u={},l=M.obj(a||{});v(Object.keys(r),(function(e){d(l,r,e)})),v(Object.keys(this.bouer.globalData),(function(e){if(e in l)return I.warn('It was not possible to use the globalData property "'+e+'" because it already defined in the current scope.');d(l,t.bouer.globalData,e)}));var c,f=Object.keys(l);v(f,(function(e){delete s[e],e in s&&!0===p(s,e).configurable&&(u[e]=s[e]),e in u&&(s[e]=l[e]),d(s,l,e)}));try{var h='return(function(){"use strict"; '+(!1===i?"":"return")+" "+o+" }).apply(this, arguments)";c=this.global.Function(h).apply(this.bouer,n)}catch(e){I.error(A(e))}return v(f,(function(e){return delete s[e]})),c},e}(),X=function(){function e(e){this.events=[],this.bouer=e,this.evaluator=T.Resolve("Evaluator"),T.Register(this),this.cleanup()}return e.prototype.handle=function(e,t){var n,o=this,i=e.ownerElement||e.parentNode,u=e.nodeName;if(r(i))return I.error("Invalid ParentElement of \u201c"+u+"\u201d");var c=s(null!==(n=e.nodeValue)&&void 0!==n?n:""),f=u.substr(j.on.length).split("."),d=f[0];if(f.shift(),""===c)return I.error("Expected an expression in the \u201c"+u+"\u201d and got an <empty string>.");k(e,i),i.removeAttribute(u);var p={},h=["capture","once","passive"];v(f,(function(e){e=e.toLocaleLowerCase(),-1!==h.indexOf(e)&&(p[e]=!0)})),this.on(d,(function(e){v(f,(function(t){v(Object.keys(e),(function(r){var n;(n=e[r]&&a(n)&&l(r)===l(t))&&n()}))}));var r=[e],n=o.evaluator.exec({data:t,expression:c,args:r,aditional:{event:e}});if(a(n))try{n.apply(o.bouer,r)}catch(e){I.error(A(e))}}),i,p)},e.prototype.on=function(e,t,r,n){var o=this,i={eventName:e,callback:function(e){return t.apply(o.bouer,[e])},attachedNode:r,emit:this.emit};return r?r.addEventListener(e,i.callback,n||!1):this.events.push(i),i},e.prototype.off=function(e,t,r){if(r)return r.removeEventListener(e,t);var n=-1;this.events.find((function(r,o){if(r.eventName===e&&t==r.callback)return n=o,!0})),this.events.splice(n,1)},e.prototype.emit=function(e){var t=this,r=e.eventName,n=e.init,o=e.attachedNode,i=new CustomEvent(r,n);if(o)return o.dispatchEvent(i);v(this.events,(function(n,o){var a;r===n.eventName&&(n.callback.call(t.bouer,i),!0===(null!==(a=e.once)&&void 0!==a&&a)&&t.events.splice(o,1))}))},e.prototype.cleanup=function(){var e=this;R((function(){e.events=m(e.events,(function(e){return!e.attachedNode||(!!e.attachedNode.isConnected||void 0)}))}),1e3)},e}(),Y=function(){function e(e){this.defaultPage=null,this.notFoundPage=null,this.routeView=null,this.activeAnchors=[],this.base=null,T.Register(this),this.bouer=e,this.routeView=this.bouer.el.querySelector("[route-view]")}return e.prototype.init=function(){var e=this;if(!r(this.routeView)){this.routeView.removeAttribute("route-view");var t=E.head.querySelector("base");if(t){var n=t.attributes.href;if(!n)return I.error('The href="/" attribute is required in base element.');this.base=n.value,this.defaultPage&&this.navigate(E.location.href),C.addEventListener("popstate",(function(t){t.preventDefault(),e.navigate(t.state||location.href,!1)}))}}},e.prototype.navigate=function(e,t){var n,o=this;if(r(e))return I.log("Invalid url provided to the navigation method.");var i=w(e=s(e)),a=null===(n=(this.bouer.config||{}).usehash)||void 0===n||n,u=(a?i.hash:i.pathname).split("?")[0];"/"===u[u.length-1]&&(u=u.substr(0,u.length-1));var l=this.toPage(u);if(this.clear(),l&&(l||!e.endsWith(".html"))){var c=b(l.name).appendTo(this.routeView).build(),f=x(i.baseURI,a?"#":"",l.route);T.Resolve("ComponentHandler").order(c,{},(function(e){e.on("loaded",(function(){o.markActiveAnchors(f)}))})),E.title=l.title||E.title,(null==t||t)&&this.pushState(i.href,E.title)}},e.prototype.pushState=function(e,t){e=w(e).href,C.history.pushState(e,t||"",e)},e.prototype.popState=function(e){r(e)&&(e=-1),C.history.go(e)},e.prototype.toPage=function(e){return""===e||"/"===e||e==="/"+x((this.base,"index.html"))?this.defaultPage:T.Resolve("ComponentHandler").find((function(t){if(!t.route)return!1;var r=t.route.replace(/{(.*?)}/gi,"[\\S\\s]{1,}");return!!Array.isArray(new RegExp("^"+r+"$").exec(e))}))||this.notFoundPage},e.prototype.markActiveAnchors=function(e){var t=this,r=(this.bouer.config||{}).activeClassName||"active-link",n=this.bouer.el.querySelectorAll("a");v(this.activeAnchors,(function(e){return e.classList.remove(r)})),this.activeAnchors=[],v(y(n),(function(n){n.href===e&&n.markable&&(n.classList.add(r),t.activeAnchors.push(n))}))},e.prototype.clear=function(){this.routeView.innerHTML=""},e.prototype.configure=function(e){return!0!==e.isDefault||r(this.defaultPage)?!0!==e.isNotFound||r(this.notFoundPage)?(!0===e.isDefault&&(this.defaultPage=e),void(!0===e.isNotFound&&(this.notFoundPage=e))):I.warn("There are multiple \u201cNotFound Page\u201d provided, check the \u201c"+e.route+"\u201d route."):I.warn("There are multiple \u201cDefault Page\u201d provided, check the \u201c"+e.route+"\u201d route.")},e}(),K=function(){var e=this;this.container={},this.run=function(t,r){var n=e.container[t];if(!n)return I.log("There is not interceptor for \u201c"+t+"\u201d.");for(var o=0;o<n.length;o++)(0,n[o])(r)},this.register=function(t,r){var n=e.container[t];if(!n)return e.container[t]=[r];n.push(r)},T.Register(this)},Q=function(){function e(e){var t=this;this.backgroudColor="",this.waveColor="",this.defaultBackgroudColor="#E2E2E2",this.defaultWaveColor="#ffffff5d",this.identifier="bouer",T.Register(this),this.reset(),this.bouer=e,this.style=g("style",(function(e){return e.id=t.identifier})).build()}return e.prototype.reset=function(){this.backgroudColor=this.defaultBackgroudColor,this.waveColor=this.defaultWaveColor},e.prototype.init=function(e){var t,r=this;if(this.style){var n=j.skeleton;E.getElementById(this.identifier)||E.head.appendChild(this.style);for(var o=0;o<this.style.sheet.cssRules.length;o++)null===(t=this.style.sheet)||void 0===t||t.deleteRule(o);e?(this.backgroudColor=e.background||this.defaultBackgroudColor,this.waveColor=e.wave||this.defaultWaveColor):this.reset(),v(["["+n+"] { background-color: "+this.backgroudColor+"!important; position: relative!important; overflow: hidden; }","["+n+"],["+n+"] * { color: transparent!important; }","["+n+"]::before, ["+n+']::after { content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0; display: block; }',"["+n+"]::before { background-color: "+this.backgroudColor+"!important; z-index: 1;}","["+n+"]::after { transform: translateX(-100%); background: linear-gradient(90deg, transparent, "+this.waveColor+", transparent); animation: loading 1.5s infinite; z-index: 2; }","@keyframes loading { 100% { transform: translateX(100%); } }","@-webkit-keyframes loading { 100% { transform: translateX(100%); } }"],(function(e){return r.style.sheet.insertRule(e)}))}},e.prototype.clear=function(e){e=e?'="'+e+'"':"",v(y(this.bouer.el.querySelectorAll("["+j.skeleton+e+"]")),(function(e){return e.removeAttribute(j.skeleton)}))},e}(),Z=function(){function e(e,t){if(this.name="Bouer",this.version="3.0.0",this.components=[],this.dependencies={},t=t||{},this.config=t.config,this.components=t.components||[],this.dependencies=t.dependencies||{},this.interceptor=t.interceptor,r(e)||""===s(e))throw I.error("Invalid selector provided to the instance.");var n=E.querySelector(e);if(!n)throw I.error("Element with selector \u201c"+e+"\u201d not found.");this.el=n;var o=new P;new z(this),new H(this);var i=new K;T.Register(this),"function"==typeof this.interceptor&&this.interceptor(i.register,this),this.data=_.transform(t.data||{}),this.globalData=_.transform(t.globalData||{});var a=t.delimiters||[];a.push.apply(a,[{name:"bouer",delimiter:{open:"-e-",close:"-"}},{name:"common",delimiter:{open:"{{",close:"}}"}},{name:"html",delimiter:{open:"{{:html ",close:"}}"}}]),new S(this);var u=new J(a),l=new X(this);this.routing=new Y(this),new W(this,t);var c=new B(this,t);new F(this),new H(this);var f=new Q(this);f.init(),this.$delimiters={add:u.add,remove:u.remove,get:function(){return u.delimiters.slice()}},this.$data={get:function(e){return e?o.data[e]:o.data},set:function(e,t,r){return e in o.data?I.log("There is already a data stored with this key \u201c"+e+"\u201d."):(!0===(null!=r&&r)&&_.transform(t),P.set("data",e,t))},unset:function(e){return delete o.data[e]}},this.$req={get:function(e){return e?o.req[e]:o.req},unset:function(e){return delete o.req[e]}},this.$wait={get:function(e){return e?o.wait[e]:o.wait},set:function(e,t){if(!(e in o.wait))return o.wait[e]={data:t,nodes:[]};var r=o.wait[e];return r.data=t,v(r.nodes,(function(e){e&&c.compile({el:e,data:_.transform(r.data)})}))},unset:function(e){return delete o.wait[e]}},this.$skeleton={clear:function(e){return f.clear(e)},set:function(e){return f.init(e)}},v([t.beforeLoad,t.loaded,t.destroyed],(function(e){"function"==typeof e&&l.on(e.name,e,n,{once:!0})})),l.emit({eventName:"beforeLoad",attachedNode:n}),c.compile({el:this.el,data:this.data,onDone:function(){return l.emit({eventName:"loaded",attachedNode:n})}}),V.observe(this.el,(function(e){var t=e.mutation;!0!==e.element.isConnected&&(l.emit({eventName:"destroyed",attachedNode:n}),t.disconnect())})),this.routing.init(),E.head.querySelector("link[rel~='icon']")||g("link",(function(e){e.rel="icon",e.type="image/png",e.href="https://afonsomatelias.github.io/assets/bouer/img/short.png"})).appendTo(E.head)}return Object.defineProperty(e.prototype,"refs",{get:function(){var e={};return v(y(this.el.querySelectorAll("["+j.ref+"]")),(function(t){var r=s(t.attributes[j.ref].value)||t.name||"";return""===r?I.error("Expected an expression in \u201c"+t.name+"\u201d or at least \u201cname\u201d attribute to combine with \u201c"+t.name+"\u201d."):r in e?I.warn("The key \u201c"+r+"\u201d in \u201c"+t.name+"\u201d is taken, choose another key.",t):void(e[r]=t)})),e},enumerable:!1,configurable:!0}),e.prototype.toJsObj=function(e,t,r){return T.Resolve("Converter").htmlToJsObj(e,t,r)},e.prototype.setData=function(e,t){return _.setData(e,t||this.data)},e.prototype.watch=function(e,t,r){return T.Resolve("Binder").watch(e,t,r)},e.prototype.on=function(e,t,r,n){return T.Resolve("EventHandler").on(e,t,r,n)},e.prototype.off=function(e,t,r){return T.Resolve("EventHandler").off(e,t,r)},e.prototype.emit=function(e){return T.Resolve("EventHandler").emit(e)},e.prototype.lazy=function(e,t){var n,o=this;t=r(t)?500:t;var i=arguments[2];return function(){var r=arguments,a=function(){n=null,i||e.call(o,r)},s=i&&!n;clearTimeout(n),n=setTimeout(a,t),s&&e.call(o,r)}},e}();export{Z as default};