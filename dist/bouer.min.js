!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Bouer=t()}(this,(function(){"use strict";function e(e,t){return fetch(e,t)}function t(e,t,r){for(var n="01234567890ABCDEFGHIJKLMNOPQRSTUVWXYZ",o=!1,i="",a=0;a<(e||8);a++){var u=Math.floor(Math.random()*n.length);i+=o?n[u].toLowerCase():n[u],o=!o}return(t||"")+i+(r||"")}function r(e){return void 0===e||null==e}function n(e){return"object"==typeof e&&"[object Object]"===String(e)}function o(e){return void 0!==e&&"string"==typeof e}function i(e){return!e||!n(e)||0===Object.keys(e).length}function a(e){return"function"==typeof e}function u(e){return e?e.trim():e}function s(e,t){return e.substr(0,t.length)===t}function l(e){return e.toLowerCase()}function c(e){return function(e){return"string"==typeof e||"number"==typeof e||"symbol"==typeof e||"boolean"==typeof e}(e)?String(e):n(e)?JSON.stringify(e):a(e.toString)?e.toString():String(e)}function f(e,t,r){return Object.defineProperty(e,t,r),e}function d(e,t,r){f(e,r,p(t,r))}function p(e,t){return Object.getOwnPropertyDescriptor(e,t)}function h(e,t,n){void 0===n&&(n=!1);var o=null;if(!e)return null;for(var i=0,a=t;i<a.length;i++){var u=a[i];if(o=e.attributes[u])break}return!r(o)&&n&&e.removeAttribute(o.name),o}function v(e,t,r){for(var n=0;n<e.length;n++)a(t)&&t.call(r,e[n],n)}function m(e,t,r){for(var n=[],o=0;o<e.length;o++){var i=e[o];a(t)&&t.call(r,i,o)&&n.push(i)}return n}function y(e){return e?[].slice.call(e):[]}function b(e,t){var r=O.createElement(e);a(t)&&t(r,O);var n={appendTo:function(e){return e.appendChild(r),n},build:function(){return r}};return n}function g(e,t){var r=O.createElement(e);a(t)&&t(r,O);var n={appendTo:function(e){return e.appendChild(r),n},build:function(){return r}};return n}function w(e,t){v(Object.keys(e),(function(r){var o=e[r];if(r in t)return n(o)?w(o,t[r]):t[r]=o;d(t,e,r)}))}function N(e){var t=e;"documentMode"in O&&(R.setAttribute("href",t),t=R.href),R.setAttribute("href",t);var r=R.hostname;!("[::1]"===R.hostname)&&r.indexOf(":")>-1&&(r="["+r+"]");var n={href:R.href,baseURI:R.baseURI,protocol:R.protocol?R.protocol.replace(/:$/,""):"",host:R.host,search:R.search?R.search.replace(/^\?/,""):"",hash:R.hash?R.hash.replace(/^#/,""):"",hostname:r,port:R.port,pathname:"/"===R.pathname.charAt(0)?R.pathname:"/"+R.pathname,origin:""};return n.origin=n.protocol+"://"+n.host,n}function x(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=e.split(/\/\//),o=n.length>1?n[0]+"//":"",i=""===o?n[0]:n[1],a=i.split(/\//),s=[];return v(a,(function(e){return u(e)?s.push(e):null})),v(t,(function(e){return v(e.split(/\//),(function(e){return u(e)?s.push(e):null}))})),o+s.join("/")}function A(e,t){return e.stack="",e}function E(e,t){return f(e,"isConnected",{get:function(){return t.isConnected}}),e}var O=document,k=globalThis,R=g("a").build(),C=setInterval,T={ignore:"e-ignore",build:"e-build",array:"e-array",if:"e-if",elseif:"e-else-if",else:"e-else",show:"e-show",req:"e-req",tmp:"e-tmp",fill:"e-fill",for:"e-for",use:"e-use",id:"e-id",order:"e-order",filter:"e-filter",data:"data",def:"e-def",wait:"wait-data",toggle:"e-toggle",content:"e-content",bind:"e-bind",property:"e-",anm:"e-anm",skeleton:"e-skeleton",route:"route-view",href:":href",ihref:"!href",entry:"e-entry",component:":name",on:"on:",tagContent:"content",ref:"ref",put:"put",connector:"connector",events:{compile:"compile",request:"request",response:"response",fail:"fail",done:"done"},check:function(e,t){return s(e.nodeName,t)},isConstant:function(e){var t=this;return-1!==Object.keys(this).map((function(e){return t[e]})).indexOf(e)}},j=function(){function e(){}return e.Register=function(e){this.container[e.__proto__.constructor.name]=e},e.Resolve=function(e){return this.container[e]},e.Dispose=function(e){delete this.container[e]},e.container={},e}(),V=function(){function e(){}return e.observe=function(e,t){var r=new MutationObserver((function(n){t({element:e,mutation:r,records:n})}));r.observe(e,{childList:!0})},e}();function D(e,t,r){if(r||2===arguments.length)for(var n,o=0,i=t.length;o<i;o++)!n&&o in t||(n||(n=Array.prototype.slice.call(t,0,o)),n[o]=t[o]);return e.concat(n||Array.prototype.slice.call(t))}var L=function(){function e(){}return e.log=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];console.log.apply(console,D([e.prefix],t,!1))},e.error=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];console.error.apply(console,D([e.prefix],t,!1))},e.warn=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];console.warn.apply(console,D([e.prefix],t,!1))},e.info=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];console.info.apply(console,D([e.prefix],t,!1))},e.prefix="[Bouer]",e}(),S=function(){function e(){}return e.on=function(t,r){return this[t].push(r),{eventName:t,callback:r,off:function(){return e.off(t,r)}}},e.off=function(e,t){var r=this[e];return r.splice(r.indexOf(t),1),!0},e.once=function(t,r){var n={},o=e.on(t,(function(e,t,r){n.onemit&&n.onemit(e)}));try{r(n)}catch(e){L.error(A(e))}finally{e.off(t,o.callback)}},e.emit=function(e,t){try{v(this[e],(function(e){return e(t)}))}catch(e){L.error(A(e))}},e.BeforeGet=[],e.AfterGet=[],e.BeforeSet=[],e.AfterSet=[],e}(),M=function(){function e(e){this.binds=[],this.DEFAULT_BINDER_PROPERTIES={text:"value",number:"valueAsNumber",checkbox:"checked",radio:"checked"},this.BindingDirection={fromInputToData:"to-data-property",fromDataToInput:"to-input"},j.Register(this),this.evaluator=j.Resolve("Evaluator"),this.bouer=e,this.cleanup()}return e.prototype.create=function(e){var t,o=this,i=e.node,s=e.data,l=e.fields,f=e.eReplace,d=u(null!==(t=i.nodeValue)&&void 0!==t?t:""),p=i.nodeName,h=i.ownerElement||i.parentNode,m=e.onChange||function(e,t){},b={name:p,value:d,bindOptions:e,boundNode:i};if(p.substr(0,T.bind.length)===T.bind){var w="";if(T.bind===p){var N=h.type||h.localName;w=this.DEFAULT_BINDER_PROPERTIES[N]||"value"}else w=p.split(":")[1];var x,A,E,O=h instanceof HTMLSelectElement,k=O&&!0===h.multiple,R=d.split("|").map((function(e){return u(e)})),C=R[0],V=function(e,t){if(!(E=R[1])){var i=u(h.getAttribute("value"));i&&(E="'"+i+"'")}if(O&&!k&&Array.isArray(x)&&!E)return L.error("Since it's a <select> array binding, it expects the “multiple” attribute in order to bind the multi values.");if(!k&&Array.isArray(x)&&!E)return L.error("Since it's an array binding it expects a model but it has not been defined, provide a model as it follows "+p+'="'+C+' | Model" or value="String-Model".');switch(e){case o.BindingDirection.fromDataToInput:if(Array.isArray(x)){if(k)return v(y(h.options),(function(e){e.selected=-1!==x.indexOf(u(e.value))}));if(-1===x.indexOf(A))switch(typeof h[w]){case"boolean":h[w]=!1;break;case"number":h[w]=0;break;default:h[w]=""}return}return h[w]=n(t)?c(t):r(t)?"":t;case o.BindingDirection.fromInputToData:if(Array.isArray(x)){if(k){var a=[];return v(y(h.options),(function(e){!0===e.selected&&a.push(u(e.value))})),x.splice(0,x.length),x.push.apply(x,a)}return A=A||o.evaluator.exec({data:s,expression:E}),void(t?x.push(A):x.splice(x.indexOf(A),1))}return s[C]=t}},D=S.on("AfterGet",(function(e){o.binds.push(e.watch((function(e){V(o.BindingDirection.fromDataToInput,e),m(e,i)}),i))})),M=x=this.evaluator.exec({expression:C,data:s});D.off(),V(this.BindingDirection.fromDataToInput,M);var I=[h.nodeName.toLowerCase(),"propertychange","change"],H=function(){V(o.BindingDirection.fromInputToData,h[w])};return v(I,(function(e){"change"===e&&"select"!==h.localName||h.addEventListener(e,H,!1)})),h.removeAttribute(i.nodeName),b}var q=i;p.substr(0,T.property.length)===T.property&&r(f)&&(b.name=p.substr(T.property.length),h.setAttribute(b.name,d),q=h.attributes[b.name],h.removeAttribute(i.nodeName));var _=function(){var e=b.value,t=!1;if(v(l,(function(n){var u=n.delimiter;u&&"html"===u.name&&(t=!0);var l=o.evaluator.exec({expression:n.expression,data:s});l=r(l)?"":l,e=e.replace(n.field,c(l)),u&&a(u.action)&&(e=u.action(e,i,s))})),t){var n=g("div",(function(t){t.innerHTML=e})).build().children[0];h.appendChild(n),j.Resolve("Compiler").compile({el:n,data:s})}else q.nodeValue=e};return S.once("AfterGet",(function(e){e.onemit=function(e){o.binds.push(e.watch((function(e){_(),m(e,i)}),i))},_()})),b.boundNode=q,b},e.prototype.watch=function(e,t,r){var n=null,o=r||this.bouer.data;return S.once("AfterGet",(function(r){r.onemit=function(e){return n=e.watch(t)},o[e]})),n},e.prototype.cleanup=function(){var e=this;C((function(){e.binds=m(e.binds,(function(e){return!e.node||(!!e.node.isConnected||void e.destroy())}))}),1e3)},e}(),I=function(){function e(e){j.Register(this),this.bouer=e}return e.prototype.create=function(e){var r=O.createComment("e");return r.id=e||t(8),r},e.prototype.get=function(e,t){if(!r(e))return t=t||this.bouer.el,this.retrieve(t).find((function(t){return t.id===e}))},e.prototype.retrieve=function(e){if(!e)return[];for(var t,r=O.createNodeIterator(e,NodeFilter.SHOW_COMMENT,(function(){return NodeFilter.FILTER_ACCEPT})),n=[];t=r.nextNode();)"id"in t&&n.push(t);return n},e}(),H=function(){function e(){}return e.obj=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n={};return v(e,(function(e){r(e)||v(Object.keys(e),(function(t){r(e[t])||d(n,e,t)}))})),n},e.addToObj=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return v(t,(function(t){r(t)||v(Object.keys(t),(function(n){r(t[n])||d(e,t,n)}))})),e},e.array=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=[];return v(e,(function(e){if(!r(e))return Array.isArray(e)?void v(Object.keys(e),(function(t){var o=e[t];r(o)||(Array.isArray(o)?[].push.apply(n,o):n.push(o))})):n.push(e)})),n},e}(),q=function(e,t,r){var n=this;this.destroy=function(){var e=n.reactive.watches.indexOf(n);-1!==e&&n.reactive.watches.splice(e,1),n.onDestroy&&n.onDestroy()},this.reactive=e,this.property=e.propertyName,this.callback=t,r&&(this.node=r.node,this.onDestroy=r.onDestroy)},_=function(){function e(t){var o=this;if(this.watches=[],this.get=function(){S.emit("BeforeGet",o),o.propertyValue=o.isComputed?o.computedGetter():o.propertyValue;var e=o.propertyValue;return S.emit("AfterGet",o),e},this.set=function(t){var i=o.propertyValue;if(i!==t){if(S.emit("BeforeSet",o),n(t)||Array.isArray(t)){if(typeof o.propertyValue!=typeof t)return L.error("Cannot set “"+typeof t+"” in “"+o.propertyName+"” property.");if(Array.isArray(t)){e.transform(t,o);var a=o.propertyValue;a.splice(0,a.length),a.push.apply(a,t)}else n(t)&&(t instanceof Node?o.propertyValue=t:(e.transform(t),r(o.propertyValue)?o.propertyValue=t:w(t,o.propertyValue)))}else o.propertyValue=t;o.isComputed&&o.computedSetter&&o.computedSetter(t),S.emit("AfterSet",o),v(o.watches,(function(e){return e.callback(o.propertyValue,i)}))}},this.propertyName=t.propertyName,this.propertySource=t.sourceObject,this.propertyDescriptor=p(this.propertySource,this.propertyName),this.propertyValue=this.propertyDescriptor.value,this.isComputed="function"==typeof this.propertyValue&&"$computed"===this.propertyValue.name,this.isComputed){var i=this.propertyValue.call(j.Resolve("Bouer"));if(("get"in i||a(i))&&(this.computedGetter=i.get||i),"set"in i&&(this.computedSetter=i.set),!this.computedGetter)throw new Error("Computed property must be a function “function $computed(){...}” that returns a function for “getter only” or an object with a “get” and/or “set” function");this.propertyValue=void 0}}var t;return e.prototype.watch=function(e,t){var r=new q(this,e,{node:t});return this.watches.push(r),r},e.setData=function(t,r){return n(t)?n(r)&&null!==r?L.error('Invalid targetObject value, expected an "Object Literal" and got "'+typeof r+'".'):(e.transform(t),v(Object.keys(t),(function(e){return d(r,t,e)})),r):L.error('Invalid inputData value, expected an "Object Literal" and got "'+typeof t+'".')},t=e,e.transform=function(o,i){if(Array.isArray(o)){if(null==i)return L.warn("Cannot transform this array to a reactive one because no reactive objecto was provided"),o;var a=o,u={},s=a.__proto__=Object.create(Array.prototype);return v(["push","pop","unshift","shift","splice"],(function(t){u[t]=a[t].bind(a),s[t]=function(){var r=a.slice();switch(t){case"push":case"unshift":v(y(arguments),(function(t){(n(t)||Array.isArray(t))&&e.transform(t)}))}var o=u[t].apply(a,arguments);return v(i.watches,(function(e){return e.callback(a,r)})),o}})),a}return n(o)?(v(Object.keys(o),(function(i){var a=o;if(!r(p(o,i).value)){var u=new e({propertyName:i,sourceObject:o});f(o,i,u);var s=a[i];n(s)?t.transform(s):Array.isArray(s)&&(t.transform(s,u),v(s,(function(e){return t.transform(e)})))}})),o):o},e}(),P=function(){function e(){this.wait={},this.data={},this.req={},j.Register(this)}return e.set=function(t,r,n){if("wait"===t)return L.warn("Only “get” is allowed for type of data");j.Resolve(e.name)[t][r]=n},e.get=function(t,r,n){var o=j.Resolve(e.name)[t][r];return!0===n&&e.unset(t,r),o},e.unset=function(t,r){delete j.Resolve(e.name)[t][r]},e}(),$=function(){function t(e,t){this.errorMsgEmptyNode=function(e){return"Expected an expression in “"+e.nodeName+"” and got an <empty string>."},this.errorMsgNodeValue=function(e){var t;return"Expected an expression in “"+e.nodeName+"” and got “"+(null!==(t=e.nodeValue)&&void 0!==t?t:"")+"”."},this.bouer=e,this.compiler=t,this.evaluator=j.Resolve("Evaluator"),this.delimiter=j.Resolve("DelimiterHandler"),this.comment=j.Resolve("CommentHandler"),this.binder=j.Resolve("Binder"),this.eventHandler=j.Resolve("EventHandler")}return t.prototype.toOwnerNode=function(e){return e.ownerElement||e.parentNode},t.prototype.ignore=function(e){e.nodeValue="true"},t.prototype.if=function(e,t){var r,n,o=this,i=this.toOwnerNode(e),a=i.parentElement,s=[],l=this.comment.create(),c=e.nodeName,f=function(){};if(a&&c!==T.elseif&&c!==T.else){var d=i,p=[],m=function(){if(null==d)return"break";var e=h(d,["e-if","e-else-if","e-else"]);return e?"e-else"!==e.nodeName&&""===u(null!==(r=e.nodeValue)&&void 0!==r?r:"")?{value:L.error(y.errorMsgEmptyNode(e))}:0!==y.delimiter.run(null!==(n=e.nodeValue)&&void 0!==n?n:"").length?{value:L.error(y.errorMsgNodeValue(e))}:(s.push({node:e,element:d}),E(d,a),E(e,a),"e-else"===e.nodeName?(d.removeAttribute(e.nodeName),"break"):(S.once("AfterGet",(function(r){r.onemit=function(t){-1===p.findIndex((function(e){return e.reactive.propertyName==t.propertyName}))&&p.push({attr:e,reactive:t})},o.evaluator.exec({data:t,expression:e.value})})),void d.removeAttribute(e.nodeName))):"break"},y=this;do{var b=m();if("object"==typeof b)return b.value;if("break"===b)break}while(d=d.nextElementSibling);v(p,(function(e){return o.binder.binds.push(e.reactive.watch((function(){return f()}),e.attr))})),(f=function(){v(s,(function(e){e.element.parentElement&&(l.isConnected?a.removeChild(e.element):a.replaceChild(l,e.element))}));var e=s.map((function(e,t){var r=e.node.value;switch(e.node.name){case T.if:return"if("+r+"){ _cb("+t+"); }";case T.elseif:return"else if("+r+"){ _cb("+t+"); }";case T.else:return"else{ _cb("+t+"); }"}})).join(" ");o.evaluator.exec({data:t,isReturn:!1,expression:e,aditional:{_cb:function(e){var r=s[e].element;a.replaceChild(r,l),o.compiler.compile({el:r,data:t})}}})})()}},t.prototype.show=function(e,t){var r,n=this,o=this.toOwnerNode(e),i=u(null!==(r=e.nodeValue)&&void 0!==r?r:""),a=0!==this.delimiter.run(i).length;if(""===i)return L.error(this.errorMsgEmptyNode(e));if(a)return L.error(this.errorMsgNodeValue(e));var s=function(e){var r=n.evaluator.exec({expression:i,data:t});e.style.display=r?"":"none"};E(e,o);var l=this.binder.create({data:t,node:e,fields:[{expression:i,field:i}],onChange:function(){return s(o)}});s(o),o.removeAttribute(l.boundNode.nodeName)},t.prototype.for=function(e,t){var n,o=this,i=this.toOwnerNode(e),a=i.parentElement,s=this.comment.create(),l=e.nodeName,f=u(null!==(n=e.nodeValue)&&void 0!==n?n:""),d=[],p=function(){};if(a){if(""===f)return L.error(this.errorMsgEmptyNode(e));if(!f.includes(" of ")&&!f.includes(" in "))return L.error("Expected a valid “for” expression in “"+l+"” and got “"+f+'”.\nValid: e-for="item of items".');var h=this.delimiter.run(f);0!==h.length&&this.binder.create({data:t,fields:h,eReplace:!0,node:e,onChange:function(){return p()}}),i.removeAttribute(l);var m=i.cloneNode(!0);a.replaceChild(s,i),E(m,s),E(e,s);var y=function(e){var r=e.split("|").map((function(e){return u(e)})),n=r[0].replace(/\(|\)/g,"");r.shift();var i=" of ",a=n.split(i);a.length>1||(a=n.split(i=" in "));var s=a[0],l=a[1],c=s.split(",").map((function(e){return u(e)})),f="of"===u(i)?l:"Object.keys("+l+")";return{filters:r,type:i,leftHand:s,rightHand:l,sourceValue:o.evaluator.exec({data:t,expression:l}),leftHandParts:c,iterableExpression:f,isForOf:"of"===u(i)}},b=S.on("AfterGet",(function(t){return o.binder.binds.push(t.watch((function(){return p()}),e))})),g=y(f);b.off(),(p=function(){var n,i=(g=g||y(u(null!==(n=e.nodeValue)&&void 0!==n?n:""))).iterableExpression,p=g.leftHandParts,h=g.sourceValue,b=g.isForOf,w=g.filters;v(d,(function(e){e.parentElement&&a.removeChild(e)})),d=[],o.evaluator.exec({data:t,isReturn:!1,expression:"_for("+i+", ($$itm, $$idx) => { _each($$itm, $$idx); })",aditional:{_for:v,_each:function(e,r){var n=H.obj(t),i=p[0],u=p[1]||"index_or_value",l=p[2]||"for_in_index";n[i]=e,n[u]=b?r:h[e],n[l]=r;var c=a.insertBefore(m.cloneNode(!0),s);o.compiler.compile({el:c,data:n}),d.push(c)},_flt:function(e){var n=H.array(e),i=function(e){return w.find((function(t){return t.substr(0,e.length)===e}))},a=i("filter");if(a){var s=a.split(":").map((function(e){return u(e)}));1==s.length?L.error("Invalid “"+l+"” filter expression “"+f+"”, at least a filter-value and filter-keys, or a filter-function must be provided"):n=function(e,n){var i=n[1],a=n[2];if(r(i)||""===i)return L.error("Invalid filter-value in “"+l+"” with “"+f+"” expression."),e;if("function"==typeof(i=o.evaluator.exec({data:t,expression:i})))e=i(e);else{if(r(a)||""===a)return L.error("Invalid filter-keys in “"+l+"” with “"+f+"” expression, at least one filter-key to be provided."),e;var s=[];v(e,(function(e){for(var t=0,r=a.split(",").map((function(e){return u(e)}));t<r.length;t++){var n=r[t];if(!c(o.evaluator.exec({data:e,expression:n})).includes(i))break;s.push(e)}})),e=s}return e}(n,s)}var d=i("order");if(d){var p=d.split(":").map((function(e){return u(e)}));1==p.length?L.error("Invalid “"+l+"” order  expression “"+f+"”, at least the order type must be provided"):n=function(e,t,n){return t||(t="asc"),e.sort((function(e,o){var i=function(e,n){if(r(e)||r(n))return 0;switch(t.toLowerCase()){case"asc":return e?1:-1;case"desc":return n?-1:1;default:return L.log("The “"+t+"” order type is invalid: “"+f+"”. Available types are: “asc”  for order ascendent and “desc” for order descendent."),0}};return n?i(e[n]>o[n],o[n]<e[n]):i(e>o,o<e)}))}(n,p[1],p[2])}return n}}}),g=null})()}},t.prototype.def=function(e,t){var r,o=this.toOwnerNode(e),i=u(null!==(r=e.nodeValue)&&void 0!==r?r:""),a=0!==this.delimiter.run(i).length;if(""===i)return L.error(this.errorMsgEmptyNode(e));if(a)return L.error(this.errorMsgNodeValue(e));var s=this.evaluator.exec({data:t,expression:i});if(!n(s))return L.error("Expected a valid Object Literal expression in “"+e.nodeName+"” and got “"+i+"”.");this.bouer.setData(s,t),o.removeAttribute(e.nodeName)},t.prototype.content=function(e){var t,r=this.toOwnerNode(e),n=u(null!==(t=e.nodeValue)&&void 0!==t?t:"");if(""===n)return L.error(this.errorMsgEmptyNode(e));r.innerText=n,r.removeAttribute(e.nodeName)},t.prototype.bind=function(e,t){var r,n=this.toOwnerNode(e),o=u(null!==(r=e.nodeValue)&&void 0!==r?r:""),i=0!==this.delimiter.run(o).length;return""===o?L.error(this.errorMsgEmptyNode(e)):i?L.error(this.errorMsgNodeValue(e)):(this.binder.create({node:E(e,n),fields:[{field:o,expression:o}],data:t}),void n.removeAttribute(e.nodeName))},t.prototype.property=function(e,t){var r,o=this,i=this.toOwnerNode(e),a=u(null!==(r=e.nodeValue)&&void 0!==r?r:""),s=0!==this.delimiter.run(a).length,l=function(e){},c=function(e){var t;return"Invalid value, expected an Object/Object Literal in “"+e.nodeName+"” and got “"+(null!==(t=e.nodeValue)&&void 0!==t?t:"")+"”."};if(""===a)return L.error(c(e));if(!s){var f=this.evaluator.exec({data:t,expression:a});if(!n(f))return L.error(c(e));this.binder.create({data:t,node:E(e,i),eReplace:!1,fields:[{expression:a,field:a}],onChange:function(){return l(o.evaluator.exec({data:t,expression:a}))}}),i.removeAttribute(e.nodeName),(l=function(t){var r=e.nodeName.substr(T.property.length),n=i.attributes[r];if(n||(i.setAttribute(r,""),n=i.attributes[r]),v(Object.keys(t),(function(e){if(!t[e])return n.value=u(n.value.replace(e,""));n.value=n.value.includes(e)?n.value:u(n.value+" "+e)})),""===n.value)return i.removeAttribute(r)})(f)}},t.prototype.data=function(e,t){var r,o=this.toOwnerNode(e),i=u(null!==(r=e.nodeValue)&&void 0!==r?r:""),a=0!==this.delimiter.run(i).length,s={};if(a)return L.error("The “data” attribute cannot contain delimiter.");o.removeAttribute(e.nodeName);var l=H.obj(t,{$this:t}),c=S.on("AfterGet",(function(e){s[e.propertyName]=void 0,f(s,e.propertyName,e)}));if(""===i)s=H.obj(this.bouer.data);else{var d=this.evaluator.exec({data:l,expression:i});if(!n(d))return L.error("Expected a valid Object Literal expression in “"+e.nodeName+"” and got “"+i+"”.");v(Object.keys(d),(function(e){e in s||(s[e]=d[e])}))}S.off("AfterGet",c.callback);var p=e.nodeName.split(":")[1];return p&&(p=p.replace(/\[|\]/g,""),P.set("data",p,s)),_.transform(s),this.compiler.compile({data:s,el:o})},t.prototype.href=function(e,t){var r,n,o=this.toOwnerNode(e),i=e.nodeName,a=u(null!==(r=e.nodeValue)&&void 0!==r?r:"");if(""===a)return L.error(this.errorMsgEmptyNode(e));o.removeAttribute(e.nodeName);var s=x(null===(n=(this.bouer.config||{}).usehash)||void 0===n||n?"#":"",a);o.setAttribute("href",s);var l=o.attributes.href,c=this.delimiter.run(a);0!==c.length&&this.binder.create({data:t,node:E(l,o),fields:c}),o.addEventListener("click",(function(e){e.preventDefault(),j.Resolve("Routing").navigate(l.value)}),!1),l.markable=":"===i[0]},t.prototype.entry=function(e,t){var r,n=this.toOwnerNode(e),o=u(null!==(r=e.nodeValue)&&void 0!==r?r:""),i=0!==this.delimiter.run(o).length;return""===o?L.error(this.errorMsgEmptyNode(e)):i?L.error(this.errorMsgNodeValue(e)):(n.removeAttribute(e.nodeName),void j.Resolve("ComponentHandler").prepare([{name:o,template:n.outerHTML,data:t}]))},t.prototype.put=function(e,t){var r,n=this.toOwnerNode(e),o=u(null!==(r=e.nodeValue)&&void 0!==r?r:""),i=function(){};if(""===o)return L.error(this.errorMsgEmptyNode(e),"Direct <empty string> injection value is allowed, only with a delimiter.");var a=this.delimiter.run(o);n.removeAttribute(e.nodeName),0!==a.length&&this.binder.create({data:t,node:E(e,n),fields:a,onChange:function(){return i()}}),(i=function(){var r;if(n.innerHTML="",""!==(o=u(null!==(r=e.nodeValue)&&void 0!==r?r:""))){var i=b(o).appendTo(n).build();j.Resolve("ComponentHandler").order(i,t)}})()},t.prototype.req=function(t,r){var n,o=this,i=this.toOwnerNode(t),a=t.nodeName,s={},l=u(null!==(n=t.nodeValue)&&void 0!==n?n:""),c=function(){};if(!l.includes(" of ")&&!l.includes(" as "))return L.error("Expected a valid “for” expression in “"+a+"” and got “"+l+'”.\nValid: e-req="item of [url]".');l.includes(" of ")&&E(i,i.parentNode),E(t,i);var f=this.delimiter.run(l);0!==f.length&&this.binder.create({data:r,node:t,fields:f,eReplace:!1,onChange:function(){return c()}}),i.removeAttribute(t.nodeName);var p=function(e){var t=i.attributes[T.on+e];return t&&o.eventHandler.handle(t,r),{emit:function(t){o.eventHandler.emit({attachedNode:i,eventName:e,init:{detail:t}})}}},h=j.Resolve("Interceptor"),v=p(T.events.request),m=p(T.events.response),y=p(T.events.fail),b=p(T.events.done);(c=function(){var n=(l=u(t.nodeValue||"")).split("|").map((function(e){return u(e)})),a=n[0].replace(/\(|\)/g,"");n.shift();var c=" of ",f=a.split(c);f.length>1||(f=a.split(c=" as "));var g=u(c),w=t.nodeName.split(":")[1];w=w?w.replace(/\[|\]/g,""):"",v.emit(),h.run("req",{http:e,type:g,path:f[1].replace(/\[|\]/g,""),success:function(e){var t;if(!e)return L.error("the “success” parameter must be an object containing “data” property. Example: { data: {} | [] }");if(!("data"in e))return L.error("the “success” parameter must be contain the “data” property. Example: { data: {} | [] }");if("of"===g&&!Array.isArray(e.data))return L.error('Using e-ref="... “of” ..." the response must be a list of items, and got “'+typeof e.data+"”.");if("as"===g&&"object"!=typeof e.data)return L.error('Using e-ref="... “as” ..." the response must be a list of items, and got “'+typeof e.data+"”.");if(_.transform(e),m.emit({response:e}),"data"in s)return s.data=e.data;switch(s.data=void 0,d(s,e,"data"),w&&P.set("req",w,e),g){case"as":var n=u(f[0].split(",")[0].replace(/\(|\)/g,""));return o.compiler.compile({el:i,data:H.obj((t={},t[n]=e.data,t),r),onDone:function(e,t){p(T.events.compile).emit({data:t})}});case"of":var a=l.replace(f[1],"_response_");return i.setAttribute(T.for,a),o.compiler.compile({el:i,data:H.obj({_response_:e.data},r),onDone:function(e,t){p(T.events.compile).emit({data:t})}})}},fail:function(e){return y.emit({error:e})},done:function(){return b.emit()}})})()},t.prototype.wait=function(e){var t,r=this,n=this.toOwnerNode(e),o=u(null!==(t=e.nodeValue)&&void 0!==t?t:""),i=0!==this.delimiter.run(o).length,a=j.Resolve("DataStore");if(""===o)return L.error(this.errorMsgEmptyNode(e));if(i)return L.error(this.errorMsgNodeValue(e));n.removeAttribute(e.nodeName);var s=a.wait[o];if(s){if(s.nodes.push(n),!s.data)return;return v(s.nodes,(function(e){r.compiler.compile({el:e,data:_.transform(s.data)})}))}return a.wait[o]={nodes:[n]}},t.prototype.skeleton=function(e,t){L.warn("e-skeleton not implemented yet.")},t}(),B=function(){function e(e){this.NODES_TO_IGNORE_IN_COMPILATION={SCRIPT:1,"#comment":8},j.Register(this),this.bouer=e,this.binder=j.Resolve("Binder"),this.delimiter=j.Resolve("DelimiterHandler"),this.eventHandler=j.Resolve("EventHandler"),this.component=j.Resolve("ComponentHandler"),this.directive=new $(e,this)}return e.prototype.compile=function(e){var t=this,r=e.el,n=e.data||this.bouer.data;if(this.analize(r.outerHTML)){var i=function(n,a){if(!(n.nodeName in t.NODES_TO_IGNORE_IN_COMPILATION)){if(n instanceof Element){if(T.ignore in n.attributes)return t.directive.ignore(n);if(n.localName===T.tagContent&&e.componentContent){var u=function(e,t){v(y(e.childNodes),(function(e){var n=e.cloneNode(!0);r.insertBefore(n,t),i(n,a)})),r.removeChild(t)};if(n.hasAttribute("default"))return u(e.componentContent,n);if(n.hasAttribute("target")){var l=n.attributes.target;return v(y(e.componentContent.children),(function(e){e.localName===T.tagContent&&e.getAttribute("target")!==l.value||u(e,n)}))}}if(T.def in n.attributes&&t.directive.def(n.attributes[T.def],a),T.entry in n.attributes&&t.directive.entry(n.attributes[T.entry],a),T.wait in n.attributes)return t.directive.wait(n.attributes[T.wait]);if(t.component.check(n.localName))return t.component.order(n,a);if(T.for in n.attributes)return t.directive.for(n.attributes[T.for],a);if(T.if in n.attributes)return t.directive.if(n.attributes[T.if],a);(T.elseif in n.attributes||T.else in n.attributes)&&L.warn('The "'+T.elseif+'" or "'+T.else+'" requires an element with "'+T.if+'" above.'),T.show in n.attributes&&t.directive.show(n.attributes[T.show],a);var c=null;if((c=n.attributes[T.req])||(c=y(n.attributes).find((function(e){return T.check(e,T.req)}))))return t.directive.req(c,a);var f;if(f=y(n.attributes).find((function(e){var t=e.name;return t===T.data||s(t,T.data+":")})))return t.directive.data(f,a);if(T.put in n.attributes)return t.directive.put(n.attributes[T.put],a);v(y(n.attributes),(function(e){i(e,a)}))}if(T.check(n,T.href)||T.check(n,T.ihref))return t.directive.href(n,a);if(T.check(n,T.content))return t.directive.content(n);if(T.check(n,T.bind))return t.directive.bind(n,a);if(T.check(n,T.property)&&!T.isConstant(n.nodeName)&&t.directive.property(n,a),T.check(n,T.on))return t.eventHandler.handle(n,a);var d;o(n.nodeValue)&&(d=t.delimiter.run(n.nodeValue))&&0!==d.length&&t.binder.create({node:E(n,r),fields:d,data:a}),v(y(n.childNodes),(function(e){return i(e,a)}))}};i(r,n),a(e.onDone)&&e.onDone.call(this.bouer,r)}},e.prototype.analize=function(e){return!0},e}(),F=function(){function e(e){j.Register(this),this.bouer=e}return e.prototype.htmlToJsObj=function(e,t,u){var s=void 0,l=this;if(e instanceof Element)s=e;else{if(n(e))return e;if(o(e))try{s=this.bouer.el.querySelector(e)}catch(t){return e}}if(r(s))throw L.error("Invalid element passed in app.toJsObj(...).");var c=((t=t||{}).names||"[name]").replace(/\[|\]/g,"").split(","),f=(t.values||"[value]").replace(/\[|\]/g,"").split(","),d=function(e,t){return t in e?e[t]:e.getAttribute(t)||e.innerText},p=function(e){var t={},r={BUTTON:!0},n={checkbox:!0,radio:!0};return function e(o){var i=h(o,c);if(i){var s=i.value;if(!0===r[o.tagName])return;if(o instanceof HTMLInputElement&&!0===n[o.type]&&!1===o.checked)return;var p=t[s],m=o.hasAttribute(T.array),b=function(e){var t=void 0;return f.find((function(r){return!!(t=d(e,r))})),t}(o);t[s]=m?p?H.array(p,b):[b]:p?H.array(p,b):b,a(u)&&u.call(l,t,s,b,o)}v(y(o.children),(function(t){h(t,[T.build])||e(t)}))}(e),t},m=p(s);return v(y(s.querySelectorAll("["+T.build+"]")),(function(e){var t=d(e,T.build),o=e.hasAttribute(T.array),s=p(e);(function(e){if(i(e))return!1;for(var t=!1,n=Object.keys(e),o=0;o<n.length;o++)if(!r(n[o])){t=!0;break}return t})(s)&&function t(c,f){var d=c.split("."),p=d[0];d.shift();var h=f[p];return r(h)&&(f[p]={}),0===d.length?(o?n(h)&&!i(h)?f[p]=[H.obj(h,s)]:Array.isArray(h)?h.push(s):f[p]=[s]:r(h)?f[p]=s:f[p]=H.obj(h,s),void(a(u)&&u.call(l,f,p,s,e))):Array.isArray(h)?v(h,(function(e){t(d.join("."),e)})):void t(d.join("."),f[p])}(t,m)})),m},e}(),G=function(){function e(e){this.url=e||O.location.href}return e.prototype.params=function(e){var t=this,r={};if(e&&o(e)){var n=this.url.split("?")[0].split("/").reverse();""===n[0]&&n.shift(),v(e.split("/").reverse(),(function(e,t){var o=RegExp("{([\\S\\s]*?)}").exec(e);Array.isArray(o)&&(r[o[1]]=n[t])}))}return function(){var e=t.url.split("?")[1];if(!e)return t;v(e.split("&"),(function(e){var t=e.split("=");r[t[0]]=(t[1]||"").split("#")[0]}))}(),r},e.prototype.add=function(e){var t=[];v(Object.keys(e),(function(r){t.push(r+"="+e[r])}));var r=t.join("&");return this.url.includes("?")?"&"+r:"?"+r},e.prototype.remove=function(e){return e},e}(),U=function(){function e(e){this.scripts=[],this.styles=[],this.events=[],this.name=e.name,this.path=e.path,Object.assign(this,e),this.data=_.transform(this.data||{})}return Object.defineProperty(e.prototype,"isReady",{get:function(){return!r(this.template)},enumerable:!1,configurable:!0}),e.prototype.export=function(e){var t=this;return n(e)?v(Object.keys(e),(function(r){t.data[r]=e[r],d(t.data,e,r)})):L.log('Invalid object for component.export(...), only "Object Literal" is allowed.')},e.prototype.destroy=function(){var e=this;if(!this.el)return!1;this.emit("beforeDestroy");var t=this.el.parentElement;t&&t.removeChild(this.el),v(this.events,(function(t){return e.off(t.eventName,t.callback)})),this.events=[],this.emit("destroyed"),v(this.styles,(function(e){return v(y(O.head.children),(function(t){t===e&&O.removeChild(e)}))}))},e.prototype.params=function(){return(new G).params(this.route)},e.prototype.emit=function(e,t){j.Resolve("EventHandler").emit({eventName:e,attachedNode:this.el,init:t})},e.prototype.on=function(e,t){var r=j.Resolve("EventHandler").on(e,t,this.el);return this.events.push(r),r},e.prototype.off=function(e,t){j.Resolve("EventHandler").off(e,t,this.el),this.events=m(this.events,(function(r){return!(r.eventName==e&&r.callback==t)}))},e}(),J=function(){function o(e,t){this.components={},this.requests={},j.Register(this),this.bouer=e,this.delimiter=j.Resolve("DelimiterHandler"),this.eventHandler=j.Resolve("EventHandler"),t&&(O.head.querySelector("base")||L.warn('“<base href="/" />” element not found, we advise to set it as first element of “<head></head>” to avoid errors when url have extension (.html).\n@see: https://www.w3schools.com/tags/tag_base.asp'),this.prepare(t))}return o.prototype.check=function(e){return e in this.components},o.prototype.request=function(t,n){var o=this;if(!r(this.requests[t]))return this.requests[t].push(n);this.requests[t]=[n],e(x(N(R.baseURI).baseURI,t),{headers:{"Content-Type":"text/plain"}}).then((function(e){if(!e.ok)throw e.statusText;return e.text()})).then((function(e){v(o.requests[t],(function(r){r.success(e,t)}))})).catch((function(e){v(o.requests[t],(function(r){r.fail(e,t)}))})).finally((function(){delete o.requests[t]}))},o.prototype.prepare=function(e,n){var o=this;v(e,(function(e){var i;return r(e.name)&&(e.name=t(9,"component-").toLowerCase()),r(e.path)&&r(e.template)?L.warn("The component with name “"+e.name+"”"+e.route?" and the route “"+e.route+"”":" has not “path” or “template” property defined, then it was ignored."):(Array.isArray(e.children)&&o.prepare(e.children,e),r(e.route)||(e.route="/"+x(r(n)?"":n.route,e.route)),r(o.components[e.name])?(j.Resolve("Routing").configure(o.components[e.name]=e),void((null===(i=(o.bouer.config||{}).preload)||void 0===i||i)&&(r(e.path)||o.request(e.path,{success:function(t){e.template=t},fail:function(e){L.error(A(e))}})))):L.warn("The component name “"+e.name+"” is already define, try changing the name."))}))},o.prototype.order=function(e,t,r){var n=this,o=e.nodeName.toLowerCase(),i=this.components,u=i[o];if(!u)return L.error("No component with name “"+o+"” registered.");var s=u,l=H.obj(t,{$this:t});if(s.template){var c=new U(s);return c.bouer=this.bouer,a(r)&&r(c),this.insert(e,c,l),void(!0===c.keepAlive&&(i[o]=c))}var f=this.$addEvent("requested",e,s);f&&f.emit(),this.request(s.path,{success:function(t){s.template=t;var u=new U(s);u.bouer=n.bouer,a(r)&&r(u),n.insert(e,u,l),!0===u.keepAlive&&(i[o]=u)},fail:function(e){L.error("Failed to request <"+o+"></"+o+"> component with path “"+s.path+"”."),L.error(A(e)),"function"==typeof s.failed&&s.failed(new CustomEvent("failed"))}})},o.prototype.find=function(e){for(var t=Object.keys(this.components),r=0;r<t.length;r++){var n=this.components[t[r]];if(e(n))return n}return null},o.prototype.$addEvent=function(e,t,r){var n=r[e];if("function"!=typeof n)return{emit:function(){}};var o=this.eventHandler.on(e,(function(e){return n(e)}),t).emit;return{emit:function(){o({eventName:e,attachedNode:t})}}},o.prototype.insert=function(o,i,a){var u,s=this,l=o.nodeName.toLowerCase(),c=o.parentElement;if(o.isConnected&&c){if(!i.isReady)return L.error("The <"+l+"></"+l+"> component is not ready yet to be inserted.");var p=g("div",(function(e){e.innerHTML=o.innerHTML,o.innerHTML=""})).build();(!1===(null!==(u=i.keepAlive)&&void 0!==u&&u)||r(i.el))&&g("body",(function(e){return e.innerHTML=i.template,v([].slice.apply(e.querySelectorAll("script")),(function(t){i.scripts.push(t),e.removeChild(t)})),v([].slice.apply(e.querySelectorAll('link[rel="stylesheet"]')),(function(t){i.styles.push(t),e.removeChild(t)})),v([].slice.apply(e.querySelectorAll("style")),(function(t){i.styles.push(t),e.removeChild(t)})),0===e.children.length?L.error("The component <"+l+"></"+l+"> seems to be empty or it has not a root element. Example: <div></div>, to be included."):e.children.length>1?L.error("The component <"+l+"></"+l+"> seems to have multiple root element, it must have only one root."):(i.el=e.children[0],s.$addEvent("created",i.el,i),void i.emit("created"))}));var h=i.el;v(y(o.attributes),(function(e){if(o.removeAttribute(e.name),"class"===e.nodeName)return o.classList.forEach((function(e){h.classList.add(e)}));if("data"===e.nodeName){if(0!==s.delimiter.run(e.value).length)return L.error("The “data” attribute cannot contain delimiter, source element: <"+l+"></"+l+">.");var t={},r=H.obj(a,{$this:a}),u=S.on("AfterGet",(function(e){t[e.propertyName]=void 0,f(t,e.propertyName,e)}));if(""===e.value)t=H.obj(s.bouer.data);else{var c=j.Resolve("Evaluator").exec({data:r,expression:e.value});if(!n(c))return L.error("Expected a valid Object Literal expression in “"+e.nodeName+"” and got “"+e.value+"”.");v(Object.keys(c),(function(e){e in t||(t[e]=c[e])}))}return u.off(),_.transform(t),v(Object.keys(t),(function(e){d(i.data,t,e)}))}h.attributes.setNamedItem(e)})),this.$addEvent("beforeMount",i.el,i),i.emit("beforeMount"),c.replaceChild(h,o);var m={};h.classList.forEach((function(e){return m[e]=!0}));var b=function(e,t){var r="STYLE"===e.nodeName,n=[];if(e.sheet){for(var o=e.sheet.cssRules,i=0;i<o.length;i++){var a=o.item(i);if(a){var u=a,s=u.selectorText.substr(1),l=m[s]?"":" ";u.selectorText="."+t+l+u.selectorText,r&&n.push(u.cssText)}}r&&(e.innerText=n.join("\n"))}};v(i.styles,(function(e){var r=e.cloneNode(!0),n=t(7,"bouer-s");if(r instanceof HTMLLinkElement&&r.hasAttribute("scoped")&&(r.onload=function(e){return b(e.target,n)}),O.head.appendChild(r),r.hasAttribute("scoped"))return h.classList.add(n),r instanceof HTMLStyleElement?b(r,n):void 0}));var w=function(e){try{j.Resolve("Evaluator").execRaw(e||"",i),s.$addEvent("mounted",i.el,i),i.emit("mounted"),s.$addEvent("beforeLoad",i.el,i),i.emit("beforeLoad"),j.Resolve("Compiler").compile({data:_.transform(i.data),el:h,componentContent:p,onDone:function(){s.$addEvent("loaded",i.el,i),i.emit("loaded")}}),V.observe(c,(function(){h.isConnected||i.destroy()}))}catch(e){L.error("Error in <"+l+"></"+l+"> component."),L.error(A(e))}};if(0===i.scripts.length)return w();var N=[],x=[],E=[],k={};return v(i.scripts,(function(e){""==e.src||e.innerHTML?N.push(e.innerHTML):E.push(e.src)})),0==E.length?w(N.join("\n\n")):v(E,(function(t,r){k[t]=!0,e(t,{headers:{"Content-Type":"text/plain"}}).then((function(e){if(!e.ok)throw e.statusText;return e.text()})).then((function(e){if(delete k[t],x[r]=e,0===Object.keys(k).length)return w(H.array(x,N).join("\n\n"))})).catch((function(e){e.stack="",L.error('Error loading the <script src="'+t+'"><\/script> in <'+l+"></"+l+"> component, remove it in order to be compiled."),L.log(e),s.$addEvent("failed",o,i).emit()}))}))}},o}(),W=function(){function e(e){this.delimiters=[],j.Register(this),this.delimiters=e}return e.prototype.add=function(e){this.delimiters.push(e)},e.prototype.remove=function(e){var t=this.delimiters.findIndex((function(t){return t.name===e}));this.delimiters.splice(t,1)},e.prototype.run=function(e){var t=this;if(r(e)||""===u(e))return[];var n=null,o=function(e,r){for(var o=0;o<t.delimiters.length;o++){var i=t.delimiters[o],a=e.match(RegExp(i.delimiter.open+"([\\S\\s]*?)"+i.delimiter.close,r||""));if(a)return n=i,a}},i=o(e,"g");return i?i.map((function(e){var t=o(e);return{field:t[0],expression:u(t[1]),delimiter:n}})):[]},e}(),z=function(){function e(e){j.Register(this),this.bouer=e,this.global=this.createWindow()}return e.prototype.createWindow=function(){var e;return g("iframe",(function(t,r){t.style.display="none!important",r.body.appendChild(t),e=t.contentWindow,r.body.removeChild(t)})),delete e.name,e},e.prototype.execRaw=function(e,t){try{var r="(function(){ "+e+" }).apply(this, arguments)";k.Function(r).apply(t||this.bouer)}catch(e){L.error(A(e))}},e.prototype.exec=function(e){var t=this,r=e.data,n=e.args,o=e.expression,i=e.isReturn,a=e.aditional,u=this.global,s={},l=H.obj(a||{});v(Object.keys(r),(function(e){d(l,r,e)})),v(Object.keys(this.bouer.globalData),(function(e){if(e in l)return L.warn('It was not possible to use the globalData property "'+e+'" because it already defined in the current scope.');d(l,t.bouer.globalData,e)}));var c,f=Object.keys(l);v(f,(function(e){delete u[e],e in u&&!0===p(u,e).configurable&&(s[e]=u[e]),e in s&&(u[e]=l[e]),d(u,l,e)}));try{var h='return(function(){"use strict"; '+(!1===i?"":"return")+" "+o+" }).apply(this, arguments)";c=this.global.Function(h).apply(this.bouer,n)}catch(e){L.error(A(e))}return v(f,(function(e){return delete u[e]})),c},e}(),Y=function(){function e(e){this.events=[],this.bouer=e,this.evaluator=j.Resolve("Evaluator"),j.Register(this),this.cleanup()}return e.prototype.handle=function(e,t){var n,o=this,i=e.ownerElement||e.parentNode,s=e.nodeName;if(r(i))return L.error("Invalid ParentElement of “"+s+"”");var c=u(null!==(n=e.nodeValue)&&void 0!==n?n:""),f=s.substr(T.on.length).split("."),d=f[0];if(f.shift(),""===c)return L.error("Expected an expression in the “"+s+"” and got an <empty string>.");E(e,i),i.removeAttribute(s);var p={},h=["capture","once","passive"];v(f,(function(e){e=e.toLocaleLowerCase(),-1!==h.indexOf(e)&&(p[e]=!0)})),this.on(d,(function(e){v(f,(function(t){v(Object.keys(e),(function(r){var n;(n=e[r]&&a(n)&&l(r)===l(t))&&n()}))}));var r=[e],n=o.evaluator.exec({data:t,expression:c,args:r,aditional:{event:e}});if(a(n))try{n.apply(o.bouer,r)}catch(e){L.error(A(e))}}),i,p)},e.prototype.on=function(e,t,r,n){var o=this,i={eventName:e,callback:function(e){return t.apply(o.bouer,[e])},attachedNode:r,emit:this.emit};return r?r.addEventListener(e,i.callback,n||!1):this.events.push(i),i},e.prototype.off=function(e,t,r){if(r)return r.removeEventListener(e,t);var n=-1;this.events.find((function(r,o){if(r.eventName===e&&t==r.callback)return n=o,!0})),this.events.splice(n,1)},e.prototype.emit=function(e){var t=this,r=e.eventName,n=e.init,o=e.attachedNode,i=new CustomEvent(r,n);if(o)return o.dispatchEvent(i);v(this.events,(function(n,o){var a;r===n.eventName&&(n.callback.call(t.bouer,i),!0===(null!==(a=e.once)&&void 0!==a&&a)&&t.events.splice(o,1))}))},e.prototype.cleanup=function(){var e=this;C((function(){e.events=m(e.events,(function(e){return!e.attachedNode||(!!e.attachedNode.isConnected||void 0)}))}),1e3)},e}(),K=function(){function e(e){this.defaultPage=null,this.notFoundPage=null,this.routeView=null,this.activeAnchors=[],this.base=null,j.Register(this),this.bouer=e,this.routeView=this.bouer.el.querySelector("[route-view]")}return e.prototype.init=function(){var e=this;if(!r(this.routeView)){this.routeView.removeAttribute("route-view");var t=O.head.querySelector("base");if(t){var n=t.attributes.href;if(!n)return L.error('The href="/" attribute is required in base element.');this.base=n.value,this.defaultPage&&this.navigate(O.location.href),k.addEventListener("popstate",(function(t){t.preventDefault(),e.navigate((t.state||{}).url||O.location.href)}))}}},e.prototype.navigate=function(e){var t,n=this;if(r(e))return L.log("Invalid url provided to the navigation method.");var o=N(e=u(e)),i=null===(t=(this.bouer.config||{}).usehash)||void 0===t||t,a=(i?o.hash:o.pathname).split("?")[0];"/"===a[a.length-1]&&(a=a.substr(0,a.length-1));var s=this.toPage(a);if(this.clear(),s&&(s||!e.endsWith(".html"))){var l=b(s.name).appendTo(this.routeView).build(),c=x(o.baseURI,i?"#":"",s.route);j.Resolve("ComponentHandler").order(l,{},(function(e){e.on("loaded",(function(){n.markActiveAnchors(c)}))})),O.title=s.title||O.title,this.pushState(o.href,O.title)}},e.prototype.pushState=function(e,t){e=N(e).href,k.history.pushState({url:e},t||"",e)},e.prototype.popState=function(e){r(e)&&(e=-1),k.history.go(e)},e.prototype.toPage=function(e){return""===e||"/"===e||e==="/"+x((this.base,"index.html"))?this.defaultPage:j.Resolve("ComponentHandler").find((function(t){if(!t.route)return!1;var r=t.route.replace(/{(.*?)}/gi,"[\\S\\s]{1,}");return!!Array.isArray(new RegExp("^"+r+"$").exec(e))}))||this.notFoundPage},e.prototype.markActiveAnchors=function(e){var t=this,r=(this.bouer.config||{}).activeClassName||"active-link",n=this.bouer.el.querySelectorAll("a");v(this.activeAnchors,(function(e){return e.classList.remove(r)})),this.activeAnchors=[],v(y(n),(function(n){n.href===e&&n.markable&&(n.classList.add(r),t.activeAnchors.push(n))}))},e.prototype.clear=function(){this.routeView.innerHTML=""},e.prototype.configure=function(e){return!0!==e.isDefault||r(this.defaultPage)?!0!==e.isNotFound||r(this.notFoundPage)?(!0===e.isDefault&&(this.defaultPage=e),void(!0===e.isNotFound&&(this.notFoundPage=e))):L.warn("There are multiple “NotFound Page” provided, check the “"+e.route+"” route."):L.warn("There are multiple “Default Page” provided, check the “"+e.route+"” route.")},e}(),Q=function(){var e=this;this.container={},this.run=function(t,r){var n=e.container[t];if(!n)return L.log("There is not interceptor for “"+t+"”.");for(var o=0;o<n.length;o++)(0,n[o])(r)},this.register=function(t,r){var n=e.container[t];if(!n)return e.container[t]=[r];n.push(r)},j.Register(this)},X=function(){function e(e,t){if(this.name="Bouer",this.version="3.0.0",this.components=[],this.dependencies={},t=t||{},this.config=t.config,this.components=t.components||[],this.dependencies=t.dependencies||{},this.interceptor=t.interceptor,Object.assign(this,t),r(e)||""===u(e))throw L.error("Invalid selector provided to the instance.");var n=this,o=O.querySelector(e);if(!o)throw L.error("Element with selector “"+e+"” not found.");var i=new P;new z(this),new I(this);var a=new Q;j.Register(this),n.beforeMount(o,n),this.el=o,"function"==typeof this.interceptor&&this.interceptor(a.register,this),this.data=_.transform(t.data||{}),this.globalData=_.transform(t.globalData||{}),n.mounted(n.el,n);var s=new W([{name:"bouer",delimiter:{open:"-e-",close:"-"}},{name:"common",delimiter:{open:"{{",close:"}}"}},{name:"html",delimiter:{open:"{{:html ",close:"}}"}}]);new Y(this),new M(this),this.routing=new K(this),new J(this,t.components);var l=new B(this);new F(this),new I(this),this.delimiters={add:s.add,remove:s.remove,get:function(){return s.delimiters.slice()}},this.$data={get:function(e){return e?i.data[e]:i.data},set:function(e,t,r){return e in i.data?L.log("There is already a data stored with this key “"+e+"”."):(!0===(null!=r&&r)&&_.transform(t),P.set("data",e,t))},unset:function(e){return delete i.data[e]}},this.$req={get:function(e){return e?i.req[e]:i.req},unset:function(e){return delete i.req[e]}},this.$wait={get:function(e){return e?i.wait[e]:i.wait},set:function(e,t){if(!(e in i.wait))return i.wait[e]={data:t,nodes:[]};var r=i.wait[e];return r.data=t,v(r.nodes,(function(e){e&&l.compile({el:e,data:_.transform(r.data)})}))},unset:function(e){return delete i.wait[e]}},n.beforeLoad(n.el,n),l.compile({el:this.el,data:this.data,onDone:function(){return n.loaded(n.el,n)}}),V.observe(this.el,(function(e){var t=e.mutation;!1===e.element.isConnected&&(n.destroyed(n.el,n),t.disconnect())})),this.routing.init(),O.head.querySelector("link[rel~='icon']")||g("link",(function(e){e.rel="icon",e.type="image/png",e.href="https://afonsomatelias.github.io/assets/bouer/img/short.png"})).appendTo(O.head)}return Object.defineProperty(e.prototype,"refs",{get:function(){var e={};return v(y(this.el.querySelectorAll("["+T.ref+"]")),(function(t){var r=u(t.attributes[T.ref].value)||t.name||"";return""===r?L.error("Expected an expression in “"+t.name+"” or at least “name” attribute to combine with “"+t.name+"”."):r in e?L.warn("The key “"+r+"” in “"+t.name+"” is taken, choose another key.",t):void(e[r]=t)})),e},enumerable:!1,configurable:!0}),e.prototype.toJsObj=function(e,t,r){return j.Resolve("Converter").htmlToJsObj(e,t,r)},e.prototype.setData=function(e,t){return _.setData(e,t||this.data)},e.prototype.watch=function(e,t,r){return j.Resolve("Binder").watch(e,t,r)},e.prototype.on=function(e,t,r,n){return j.Resolve("EventHandler").on(e,t,r,n)},e.prototype.off=function(e,t,r){return j.Resolve("EventHandler").off(e,t,r)},e.prototype.emit=function(e){return j.Resolve("EventHandler").emit(e)},e.prototype.lazy=function(e,t){var n,o=this;t=r(t)?500:t;var i=arguments[2];return function(){var r=arguments,a=function(){n=null,i||e.call(o,r)},u=i&&!n;clearTimeout(n),n=setTimeout(a,t),u&&e.call(o,r)}},e.prototype.beforeMount=function(e,t){},e.prototype.mounted=function(e,t){},e.prototype.beforeLoad=function(e,t){},e.prototype.loaded=function(e,t){},e.prototype.destroyed=function(e,t){},e}();return X}));
