!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Bouer=t()}(this,(function(){"use strict";function e(e,t){return fetch(e,t)}function t(e,t,r){for(var n="01234567890ABCDEFGHIJKLMNOPQRSTUVWXYZ",o=!1,i="",a=0;a<(e||8);a++){var s=Math.floor(Math.random()*n.length);i+=o?n[s].toLowerCase():n[s],o=!o}return(t||"")+i+(r||"")}function r(e){return void 0===e||null==e}function n(e){return"object"==typeof e&&"[object Object]"===String(e)}function o(e){return void 0!==e&&"string"==typeof e}function i(e){return!e||!n(e)||0===Object.keys(e).length}function a(e){return"function"==typeof e}function s(e){return e?e.trim():e}function u(e,t){return e.substr(0,t.length)===t}function c(e){return e.toLowerCase()}function l(e){return function(e){return"string"==typeof e||"number"==typeof e||"symbol"==typeof e||"boolean"==typeof e}(e)?String(e):n(e)?JSON.stringify(e):a(e.toString)?e.toString():String(e)}function f(e,t,r){return Object.defineProperty(e,t,r),e}function d(e,t,r){f(e,r,p(t,r))}function p(e,t){return Object.getOwnPropertyDescriptor(e,t)}function h(e,t,n){void 0===n&&(n=!1);var o=null;if(!e)return null;for(var i=0,a=t;i<a.length;i++){var s=a[i];if(o=e.attributes[s])break}return!r(o)&&n&&e.removeAttribute(o.name),o}function v(e,t,r){for(var n=0;n<e.length;n++)a(t)&&t.call(r,e[n],n)}function m(e){return e?[].slice.call(e):[]}function y(e,t){var r=x.createElement(e);a(t)&&t(r,x);var n={appendTo:function(e){return e.appendChild(r),n},build:function(){return r}};return n}function b(e,t){var r=x.createElement(e);a(t)&&t(r,x);var n={appendTo:function(e){return e.appendChild(r),n},build:function(){return r}};return n}function g(e,t){v(Object.keys(e),(function(r){var o=e[r];if(r in t)return n(o)?g(o,t[r]):t[r]=o;d(t,e,r)}))}function w(e,t){return f(e,"isConnected",{get:function(){return t.isConnected}}),e}function N(e){var t=e;"documentMode"in x&&(O.setAttribute("href",t),t=O.href),O.setAttribute("href",t);var r=O.hostname;!("[::1]"===O.hostname)&&r.indexOf(":")>-1&&(r="["+r+"]");var n={href:O.href,baseURI:O.baseURI,protocol:O.protocol?O.protocol.replace(/:$/,""):"",host:O.host,search:O.search?O.search.replace(/^\?/,""):"",hash:O.hash?O.hash.replace(/^#/,""):"",hostname:r,port:O.port,pathname:"/"===O.pathname.charAt(0)?O.pathname:"/"+O.pathname,origin:""};return n.origin=n.protocol+"://"+n.host,n}function E(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=e.split(/\/\//),o=n.length>1?n[0]+"//":"",i=""===o?n[0]:n[1],a=i.split(/\//),u=[];return v(a,(function(e){return s(e)?u.push(e):null})),v(t,(function(e){return v(e.split(/\//),(function(e){return s(e)?u.push(e):null}))})),o+u.join("/")}function A(e,t){return e.stack="",e}var x=document,T=globalThis,O=b("a").build(),k=setInterval,j={ignore:"e-ignore",build:"e-build",array:"e-array",if:"e-if",elseif:"e-else-if",else:"e-else",show:"e-show",req:"e-req",tmp:"e-tmp",fill:"e-fill",for:"e-for",use:"e-use",id:"e-id",order:"e-order",filter:"e-filter",data:"data",def:"e-def",wait:"wait-data",toggle:"e-toggle",content:"e-content",bind:"e-bind",property:"e-",anm:"e-anm",skeleton:"e-skeleton",route:"route-view",href:":href",ihref:"!href",entry:"e-entry",component:":name",on:"on:",tagContent:"content",ref:"ref",put:"put",connector:"connector",events:{compile:"compile",request:"request",response:"response",fail:"fail",done:"done"},check:function(e,t){return u(e.nodeName,t)},isConstant:function(e){var t=this;return-1!==Object.keys(this).map((function(e){return t[e]})).indexOf(e)}},R=function(){function e(){}return e.Register=function(e){this.container[e.__proto__.constructor.name]=e},e.Resolve=function(e){return this.container[e]},e.Dispose=function(e){delete this.container[e]},e.container={},e}(),C=function(){function e(){}return e.observe=function(e,t){var r=new MutationObserver((function(n){t({element:e,mutation:r,records:n})}));r.observe(e,{childList:!0})},e}();function S(e,t,r){if(r||2===arguments.length)for(var n,o=0,i=t.length;o<i;o++)!n&&o in t||(n||(n=Array.prototype.slice.call(t,0,o)),n[o]=t[o]);return e.concat(n||Array.prototype.slice.call(t))}var D=function(){function e(){}return e.log=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];console.log.apply(console,S([e.prefix],t,!1))},e.error=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];console.error.apply(console,S([e.prefix],t,!1))},e.warn=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];console.warn.apply(console,S([e.prefix],t,!1))},e.info=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];console.info.apply(console,S([e.prefix],t,!1))},e.prefix="[Bouer]",e}(),V=function(){function e(){}return e.on=function(e,t){return this[e].push(t),{eventName:e,callback:t}},e.off=function(e,t){var r=this[e];return r.splice(r.indexOf(t),1),!0},e.once=function(t,r){var n={},o=e.on(t,(function(e,t,r){n.onemit&&n.onemit(e,t,r)}));try{r(n)}catch(e){D.error(A(e))}finally{e.off(t,o.callback)}},e.emit=function(e,t,r,n){try{v(this[e],(function(e){return e(t,r,n)}))}catch(e){D.error(A(e))}},e.BeforeGet=[],e.AfterGet=[],e.BeforeSet=[],e.AfterSet=[],e.BeforeArrayChanges=[],e.AfterArrayChanges=[],e}(),L=function(){function e(e){this.binds=[],this.DEFAULT_BINDER_PROPERTIES={text:"value",number:"valueAsNumber",checkbox:"checked",radio:"checked"},this.BindingDirection={fromInputToData:"to-data-property",fromDataToInput:"to-input"},R.Register(this),this.evaluator=R.Resolve("Evaluator"),this.bouer=e,this.cleanup()}return e.prototype.create=function(e){var t,o=this,i=e.node,u=e.data,c=e.fields,f=e.eReplace,d=s(null!==(t=i.nodeValue)&&void 0!==t?t:""),p=i.nodeName,h=i.ownerElement||i.parentNode,m=e.onChange||function(e,t){},y={name:p,value:d,bindOptions:e,boundNode:i};if(p.substr(0,j.bind.length)===j.bind){var g="";g=j.bind===p?this.DEFAULT_BINDER_PROPERTIES[h.type]||"value":p.split(":")[1];var w=function(e,t){switch(e){case o.BindingDirection.fromDataToInput:return h[g]=t;case o.BindingDirection.fromInputToData:return u[d]=h[g]}};V.once("AfterGet",(function(e){e.onemit=function(e){o.binds.push(e.watch((function(e){w(o.BindingDirection.fromDataToInput,e),m(e,i)}),i))};var t=o.evaluator.exec({expression:d,data:u});h[g]=n(t)?l(t):r(t)?"":t}));var N=[h.nodeName.toLowerCase(),"propertychange","change"],E=function(){w(o.BindingDirection.fromInputToData,h[g])};return v(N,(function(e){return h.addEventListener(e,E,!1)})),h.removeAttribute(i.nodeName),y}var A=i;p.substr(0,j.property.length)===j.property&&r(f)&&(y.name=p.substr(j.property.length),h.setAttribute(y.name,d),A=h.attributes[y.name],h.removeAttribute(i.nodeName));var x=function(){var e=y.value,t=!1;if(v(c,(function(n){var s=n.delimiter;s&&"html"===s.name&&(t=!0);var c=o.evaluator.exec({expression:n.expression,data:u});c=r(c)?"":c,e=e.replace(n.field,l(c)),s&&a(s.action)&&(e=s.action(e,i,u))})),t){var n=b("div",(function(t){t.innerHTML=e})).build().children[0];h.appendChild(n)}else A.nodeValue=e};return V.once("AfterGet",(function(e){e.onemit=function(e){o.binds.push(e.watch((function(e){x(),m(e,i)}),i))},x()})),y.boundNode=A,y},e.prototype.watch=function(e,t,r){var n=null,o=r||this.bouer.data;return V.once("AfterGet",(function(r){r.onemit=function(e){return n=e.watch(t)},o[e]})),n},e.prototype.cleanup=function(){var e=this;k((function(){var t=[];v(e.binds,(function(e){return e.node?e.node.isConnected?t.push(e):void e.destroy():t.push(e)})),e.binds=t}),1e3)},e}(),I=function(){function e(e){R.Register(this),this.bouer=e}return e.prototype.create=function(e){var r=x.createComment("e");return r.id=e||t(8),r},e.prototype.get=function(e,t){if(!r(e))return t=t||this.bouer.el,this.retrieve(t).find((function(t){return t.id===e}))},e.prototype.retrieve=function(e){if(!e)return[];for(var t,r=x.createNodeIterator(e,NodeFilter.SHOW_COMMENT,(function(){return NodeFilter.FILTER_ACCEPT})),n=[];t=r.nextNode();)"id"in t&&n.push(t);return n},e}(),q=function(){function e(){}return e.obj=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n={};return v(e,(function(e){r(e)||v(Object.keys(e),(function(t){r(e[t])||d(n,e,t)}))})),n},e.addToObj=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return v(t,(function(t){r(t)||v(Object.keys(t),(function(n){r(t[n])||d(e,t,n)}))})),e},e.array=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=[];return v(e,(function(e){if(!r(e))return Array.isArray(e)?void v(Object.keys(e),(function(t){var o=e[t];r(o)||(Array.isArray(o)?[].push.apply(n,o):n.push(o))})):n.push(e)})),n},e}(),M=function(e,t,r){var n=this;this.destroy=function(){var e=n.reactive.watches.indexOf(n);-1!==e&&n.reactive.watches.splice(e,1),n.onDestroy&&n.onDestroy()},this.reactive=e,this.property=e.propertyName,this.callback=t,r&&(this.node=r.node,this.onDestroy=r.onDestroy)},_=function(){function e(t){var o=this;this.watches=[],this.get=function(){V.emit("BeforeGet",o);var e=o.propertyValue;return V.emit("AfterGet",o),e},this.set=function(t){var i=o.propertyValue;if(i!==t){if(V.emit("BeforeSet",o),n(t)||Array.isArray(t)){if(typeof o.propertyValue!=typeof t)return D.error(new TypeError("Cannot set “"+typeof t+"” in “"+o.propertyName+"” property."));if(Array.isArray(t)){e.transform(t,o);var a=o.propertyValue;a.splice(0,a.length),a.push.apply(a,t)}else n(t)&&(t instanceof Node?o.propertyValue=t:(e.transform(t),r(o.propertyValue)?o.propertyValue=t:g(t,o.propertyValue)))}else o.propertyValue=t;V.emit("AfterSet",o),v(o.watches,(function(e){return e.callback(o.propertyValue,i)}))}},this.propertyName=t.propertyName,this.propertySource=t.sourceObject,this.propertyDescriptor=p(this.propertySource,this.propertyName),this.propertyValue=this.propertyDescriptor.value}var t;return e.prototype.watch=function(e,t){var r=new M(this,e,{node:t});return this.watches.push(r),r},e.setData=function(t,r){return n(t)?n(r)&&null!==r?D.error(new TypeError('Invalid targetObject value, expected an "Object Literal" and got "'+typeof r+'".')):(e.transform(t),v(Object.keys(t),(function(e){return d(r,t,e)})),r):D.error(new TypeError('Invalid inputData value, expected an "Object Literal" and got "'+typeof t+'".'))},t=e,e.transform=function(o,i){if(Array.isArray(o)){if(null==i)return D.warn("Cannot transform this array to a reactive one because no reactive objecto was provided"),o;var a=o,s={},u=a.__proto__=Object.create(Array.prototype);return v(["push","pop","unshift","shift","splice"],(function(t){s[t]=a[t].bind(a),u[t]=function(){var r=a.slice();switch(V.emit("BeforeArrayChanges",i,t,{arrayNew:r,arrayOld:r}),t){case"push":case"unshift":v(m(arguments),(function(t){(n(t)||Array.isArray(t))&&e.transform(t)}))}var o=s[t].apply(a,arguments);return V.emit("AfterArrayChanges",i,t,{arrayNew:r,arrayOld:r}),o}})),a}return n(o)?(v(Object.keys(o),(function(i){var a=o;if(!r(p(o,i).value)){var s=new e({propertyName:i,sourceObject:o});f(o,i,s);var u=a[i];n(u)?t.transform(u):Array.isArray(u)&&(t.transform(u,s),v(u,(function(e){return t.transform(e)})))}})),o):o},e}(),P=function(){function e(){this.wait={},this.data={},this.req={},R.Register(this)}return e.set=function(t,r,n){if("wait"===t)return D.warn("Only “get” is allowed for type of data");R.Resolve(e.name)[t][r]=n},e.get=function(t,r,n){var o=R.Resolve(e.name)[t][r];return!0===n&&e.unset(t,r),o},e.unset=function(t,r){delete R.Resolve(e.name)[t][r]},e}(),H=function(){function t(e,t){this.errorMsgEmptyNode=function(e){return new SyntaxError("Expected an expression in “"+e.nodeName+"” and got an <empty string>.")},this.errorMsgNodeValue=function(e){var t;return new SyntaxError("Expected an expression in “"+e.nodeName+"” and got “"+(null!==(t=e.nodeValue)&&void 0!==t?t:"")+"”.")},this.bouer=e,this.compiler=t,this.evaluator=R.Resolve("Evaluator"),this.delimiter=R.Resolve("DelimiterHandler"),this.comment=R.Resolve("CommentHandler"),this.binder=R.Resolve("Binder"),this.eventHandler=R.Resolve("EventHandler")}return t.prototype.toOwnerNode=function(e){return e.ownerElement||e.parentNode},t.prototype.ignore=function(e){e.nodeValue="true"},t.prototype.if=function(e,t){var r,n,o=this,i=this.toOwnerNode(e),a=i.parentElement,u=[],c=this.comment.create(),l=e.nodeName,f=function(){};if(a&&l!==j.elseif&&l!==j.else){var d=i,p=[],m=function(){if(null==d)return"break";var e=h(d,["e-if","e-else-if","e-else"]);return e?"e-else"!==e.nodeName&&""===s(null!==(r=e.nodeValue)&&void 0!==r?r:"")?{value:D.error(y.errorMsgEmptyNode(e))}:0!==y.delimiter.run(null!==(n=e.nodeValue)&&void 0!==n?n:"").length?{value:D.error(y.errorMsgNodeValue(e))}:(u.push({node:e,element:d}),w(d,a),w(e,a),"e-else"===e.nodeName?(d.removeAttribute(e.nodeName),"break"):(V.once("AfterGet",(function(r){r.onemit=function(t){-1===p.findIndex((function(e){return e.reactive.propertyName==t.propertyName}))&&p.push({attr:e,reactive:t})},o.evaluator.exec({data:t,expression:e.value})})),void d.removeAttribute(e.nodeName))):"break"},y=this;do{var b=m();if("object"==typeof b)return b.value;if("break"===b)break}while(d=d.nextElementSibling);v(p,(function(e){return o.binder.binds.push(e.reactive.watch((function(){return f()}),e.attr))})),(f=function(){v(u,(function(e){e.element.parentElement&&(c.isConnected?a.removeChild(e.element):a.replaceChild(c,e.element))}));var e=u.map((function(e,t){var r=e.node.value;switch(e.node.name){case j.if:return"if("+r+"){ _cb("+t+"); }";case j.elseif:return"else if("+r+"){ _cb("+t+"); }";case j.else:return"else{ _cb("+t+"); }"}})).join(" ");o.evaluator.exec({data:t,isReturn:!1,expression:e,aditional:{_cb:function(e){var r=u[e].element;a.replaceChild(r,c),o.compiler.compile({el:r,data:t})}}})})()}},t.prototype.show=function(e,t){var r,n=this,o=this.toOwnerNode(e),i=s(null!==(r=e.nodeValue)&&void 0!==r?r:""),a=0!==this.delimiter.run(i).length;if(""===i)return D.error(this.errorMsgEmptyNode(e));if(a)return D.error(this.errorMsgNodeValue(e));var u=function(e){var r=n.evaluator.exec({expression:i,data:t});e.style.display=r?"":"none"};w(e,o);var c=this.binder.create({data:t,node:e,fields:[{expression:i,field:i}],onChange:function(){return u(o)}});u(o),o.removeAttribute(c.boundNode.nodeName)},t.prototype.for=function(e,t){var n,o=this,i=this.toOwnerNode(e),a=i.parentElement,u=this.comment.create(),c=e.nodeName,f=s(null!==(n=e.nodeValue)&&void 0!==n?n:""),d=[],p=function(){};if(a){if(""===f)return D.error(this.errorMsgEmptyNode(e));if(!f.includes(" of ")&&!f.includes(" in "))return D.error(new SyntaxError("Expected a valid “for” expression in “"+c+"” and got “"+f+'”.\nValid: e-for="item of items".'));var h=this.delimiter.run(f);0!==h.length&&this.binder.create({data:t,fields:h,eReplace:!0,node:e,onChange:function(){return p()}}),i.removeAttribute(c);var m=i.cloneNode(!0);a.replaceChild(u,i),w(m,u),w(e,u);var y=V.on("AfterGet",(function(t){return o.binder.binds.push(t.watch((function(){return p()}),e))})),b=V.on("AfterArrayChanges",(function(){return p()}));this.binder.binds.push(new M(new _({propertyName:"_",sourceObject:{_:[]}}),(function(){}),{node:e,onDestroy:function(){return V.off("AfterArrayChanges",b.callback)}})),(p=function(){var n,i=(f=s(null!==(n=e.nodeValue)&&void 0!==n?n:"")).split("|").map((function(e){return s(e)})),p=i[0].replace(/\(|\)/g,"");i.shift();var h=" of ",y=p.split(h);y.length>1||(y=p.split(h=" in "));var b=y[0],g=y[1],w=b.split(",").map((function(e){return s(e)})),N="let "+b+(b.includes(",")?"=0":"")+";",E=w.length>1;p=[E?w[0]:b,"_flt("+g+")"].join(h),v(d,(function(e){e.parentElement&&a.removeChild(e)})),d=[],o.evaluator.exec({data:t,isReturn:!1,expression:N+"for("+p+"){  _each("+b+(E?"++":"")+")}",aditional:{_each:function(e,r){var n=q.obj(t);n[w[0]]=e,E&&(n[w[1]]=r);var i=a.insertBefore(m.cloneNode(!0),u);o.compiler.compile({el:i,data:n}),d.push(i)},_flt:function(e){var n=q.array(e),a=function(e){return i.find((function(t){return t.substr(0,e.length)===e}))},u=a("filter");if(u){var d=u.split(":").map((function(e){return s(e)}));1==d.length?D.error(new SyntaxError("Invalid “"+c+"” filter expression “"+f+"”, at least a filter-value and filter-keys, or a filter-function must be provided")):n=function(e,n){var i=n[1],a=n[2];if(r(i)||""===i)return D.error(new SyntaxError("Invalid filter-value in “"+c+"” with “"+f+"” expression.")),e;if("function"==typeof(i=o.evaluator.exec({data:t,expression:i})))e=i(e);else{if(r(a)||""===a)return D.error(new SyntaxError("Invalid filter-keys in “"+c+"” with “"+f+"” expression, at least one filter-key to be provided.")),e;var u=[];v(e,(function(e){for(var t=0,r=a.split(",").map((function(e){return s(e)}));t<r.length;t++){var n=r[t];if(!l(o.evaluator.exec({data:e,expression:n})).includes(i))break;u.push(e)}})),e=u}return e}(n,d)}var p=a("order");if(p){var h=p.split(":").map((function(e){return s(e)}));1==h.length?D.error(new SyntaxError("Invalid “"+c+"” order  expression “"+f+"”, at least the order type must be provided")):n=function(e,t,n){return t||(t="asc"),e.sort((function(e,o){var i=function(e,n){if(r(e)||r(n))return 0;switch(t.toLowerCase()){case"asc":return e?1:-1;case"desc":return n?-1:1;default:return D.log("The “"+t+"” order type is invalid: “"+f+"”. Available types are: “asc”  for order ascendent and “desc” for order descendent."),0}};return n?i(e[n]>o[n],o[n]<e[n]):i(e>o,o<e)}))}(n,h[1],h[2])}return n}}})})(),V.off("AfterGet",y.callback)}},t.prototype.def=function(e,t){var r,o=this.toOwnerNode(e),i=s(null!==(r=e.nodeValue)&&void 0!==r?r:""),a=0!==this.delimiter.run(i).length;if(""===i)return D.error(this.errorMsgEmptyNode(e));if(a)return D.error(this.errorMsgNodeValue(e));var u=this.evaluator.exec({data:t,expression:i});if(!n(u))return D.error(new TypeError("Expected a valid Object Literal expression in “"+e.nodeName+"” and got “"+i+"”."));this.bouer.setData(u,t),o.removeAttribute(e.nodeName)},t.prototype.content=function(e){var t,r=this.toOwnerNode(e),n=s(null!==(t=e.nodeValue)&&void 0!==t?t:"");if(""===n)return D.error(this.errorMsgEmptyNode(e));r.innerText=n,r.removeAttribute(e.nodeName)},t.prototype.bind=function(e,t){var r,n=this.toOwnerNode(e),o=s(null!==(r=e.nodeValue)&&void 0!==r?r:""),i=0!==this.delimiter.run(o).length;return""===o?D.error(this.errorMsgEmptyNode(e)):i?D.error(this.errorMsgNodeValue(e)):(this.binder.create({node:w(e,n),fields:[{field:o,expression:o}],data:t}),void n.removeAttribute(e.nodeName))},t.prototype.property=function(e,t){var r,o=this,i=this.toOwnerNode(e),a=s(null!==(r=e.nodeValue)&&void 0!==r?r:""),u=0!==this.delimiter.run(a).length,c=function(e){},l=function(e){var t;return new TypeError("Invalid value, expected an Object/Object Literal in “"+e.nodeName+"” and got “"+(null!==(t=e.nodeValue)&&void 0!==t?t:"")+"”.")};if(""===a)return D.error(l(e));if(!u){var f=this.evaluator.exec({data:t,expression:a});if(!n(f))return D.error(l(e));this.binder.create({data:t,node:w(e,i),eReplace:!1,fields:[{expression:a,field:a}],onChange:function(){return c(o.evaluator.exec({data:t,expression:a}))}}),i.removeAttribute(e.nodeName),(c=function(t){var r=e.nodeName.substr(j.property.length),n=i.attributes[r];if(n||(i.setAttribute(r,""),n=i.attributes[r]),v(Object.keys(t),(function(e){if(!t[e])return n.value=s(n.value.replace(e,""));n.value=n.value.includes(e)?n.value:s(n.value+" "+e)})),""===n.value)return i.removeAttribute(r)})(f)}},t.prototype.data=function(e,t){var r,o=this.toOwnerNode(e),i=s(null!==(r=e.nodeValue)&&void 0!==r?r:""),a=0!==this.delimiter.run(i).length,u={};if(a)return D.error(new SyntaxError("The “data” attribute cannot contain delimiter."));o.removeAttribute(e.nodeName);var c=q.obj(t,{$this:t}),l=V.on("AfterGet",(function(e){u[e.propertyName]=void 0,f(u,e.propertyName,e)}));if(""===i)u=q.obj(this.bouer.data);else{var d=this.evaluator.exec({data:c,expression:i});if(!n(d))return D.error(new TypeError("Expected a valid Object Literal expression in “"+e.nodeName+"” and got “"+i+"”."));v(Object.keys(d),(function(e){e in u||(u[e]=d[e])}))}V.off("AfterGet",l.callback);var p=e.nodeName.split(":")[1];return p&&(p=p.replace(/\[|\]/g,""),P.set("data",p,u)),_.transform(u),this.compiler.compile({data:u,el:o})},t.prototype.href=function(e,t){var r,n,o=this.toOwnerNode(e),i=e.nodeName,a=s(null!==(r=e.nodeValue)&&void 0!==r?r:"");if(""===a)return D.error(this.errorMsgEmptyNode(e));o.removeAttribute(e.nodeName);var u=E(null===(n=(this.bouer.config||{}).usehash)||void 0===n||n?"#":"",a);o.setAttribute("href",u);var c=o.attributes.href,l=this.delimiter.run(a);0!==l.length&&this.binder.create({data:t,node:w(c,o),fields:l}),o.addEventListener("click",(function(e){e.preventDefault(),R.Resolve("Routing").navigate(c.value)}),!1),c.markable=":"===i[0]},t.prototype.entry=function(e,t){var r,n=this.toOwnerNode(e),o=s(null!==(r=e.nodeValue)&&void 0!==r?r:""),i=0!==this.delimiter.run(o).length;return""===o?D.error(this.errorMsgEmptyNode(e)):i?D.error(this.errorMsgNodeValue(e)):(n.removeAttribute(e.nodeName),void R.Resolve("ComponentHandler").prepare([{name:o,template:n.outerHTML,data:t}]))},t.prototype.put=function(e,t){var r,n=this.toOwnerNode(e),o=s(null!==(r=e.nodeValue)&&void 0!==r?r:""),i=function(){};if(""===o)return D.error(this.errorMsgEmptyNode(e),"Direct <empty string> injection value is allowed, only with a delimiter.");var a=this.delimiter.run(o);n.removeAttribute(e.nodeName),0!==a.length&&this.binder.create({data:t,node:w(e,n),fields:a,onChange:function(){return i()}}),(i=function(){var r;if(n.innerHTML="",""!==(o=s(null!==(r=e.nodeValue)&&void 0!==r?r:""))){var i=y(o).appendTo(n).build();R.Resolve("ComponentHandler").order(i,t)}})()},t.prototype.req=function(t,r){var n,o=this,i=this.toOwnerNode(t),a=t.nodeName,u={},c=s(null!==(n=t.nodeValue)&&void 0!==n?n:""),l=function(){};if(!c.includes(" of ")&&!c.includes(" as "))return D.error(new SyntaxError("Expected a valid “for” expression in “"+a+"” and got “"+c+'”.\nValid: e-req="item of [url]".'));c.includes(" of ")&&w(i,i.parentNode),w(t,i);var f=this.delimiter.run(c);0!==f.length&&this.binder.create({data:r,node:t,fields:f,eReplace:!1,onChange:function(){return l()}}),i.removeAttribute(t.nodeName);var p=function(e){var t=i.attributes[j.on+e];return t&&o.eventHandler.handle(t,r),{emit:function(t){o.eventHandler.emit({attachedNode:i,eventName:e,arguments:t})}}},h=R.Resolve("Interceptor"),v=p(j.events.request),m=p(j.events.response),y=p(j.events.fail),b=p(j.events.done);(l=function(){var n=(c=s(t.nodeValue||"")).split("|").map((function(e){return s(e)})),a=n[0].replace(/\(|\)/g,"");n.shift();var l=" of ",f=a.split(l);f.length>1||(f=a.split(l=" as "));var g=s(l),w=t.nodeName.split(":")[1];w=w?w.replace(/\[|\]/g,""):"",v.emit([]),h.run("req",{http:e,type:g,path:f[1].replace(/\[|\]/g,""),success:function(e){var t;if(!e)return D.error(new TypeError("the “success” parameter must be an object containing “data” property. Example: { data: {} | [] }"));if(!("data"in e))return D.error(new SyntaxError("the “success” parameter must be contain the “data” property. Example: { data: {} | [] }"));if("of"===g&&!Array.isArray(e.data))return D.error(new TypeError('Using e-ref="... “of” ..." the response must be a list of items, and got “'+typeof e.data+"”."));if("as"===g&&"object"!=typeof e.data)return D.error(new TypeError('Using e-ref="... “as” ..." the response must be a list of items, and got “'+typeof e.data+"”."));if(_.transform(e),m.emit([e]),"data"in u)return u.data=e.data;switch(u.data=void 0,d(u,e,"data"),w&&P.set("req",w,e),g){case"as":var n=s(f[0].split(",")[0].replace(/\(|\)/g,""));return o.compiler.compile({el:i,data:q.obj((t={},t[n]=e.data,t),r),onDone:function(e,t){p(j.events.compile).emit([t])}});case"of":var a=c.replace(f[1],"_response_");return i.setAttribute(j.for,a),o.compiler.compile({el:i,data:q.obj({_response_:e.data},r),onDone:function(e,t){p(j.events.compile).emit([t])}})}},fail:function(e){return y.emit([e])},done:function(){return b.emit([])}})})()},t.prototype.wait=function(e){var t,r=this,n=this.toOwnerNode(e),o=s(null!==(t=e.nodeValue)&&void 0!==t?t:""),i=0!==this.delimiter.run(o).length,a=R.Resolve("DataStore");if(""===o)return D.error(this.errorMsgEmptyNode(e));if(i)return D.error(this.errorMsgNodeValue(e));n.removeAttribute(e.nodeName);var u=a.wait[o];if(u){if(u.nodes.push(n),!u.data)return;return v(u.nodes,(function(e){r.compiler.compile({el:e,data:_.transform(u.data)})}))}return a.wait[o]={nodes:[n]}},t.prototype.skeleton=function(e,t){D.warn("e-skeleton not implemented yet.")},t}(),B=function(){function e(e){this.NODES_TO_IGNORE_IN_COMPILATION={SCRIPT:1,"#comment":8},R.Register(this),this.bouer=e,this.binder=R.Resolve("Binder"),this.delimiter=R.Resolve("DelimiterHandler"),this.eventHandler=R.Resolve("EventHandler"),this.component=R.Resolve("ComponentHandler"),this.directive=new H(e,this)}return e.prototype.compile=function(e){var t=this,r=e.el,n=e.data||this.bouer.data;if(this.analize(r.outerHTML)){var i=function(n,a){if(!(n.nodeName in t.NODES_TO_IGNORE_IN_COMPILATION)){if(n instanceof Element){if(j.ignore in n.attributes)return t.directive.ignore(n);if(n.localName===j.tagContent&&e.componentContent){var s=function(e,t){v(m(e.childNodes),(function(e){var n=e.cloneNode(!0);r.insertBefore(n,t),i(n,a)})),r.removeChild(t)};if(n.hasAttribute("default"))return s(e.componentContent,n);if(n.hasAttribute("target")){var c=n.attributes.target;return v(m(e.componentContent.children),(function(e){e.localName===j.tagContent&&e.getAttribute("target")!==c.value||s(e,n)}))}}if(j.def in n.attributes&&t.directive.def(n.attributes[j.def],a),j.entry in n.attributes&&t.directive.entry(n.attributes[j.entry],a),j.wait in n.attributes)return t.directive.wait(n.attributes[j.wait]);if(j.for in n.attributes)return t.directive.for(n.attributes[j.for],a);if(j.if in n.attributes)return t.directive.if(n.attributes[j.if],a);(j.elseif in n.attributes||j.else in n.attributes)&&D.warn('The "'+j.elseif+'" or "'+j.else+'" requires an element with "'+j.if+'" above.'),j.show in n.attributes&&t.directive.show(n.attributes[j.show],a);var l=null;if((l=n.attributes[j.req])||(l=m(n.attributes).find((function(e){return j.check(e,j.req)}))))return t.directive.req(l,a);if(t.component.check(n.localName))return t.component.order(n,a);var f;if(f=m(n.attributes).find((function(e){var t=e.name;return t===j.data||u(t,j.data+":")})))return t.directive.data(f,a);if(j.put in n.attributes)return t.directive.put(n.attributes[j.put],a);v(m(n.attributes),(function(e){i(e,a)}))}if(j.check(n,j.href)||j.check(n,j.ihref))return t.directive.href(n,a);if(j.check(n,j.content))return t.directive.content(n);if(j.check(n,j.bind))return t.directive.bind(n,a);if(j.check(n,j.property)&&!j.isConstant(n.nodeName)&&t.directive.property(n,a),j.check(n,j.on))return t.eventHandler.handle(n,a);var d;o(n.nodeValue)&&(d=t.delimiter.run(n.nodeValue))&&0!==d.length&&t.binder.create({node:w(n,r),fields:d,data:a}),v(m(n.childNodes),(function(e){return i(e,a)}))}};i(r,n),a(e.onDone)&&e.onDone.call(this.bouer,r)}},e.prototype.analize=function(e){return!0},e}(),G=function(){function e(e){R.Register(this),this.bouer=e}return e.prototype.htmlToJsObj=function(e,t,s){var u=void 0,c=this;if(e instanceof Element)u=e;else{if(n(e))return e;if(o(e))try{u=this.bouer.el.querySelector(e)}catch(t){return e}}if(r(u))throw D.error(new TypeError("Invalid element passed in app.toJsObj(...)."));var l=((t=t||{}).names||"[name]").replace(/\[|\]/g,"").split(","),f=(t.values||"[value]").replace(/\[|\]/g,"").split(","),d=function(e,t){return t in e?e[t]:e.getAttribute(t)||e.innerText},p=function(e){var t={},r={BUTTON:!0},n={checkbox:!0,radio:!0};return function e(o){var i=h(o,l);if(i){var u=i.value;if(!0===r[o.tagName])return;if(o instanceof HTMLInputElement&&!0===n[o.type]&&!1===o.checked)return;var p=t[u],y=o.hasAttribute(j.array),b=function(e){var t=void 0;return f.find((function(r){return!!(t=d(e,r))})),t}(o);t[u]=y?p?q.array(p,b):[b]:p?q.array(p,b):b,a(s)&&s.call(c,t,u,b,o)}v(m(o.children),(function(t){h(t,[j.build])||e(t)}))}(e),t},y=p(u);return v(m(u.querySelectorAll("["+j.build+"]")),(function(e){var t=d(e,j.build),o=e.hasAttribute(j.array),u=p(e);(function(e){if(i(e))return!1;for(var t=!1,n=Object.keys(e),o=0;o<n.length;o++)if(!r(n[o])){t=!0;break}return t})(u)&&function t(l,f){var d=l.split("."),p=d[0];d.shift();var h=f[p];return r(h)&&(f[p]={}),0===d.length?(o?n(h)&&!i(h)?f[p]=[q.obj(h,u)]:Array.isArray(h)?h.push(u):f[p]=[u]:r(h)?f[p]=u:f[p]=q.obj(h,u),void(a(s)&&s.call(c,f,p,u,e))):Array.isArray(h)?v(h,(function(e){t(d.join("."),e)})):void t(d.join("."),f[p])}(t,y)})),y},e}(),F=function(){function e(e){this.url=e||x.location.href}return e.prototype.params=function(e){var t=this,r={};if(e&&o(e)){var n=this.url.split("?")[0].split("/").reverse();""===n[0]&&n.shift(),v(e.split("/").reverse(),(function(e,t){var o=RegExp("{([\\S\\s]*?)}").exec(e);Array.isArray(o)&&(r[o[1]]=n[t])}))}return function(){var e=t.url.split("?")[1];if(!e)return t;v(e.split("&"),(function(e){var t=e.split("=");r[t[0]]=(t[1]||"").split("#")[0]}))}(),r},e.prototype.add=function(e){var t=[];v(Object.keys(e),(function(r){t.push(r+"="+e[r])}));var r=t.join("&");return this.url.includes("?")?"&"+r:"?"+r},e.prototype.remove=function(e){return e},e}(),U=function(e){var t=this;this.composedPath=function(){return t.source.composedPath()},this.initEvent=function(e,r,n){return t.source.initEvent(e,r,n)},this.preventDefault=function(){return t.source.preventDefault()},this.stopImmediatePropagation=function(){return t.source.stopImmediatePropagation()},this.stopPropagation=function(){return t.source.stopPropagation()};var r=e.source,n=e.type;this.source=r||new Event(n),Object.assign(this,e),this.bubbles=this.source.bubbles,this.cancelBubble=this.source.cancelBubble,this.cancelable=this.source.cancelable,this.composed=this.source.composed,this.currentTarget=this.source.currentTarget,this.defaultPrevented=this.source.defaultPrevented,this.eventPhase=this.source.eventPhase,this.isTrusted=this.source.isTrusted,this.target=this.source.target,this.timeStamp=this.source.timeStamp,this.type=this.source.type,this.returnValue=this.source.returnValue,this.srcElement=this.source.srcElement,this.AT_TARGET=this.source.AT_TARGET,this.BUBBLING_PHASE=this.source.BUBBLING_PHASE,this.CAPTURING_PHASE=this.source.CAPTURING_PHASE,this.NONE=this.source.NONE},$=function(){function e(e){this.scripts=[],this.styles=[],this.events={},this.name=e.name,this.path=e.path,Object.assign(this,e),this.data=_.transform(this.data||{})}return Object.defineProperty(e.prototype,"isReady",{get:function(){return!r(this.template)},enumerable:!1,configurable:!0}),e.prototype.export=function(e){var t=this;return n(e)?v(Object.keys(e),(function(r){t.data[r]=e[r],d(t.data,e,r)})):D.log('Invalid object for component.export(...), only "Object Literal" is allowed.')},e.prototype.destroy=function(){if(!this.el)return!1;this.emit("beforeDestroy");var e=this.el.parentElement;e&&e.removeChild(this.el),this.emit("destroyed"),this.events={},v(this.styles,(function(e){return v(m(x.head.children),(function(t){t===e&&x.removeChild(e)}))}))},e.prototype.params=function(){return(new F).params(this.route)},e.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=this;e in n&&"function"==typeof n[e]&&n[e](new U({type:e,targert:this}));var o=this.events[e];return!!o&&(v(o,(function(r){return r.apply(void 0,S([new U({type:e})],t,!1))})),!0)},e.prototype.on=function(e,t){return this.events[e]||(this.events[e]=[]),this.events[e].push(t),{eventName:e,callback:t}},e.prototype.off=function(e,t){if(!this.events[e])return!1;var r=this.events[e].indexOf(t);return this.events[e].splice(r,1),!0},e}(),J=function(){function o(e,t){this.components={},this.requests={},R.Register(this),this.bouer=e,this.delimiter=R.Resolve("DelimiterHandler"),t&&(x.head.querySelector("base")||D.warn('“<base href="/" />” element not found, we advise to set it as first element of “<head></head>” to avoid errors when url have extension (.html).\n@see: https://www.w3schools.com/tags/tag_base.asp'),this.prepare(t))}return o.prototype.check=function(e){return e in this.components},o.prototype.request=function(t,n){var o=this;if(!r(this.requests[t]))return this.requests[t].push(n);this.requests[t]=[n],e(E(N(O.baseURI).baseURI,t),{headers:{"Content-Type":"text/plain"}}).then((function(e){if(!e.ok)throw new Error(e.statusText);return e.text()})).then((function(e){v(o.requests[t],(function(r){r.success(e,t)}))})).catch((function(e){v(o.requests[t],(function(r){r.fail(e,t)}))})).finally((function(){delete o.requests[t]}))},o.prototype.prepare=function(e,n){var o=this;v(e,(function(e){var i;return r(e.name)&&(e.name=t(9,"component-").toLowerCase()),r(e.path)&&r(e.template)?D.warn("The component with name “"+e.name+"”"+e.route?" and the route “"+e.route+"”":" has not “path” or “template” property defined, then it was ignored."):(Array.isArray(e.children)&&o.prepare(e.children,e),r(e.route)||(e.route="/"+E(r(n)?"":n.route,e.route)),r(o.components[e.name])?(R.Resolve("Routing").configure(o.components[e.name]=e),void((null===(i=(o.bouer.config||{}).preload)||void 0===i||i)&&(r(e.path)||o.request(e.path,{success:function(t){e.template=t},fail:function(e){D.error(A(e))}})))):D.warn("The component name “"+e.name+"” is already define, try changing the name."))}))},o.prototype.order=function(e,t,r){var n=this,o=e.nodeName.toLowerCase(),i=this.components,s=i[o];if(!s)return D.error(new Error("No component with name “"+o+"” registered."));var u=s,c=q.obj(t,{$this:t});if(u.template){var l=new $(u);return l.bouer=this.bouer,a(r)&&r(l),this.insert(e,l,c),void(!0===l.keepAlive&&(i[o]=l))}"function"==typeof u.requested&&u.requested(new U({type:"requested"})),this.request(u.path,{success:function(t){u.template=t;var s=new $(u);s.bouer=n.bouer,a(r)&&r(s),n.insert(e,s,c),!0===s.keepAlive&&(i[o]=s)},fail:function(e){D.error(new Error("Failed to request <"+o+"></"+o+"> component with path “"+u.path+"”.")),D.error(A(e)),"function"==typeof u.failed&&u.failed(new U({type:"failed"}))}})},o.prototype.find=function(e){for(var t=Object.keys(this.components),r=0;r<t.length;r++){var n=this.components[t[r]];if(e(n))return n}return null},o.prototype.insert=function(o,i,a){var s,u=this,c=o.nodeName.toLowerCase(),l=o.parentElement;if(o.isConnected&&l){if(!i.isReady)return D.error(new Error("The <"+c+"></"+c+"> component is not ready yet to be inserted."));var p=b("div",(function(e){e.innerHTML=o.innerHTML,o.innerHTML=""})).build();(!1===(null!==(s=i.keepAlive)&&void 0!==s&&s)||r(i.el))&&b("body",(function(e){return e.innerHTML=i.template,v([].slice.apply(e.querySelectorAll("script")),(function(t){i.scripts.push(t),e.removeChild(t)})),v([].slice.apply(e.querySelectorAll('link[rel="stylesheet"]')),(function(t){i.styles.push(t),e.removeChild(t)})),v([].slice.apply(e.querySelectorAll("style")),(function(t){i.styles.push(t),e.removeChild(t)})),0===e.children.length?D.error(new SyntaxError("The component <"+c+"></"+c+"> seems to be empty or it has not a root element. Example: <div></div>, to be included.")):e.children.length>1?D.error(new SyntaxError("The component <"+c+"></"+c+"> seems to have multiple root element, it must have only one root.")):(i.el=e.children[0],void i.emit("created"))}));var h=i.el;v(m(o.attributes),(function(e){if(o.removeAttribute(e.name),"class"===e.nodeName)return o.classList.forEach((function(e){h.classList.add(e)}));if("data"===e.nodeName){if(0!==u.delimiter.run(e.value).length)return D.error(new SyntaxError("The “data” attribute cannot contain delimiter, source element: <"+c+"></"+c+">."));var t={},r=q.obj(a,{$this:a}),s=V.on("AfterGet",(function(e){t[e.propertyName]=void 0,f(t,e.propertyName,e)}));if(""===e.value)t=q.obj(u.bouer.data);else{var l=R.Resolve("Evaluator").exec({data:r,expression:e.value});if(!n(l))return D.error(new TypeError("Expected a valid Object Literal expression in “"+e.nodeName+"” and got “"+e.value+"”."));v(Object.keys(l),(function(e){e in t||(t[e]=l[e])}))}return V.off("AfterGet",s.callback),_.transform(t),v(Object.keys(t),(function(e){d(i.data,t,e)}))}h.attributes.setNamedItem(e)})),i.emit("beforeMount"),l.replaceChild(h,o);var y={};h.classList.forEach((function(e){return y[e]=!0}));var g=function(e,t){var r="STYLE"===e.nodeName,n=[];if(e.sheet){for(var o=e.sheet.cssRules,i=0;i<o.length;i++){var a=o.item(i);if(a){var s=a,u=s.selectorText.substr(1),c=y[u]?"":" ";s.selectorText="."+t+c+s.selectorText,r&&n.push(s.cssText)}}r&&(e.innerText=n.join("\n"))}};v(i.styles,(function(e){var r=e.cloneNode(!0),n=t(7,"bouer-s");if(r instanceof HTMLLinkElement&&r.hasAttribute("scoped")&&(r.onload=function(e){return g(e.target,n)}),x.head.appendChild(r),r.hasAttribute("scoped"))return h.classList.add(n),r instanceof HTMLStyleElement?g(r,n):void 0}));var w=function(e){try{R.Resolve("Evaluator").execRaw(e||"",i),i.emit("mounted"),i.emit("beforeLoad"),R.Resolve("Compiler").compile({data:_.transform(i.data),el:h,componentContent:p,onDone:function(){return i.emit("loaded")}}),C.observe(l,(function(){h.isConnected||i.destroy()}))}catch(e){D.error(new Error("Error in <"+c+"></"+c+"> component.")),D.error(A(e))}};if(0===i.scripts.length)return w();var N=[],E=[],T=[],O={};return v(i.scripts,(function(e){""==e.src||e.innerHTML?N.push(e.innerHTML):T.push(e.src)})),0==T.length?w(N.join("\n\n")):v(T,(function(t,r){O[t]=!0,e(t,{headers:{"Content-Type":"text/plain"}}).then((function(e){if(!e.ok)throw new Error(e.statusText);return e.text()})).then((function(e){if(delete O[t],E[r]=e,0===Object.keys(O).length)return w(q.array(E,N).join("\n\n"))})).catch((function(e){e.stack="",D.error(new Error('Error loading the <script src="'+t+'"><\/script> in <'+c+"></"+c+"> component, remove it in order to be compiled.")),D.log(e),i.emit("failed")}))}))}},o}(),W=function(){function e(e){this.delimiters=[],R.Register(this),this.delimiters=e}return e.prototype.add=function(e){this.delimiters.push(e)},e.prototype.remove=function(e){var t=this.delimiters.findIndex((function(t){return t.name===e}));this.delimiters.splice(t,1)},e.prototype.run=function(e){var t=this;if(r(e)||""===s(e))return[];var n=null,o=function(e,r){for(var o=0;o<t.delimiters.length;o++){var i=t.delimiters[o],a=e.match(RegExp(i.delimiter.open+"([\\S\\s]*?)"+i.delimiter.close,r||""));if(a)return n=i,a}},i=o(e,"g");return i?i.map((function(e){var t=o(e);return{field:t[0],expression:s(t[1]),delimiter:n}})):[]},e}(),z=function(){function e(e){R.Register(this),this.bouer=e,this.global=this.createWindow()}return e.prototype.createWindow=function(){var e;return b("iframe",(function(t,r){t.style.display="none!important",r.body.appendChild(t),e=t.contentWindow,r.body.removeChild(t)})),delete e.name,e},e.prototype.execRaw=function(e,t){try{var r="(function(){ "+e+" }).apply(this, arguments)";T.Function(r).apply(t||this.bouer)}catch(e){D.error(A(e))}},e.prototype.exec=function(e){var t=this,r=e.data,n=e.args,o=e.expression,i=e.isReturn,a=e.aditional,s=this.global,u={},c=q.obj(a||{});v(Object.keys(r),(function(e){d(c,r,e)})),v(Object.keys(this.bouer.globalData),(function(e){if(e in c)return D.warn('It was not possible to use the globalData property "'+e+'" because it already defined in the current scope.');d(c,t.bouer.globalData,e)}));var l,f=Object.keys(c);v(f,(function(e){delete s[e],e in s&&!0===p(s,e).configurable&&(u[e]=s[e]),e in u&&(s[e]=c[e]),d(s,c,e)}));try{var h='return(function(){"use strict"; '+(!1===i?"":"return")+" "+o+" }).apply(this, arguments)";l=this.global.Function(h).apply(this.bouer,n)}catch(e){D.error(A(e))}return v(f,(function(e){return delete s[e]})),l},e}(),Y=function(){function e(e){this.events=[],this.bouer=e,this.evaluator=R.Resolve("Evaluator"),this.input=b("input").build(),R.Register(this),this.cleanup()}return e.prototype.handle=function(e,t){var n,o=this,i=e.ownerElement||e.parentNode,u=e.nodeName;if(r(i))return D.error(new Error("Invalid ParentElement of “"+u+"”"));var l=s(null!==(n=e.nodeValue)&&void 0!==n?n:""),f=u.substr(j.on.length).split("."),d=f[0];if(f.shift(),""===l)return D.error(new Error("Expected an expression in the “"+u+"” and got an <empty string>."));w(e,i),i.removeAttribute(u);var p=function(e,r){var n=-1!==f.indexOf("once");v(f,(function(t){v(Object.keys(e),(function(r){var n;(n=e[r]&&a(n)&&c(r)===c(t))&&n()}))}));var i=new U({source:e,type:e.type}),s=q.array(i,r),u=o.evaluator.exec({data:q.obj(t,{event:i}),expression:l,args:s});if(a(u))try{u.apply(o.bouer,s)}catch(e){D.error(A(e))}return n};if("on"+d in this.input){var h=function(e){p(e,[])&&i.removeEventListener(d,h,!1)};i.addEventListener(d,h,!1)}else this.on(d,p,i)},e.prototype.on=function(e,t,r){var n={eventName:e,callback:function(e,r){return t(e,r)},attachedNode:r};return this.events.push(n),n},e.prototype.off=function(e,t){var r=-1,n=this.events.find((function(n,o){if(n.eventName===e&&t==n.callback)return r=o,!0}));return n&&this.events.splice(r,1),n},e.prototype.emit=function(e){var t=this,r=e.eventName,n=e.arguments;v(this.events,(function(o,i){var a;r===o.eventName&&(e.attachedNode||o.attachedNode===e.attachedNode)&&(o.callback.call(t.bouer,new U({type:r,target:e.attachedNode}),n||[]),!0===(null!==(a=e.once)&&void 0!==a&&a)&&t.events.splice(i,1))}))},e.prototype.cleanup=function(){var e=this;k((function(){var t=[];v(e.events,(function(e){return e.attachedNode?e.attachedNode.isConnected?t.push(e):void 0:t.push(e)})),e.events=t}),1e3)},e}(),K=function(){function e(e){this.defaultPage=null,this.notFoundPage=null,this.routeView=null,this.activeAnchors=[],this.base=null,R.Register(this),this.bouer=e,this.routeView=this.bouer.el.querySelector("[route-view]")}return e.prototype.init=function(){var e=this;if(!r(this.routeView)){this.routeView.removeAttribute("route-view");var t=x.head.querySelector("base");if(t){var n=t.attributes.href;if(!n)return D.error(new Error('The href="/" attribute is required in base element.'));this.base=n.value,this.navigate(x.location.href),T.addEventListener("popstate",(function(t){t.preventDefault(),e.navigate((t.state||{}).url||x.location.href)}))}}},e.prototype.navigate=function(e){var t,n=this;if(r(e))return D.log("Invalid url provided to the navigation method.");var o=N(e=s(e)),i=null===(t=(this.bouer.config||{}).usehash)||void 0===t||t,a=(i?o.hash:o.pathname).split("?")[0];"/"===a[a.length-1]&&(a=a.substr(0,a.length-1));var u=this.toPage(a);if(this.clear(),u&&(u||!e.endsWith(".html"))){var c=y(u.name).appendTo(this.routeView).build(),l=E(o.baseURI,i?"#":"",u.route);R.Resolve("ComponentHandler").order(c,{},(function(e){e.on("loaded",(function(){n.markActiveAnchors(l)}))})),x.title=u.title||x.title,this.pushState(o.href,x.title)}},e.prototype.pushState=function(e,t){e=N(e).href,T.history.pushState({url:e},t||"",e)},e.prototype.popState=function(e){r(e)&&(e=-1),T.history.go(e)},e.prototype.toPage=function(e){return""===e||"/"===e||e==="/"+E((this.base,"index.html"))?this.defaultPage:R.Resolve("ComponentHandler").find((function(t){if(!t.route)return!1;var r=t.route.replace(/{(.*?)}/gi,"[\\S\\s]{1,}");return!!Array.isArray(new RegExp("^"+r+"$").exec(e))}))||this.notFoundPage},e.prototype.markActiveAnchors=function(e){var t=this,r=(this.bouer.config||{}).activeClassName||"active-link",n=this.bouer.el.querySelectorAll("a");v(this.activeAnchors,(function(e){return e.classList.remove(r)})),this.activeAnchors=[],v(m(n),(function(n){n.href===e&&n.markable&&(n.classList.add(r),t.activeAnchors.push(n))}))},e.prototype.clear=function(){this.routeView.innerHTML=""},e.prototype.configure=function(e){return!0!==e.isDefault||r(this.defaultPage)?!0!==e.isNotFound||r(this.notFoundPage)?(!0===e.isDefault&&(this.defaultPage=e),void(!0===e.isNotFound&&(this.notFoundPage=e))):D.warn("There are multiple “NotFound Page” provided, check the “"+e.route+"” route."):D.warn("There are multiple “Default Page” provided, check the “"+e.route+"” route.")},e}(),Q=function(){var e=this;this.container={},this.run=function(t,r){var n=e.container[t];if(!n)return D.log("There is not interceptor for “"+t+"”.");for(var o,i=function(e){(0,n[e])(r,(function(){e++})),o=e},a=0;a<n.length;a++)i(a),a=o},this.register=function(t,r){var n=e.container[t];if(!n)return e.container[t]=[r];n.push(r)},R.Register(this)};return function(){function e(e,t){if(this.name="Bouer",this.version="3.0.0",this.components=[],this.dependencies={},t=t||{},this.config=t.config,this.components=t.components||[],this.dependencies=t.dependencies||{},this.interceptor=t.interceptor,Object.assign(this,t),r(e)||""===s(e))throw D.error(new TypeError("Invalid selector provided to the instance."));var n=this,o=x.querySelector(e);if(!o)throw D.error(new Error("Element with selector “"+e+"” not found."));var i=new P;new z(this),new I(this);var a=new Q;n.beforeMount(o,n),this.el=o,"function"==typeof this.interceptor&&this.interceptor(a.register,this),this.data=_.transform(t.data||{}),this.globalData=_.transform(t.globalData||{}),n.mounted(n.el,n);var u=new W([{name:"bouer",delimiter:{open:"-e-",close:"-"}},{name:"common",delimiter:{open:"{{",close:"}}"}},{name:"html",delimiter:{open:"{{:html ",close:"}}"}}]);new Y(this),new L(this),this.routing=new K(this),new J(this,t.components);var c=new B(this);new G(this),new I(this),this.delimiters={add:u.add,remove:u.remove,get:function(){return u.delimiters.slice()}},this.$data={get:function(e){return e?i.data[e]:i.data},set:function(e,t,r){return e in i.data?D.log(new Error("There is already a data stored with this key “"+e+"”.")):(!0===(null!=r&&r)&&_.transform(t),P.set("data",e,t))},unset:function(e){return delete i.data[e]}},this.$req={get:function(e){return e?i.req[e]:i.req},unset:function(e){return delete i.req[e]}},this.$wait={get:function(e){return e?i.wait[e]:i.wait},set:function(e,t){if(!(e in i.wait))return i.wait[e]={data:t,nodes:[]};var r=i.wait[e];return r.data=t,v(r.nodes,(function(e){e&&c.compile({el:e,data:_.transform(r.data)})}))},unset:function(e){return delete i.wait[e]}},n.beforeLoad(n.el,n),c.compile({el:this.el,data:this.data,onDone:function(){return n.loaded(n.el,n)}}),C.observe(this.el,(function(e){var t=e.mutation;!1===e.element.isConnected&&(n.destroyed(n.el,n),t.disconnect())})),this.routing.init(),x.head.querySelector("link[rel~='icon']")||b("link",(function(e){e.rel="icon",e.type="image/png",e.href="https://afonsomatelias.github.io/assets/bouer/img/short.png"})).appendTo(x.head)}return Object.defineProperty(e.prototype,"refs",{get:function(){var e={};return v(m(this.el.querySelectorAll(j.ref)),(function(t){var r=s(t.attributes[j.ref].value);if(""===r)return D.error(new SyntaxError("Expected an expression in “"+t.name+"” and got “"+t.value+"”."));e[r]=t})),e},enumerable:!1,configurable:!0}),e.prototype.toJsObj=function(e,t,r){return R.Resolve("Converter").htmlToJsObj(e,t,r)},e.prototype.setData=function(e,t){return _.setData(e,t||this.data)},e.prototype.watch=function(e,t,r){return R.Resolve("Binder").watch(e,t,r)},e.prototype.beforeMount=function(e,t){},e.prototype.mounted=function(e,t){},e.prototype.beforeLoad=function(e,t){},e.prototype.loaded=function(e,t){},e.prototype.destroyed=function(e,t){},e}()}));
