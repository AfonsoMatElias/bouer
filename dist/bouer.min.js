!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Bouer=t()}(this,(function(){"use strict";var e=function(){function e(){}return e.Register=function(e){this.container[e.__proto__.constructor.name]=e},e.Resolve=function(e){return this.container[e]},e.Dispose=function(e){delete this.container[e]},e.container={},e}(),t=function(){function e(){}return e.observe=function(e,t){var r=new MutationObserver((function(n){t({element:e,mutation:r,records:n})}));r.observe(e,{childList:!0})},e}();function r(e,t,r){if(r||2===arguments.length)for(var n,o=0,i=t.length;o<i;o++)!n&&o in t||(n||(n=Array.prototype.slice.call(t,0,o)),n[o]=t[o]);return e.concat(n||Array.prototype.slice.call(t))}var n=function(){function e(){}return e.log=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];console.log.apply(console,r([e.prefix],t,!1))},e.error=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];console.error.apply(console,r([e.prefix],t,!1))},e.warn=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];console.warn.apply(console,r([e.prefix],t,!1))},e.info=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];console.info.apply(console,r([e.prefix],t,!1))},e.prefix="[Bouer]",e}();function o(e,t){return fetch(e,t)}function i(e,t,r){for(var n="01234567890ABCDEFGHIJKLMNOPQRSTUVWXYZ",o=!1,i="",a=0;a<(e||8);a++){var u=Math.floor(Math.random()*n.length);i+=o?n[u].toLowerCase():n[u],o=!o}return(t||"")+i+(r||"")}function a(e){return void 0===e||null==e}function u(e){return"object"==typeof e&&"[object Object]"===String(e)}function s(e){return void 0!==e&&"string"==typeof e}function c(e){return!e||!u(e)||0===Object.keys(e).length}function l(e){return"function"==typeof e}function f(e){return e?e.trim():e}function p(e){return e.toLowerCase()}function d(e){return function(e){return"string"==typeof e||"number"==typeof e||"symbol"==typeof e||"boolean"==typeof e}(e)?String(e):u(e)?JSON.stringify(e):l(e.toString)?e.toString():String(e)}function h(e,t,r){return Object.defineProperty(e,t,r),e}function v(e,t,r){h(e,r,m(t,r))}function m(e,t){return Object.getOwnPropertyDescriptor(e,t)}function y(e,t,r){void 0===r&&(r=!1);var n=null;if(!e)return null;for(var o=0,i=t;o<i.length;o++){var u=i[o];if(n=e.attributes[u])break}return!a(n)&&r&&e.removeAttribute(n.name),n}function b(e,t,r){for(var n=0;n<e.length;n++)l(t)&&t.call(r,e[n],n)}function g(e,t){var r=E.createElement(e);l(t)&&t(r,E);var n={appendTo:function(e){return e.appendChild(r),n},build:function(){return r}};return n}function w(e,t){b(Object.keys(e),(function(r){var n=e[r];if(r in t)return u(n)?w(n,t[r]):t[r]=n;v(t,e,r)}))}function N(e,t){return h(e,"isConnected",{get:function(){return t.isConnected}}),e}function A(e){var t=e;"documentMode"in E&&(T.setAttribute("href",t),t=T.href),T.setAttribute("href",t);var r=T.hostname;!("[::1]"===T.hostname)&&r.indexOf(":")>-1&&(r="["+r+"]");var n={href:T.href,baseURI:T.baseURI,protocol:T.protocol?T.protocol.replace(/:$/,""):"",host:T.host,search:T.search?T.search.replace(/^\?/,""):"",hash:T.hash?T.hash.replace(/^#/,""):"",hostname:r,port:T.port,pathname:"/"===T.pathname.charAt(0)?T.pathname:"/"+T.pathname,origin:""};return n.origin=n.protocol+"://"+n.host,n}function x(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=e.split(/\/\//),o=n.length>1?n[0]+"//":"",i=""===o?n[0]:n[1],a=i.split(/\//),u=[];return b(a,(function(e){return f(e)?u.push(e):null})),b(t,(function(e){return b(e.split(/\//),(function(e){return f(e)?u.push(e):null}))})),o+u.join("/")}function O(e,t){return e.stack="",e}var E=document,k=globalThis,T=g("a").build(),R=setInterval,j={ignore:"e-ignore",build:"e-build",array:"e-array",if:"e-if",elseif:"e-else-if",else:"e-else",show:"e-show",req:"e-req",tmp:"e-tmp",fill:"e-fill",for:"e-for",use:"e-use",id:"e-id",order:"e-order",filter:"e-filter",data:"data",def:"e-def",wait:"wait-data",toggle:"e-toggle",content:"e-content",bind:"e-bind",property:"e-",anm:"e-anm",skeleton:"e-skeleton",route:"route-view",href:":href",ihref:"!href",copy:"e-copy",component:":name",on:"on:",check:function(e,t){return e.nodeName.substr(0,t.length)===t},isConstant:function(e){var t=this;return-1!==Object.keys(this).map((function(e){return t[e]})).indexOf(e)}},C=function(){function e(){}return e.on=function(e,t){return this[e].push(t),{eventName:e,callback:t}},e.off=function(e,t){var r=this[e];return r.splice(r.indexOf(t),1),!0},e.emit=function(e,t,r,o){try{b(this[e],(function(e){return e(t,r,o)}))}catch(e){n.error(O(e))}},e.BeforeGet=[],e.AfterGet=[],e.BeforeSet=[],e.AfterSet=[],e.BeforeArrayChanges=[],e.AfterArrayChanges=[],e}(),I=function(){function t(t){this.binds=[],this.DEFAULT_BINDER_PROPERTIES={text:"value",number:"valueAsNumber",checkbox:"checked",radio:"checked"},this.BindingDirection={fromInputToData:"to-data-property",fromDataToInput:"to-input"},e.Register(this),this.evaluator=e.Resolve("Evalutator"),this.bouer=t,this.cleanup()}return t.prototype.create=function(e){var t,r=this,n=e.node,o=e.data,i=e.fields,s=e.eReplace,c=f(null!==(t=n.nodeValue)&&void 0!==t?t:""),p=n.nodeName,h=n.ownerElement||n.parentNode,v=e.onChange||function(e,t){},m={name:p,value:c,bindOptions:e,boundNode:n};if(p.substr(0,j.bind.length)===j.bind){var y="";y=j.bind===p?this.DEFAULT_BINDER_PROPERTIES[h.type]||"value":p.split(":")[1];var w=function(e,t){switch(e){case r.BindingDirection.fromDataToInput:return h[y]=t;case r.BindingDirection.fromInputToData:return o[c]=h[y]}},N=C.on("AfterGet",(function(e){r.binds.push(e.watch((function(e){w(r.BindingDirection.fromDataToInput,e),v(e,n)}),n))})),A=this.evaluator.exec({expression:c,data:o});N&&C.off("AfterGet",N.callback),h[y]=u(A)?d(A):a(A)?"":A;var x=[h.nodeName.toLowerCase(),"propertychange","change"],O=function(){w(r.BindingDirection.fromInputToData,h[y])};return b(x,(function(e){return h.addEventListener(e,O,!1)})),h.removeAttribute(n.nodeName),m}var E=n;p.substr(0,j.property.length)===j.property&&a(s)&&(m.name=p.substr(j.property.length),h.setAttribute(m.name,c),E=h.attributes[m.name],h.removeAttribute(n.nodeName));var k=function(){var e=m.value,t=!1;if(b(i,(function(i){var u=i.delimiter;u&&"html"===u.name&&(t=!0);var s=r.evaluator.exec({expression:i.expression,data:o});s=a(s)?"":s,e=e.replace(i.field,d(s)),u&&l(u.action)&&(e=u.action(e,n,o))})),t){var u=g("div",(function(t){t.innerHTML=e})).build().children[0];h.appendChild(u)}else E.nodeValue=e},T=C.on("BeforeGet",(function(e){r.binds.push(e.watch((function(e){k(),v(e,n)}),n))}));return k(),T&&C.off("BeforeGet",T.callback),m.boundNode=E,m},t.prototype.cleanup=function(){var e=this;R((function(){return b(e.binds,(function(t,r){t.node&&(t.node.isConnected||(t.destroy(),e.binds.splice(r,1)))}))}),1e3)},t}(),D=function(){function t(t){e.Register(this),this.bouer=t}return t.prototype.create=function(e){var t=E.createComment("e");return t.id=e||i(8),t},t.prototype.get=function(e,t){if(!a(e))return t=t||this.bouer.el,this.retrieve(t).find((function(t){return t.id===e}))},t.prototype.retrieve=function(e){if(!e)return[];for(var t,r=E.createNodeIterator(e,NodeFilter.SHOW_COMMENT,(function(){return NodeFilter.FILTER_ACCEPT})),n=[];t=r.nextNode();)"id"in t&&n.push(t);return n},t}(),V=function(){function e(){}return e.obj=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r={};return b(e,(function(e){a(e)||b(Object.keys(e),(function(t){a(e[t])||v(r,e,t)}))})),r},e.addToObj=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return b(t,(function(t){a(t)||b(Object.keys(t),(function(r){a(t[r])||v(e,t,r)}))})),e},e.array=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=[];return b(e,(function(e){a(e)||b(Object.keys(e),(function(t){var n=e[t];a(n)||(Array.isArray(n)?[].push.apply(r,n):r.push(n))}))})),r},e}(),L=function(e,t,r){var n=this;this.destroy=function(){var e=n.reactive.watches.indexOf(n);-1!==e&&n.reactive.watches.splice(e,1),n.onDestroy&&n.onDestroy()},this.reactive=e,this.property=e.propertyName,this.callback=t,r&&(this.node=r.node,this.onDestroy=r.onDestroy)},S=function(){function e(t){var r=this;this.watches=[],this.get=function(){C.emit("BeforeGet",r);var e=r.propertyValue;return C.emit("AfterGet",r),e},this.set=function(t){var n=r.propertyValue;n!==t&&(C.emit("BeforeSet",r),u(t)||Array.isArray(t)?Array.isArray(t)?(e.transform(t,r),a(r.propertyValue)?r.propertyValue=t:(Array.isArray(r.propertyValue)&&r.propertyValue.splice(0,r.propertyValue.length),[].push.apply(r.propertyValue,t))):u(t)&&(t instanceof Node?r.propertyValue=t:(e.transform(t),a(r.propertyValue)?r.propertyValue=t:w(r.propertyValue,t))):r.propertyValue=t,C.emit("AfterSet",r),b(r.watches,(function(e){return e.callback(r.propertyValue,n)})))},this.propertyName=t.propertyName,this.propertySource=t.sourceObject,this.propertyDescriptor=m(this.propertySource,this.propertyName),this.propertyValue=this.propertyDescriptor.value}var t;return e.prototype.watch=function(e,t){var r=new L(this,e,{node:t});return this.watches.push(r),r},t=e,e.transform=function(r,o){if(Array.isArray(r)){if(null==o)return n.warn("Cannot transform this array to a reactive one because no reactive objecto was provided"),r;var i=r,s={},c=i.__proto__=Object.create(Array.prototype);return b(["push","pop","unshift","shift","splice"],(function(e){s[e]=i[e].bind(i),c[e]=function(){var t=i.slice();C.emit("BeforeArrayChanges",o,e,{arrayNew:t,arrayOld:t});var r=s[e].apply(i,arguments);return C.emit("AfterArrayChanges",o,e,{arrayNew:t,arrayOld:t}),r}})),i}return u(r)?(b(Object.keys(r),(function(n){var o=r;if(!a(m(r,n).value)){var i=new e({propertyName:n,sourceObject:r});h(r,n,i);var s=o[n];u(s)?t.transform(s):Array.isArray(s)&&(t.transform(s,i),b(s,(function(e){return t.transform(e)})))}})),r):r},e}(),P=function(){function e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.node=e}return e.prototype.connect=function(e){b(this.node,(function(t){return N(t,e)}))},e}(),_=function(){function t(t,r){this.errorMsgEmptyNode=function(e){return"Expected an expression in “"+e.nodeName+"” and got an <empty string>."},this.errorMsgNodeValue=function(e){var t;return"Expected an expression in “"+e.nodeName+"” and got “"+(null!==(t=e.nodeValue)&&void 0!==t?t:"")+"”."},this.bouer=t,this.htmlHandler=r,this.evaluator=e.Resolve("Evalutator"),this.delimiter=e.Resolve("DelimiterHandler"),this.comment=e.Resolve("CommentHandler"),this.binder=e.Resolve("Binder")}return t.prototype.toOwnerNode=function(e){return e.ownerElement||e.parentNode},t.prototype.returner=function(e,t){return l(t)&&t(),new(P.bind.apply(P,r([void 0],e,!1)))},t.prototype.ignore=function(e){e.nodeValue="true"},t.prototype.if=function(e,t){var r,o,i=this,a=this.toOwnerNode(e),u=a.parentElement,s=[],c=this.comment.create(),l=e.nodeName,p=function(){};if(!u)return this.returner(e);if(l===j.elseif||l===j.else)return this.returner(e);var d=a,h=[],v=function(){if(null==d)return"break";var e=y(d,["e-if","e-else-if","e-else"]);if(!e)return"break";if("e-else"!==e.nodeName&&""===f(null!==(r=e.nodeValue)&&void 0!==r?r:""))return{value:m.returner(e,(function(){return n.error(i.errorMsgEmptyNode(e))}))};if(0!==m.delimiter.run(null!==(o=e.nodeValue)&&void 0!==o?o:"").length)return{value:m.returner(e,(function(){return n.error(i.errorMsgNodeValue(e))}))};if(s.push({node:e,element:d}),N(d,u),N(e,u),"e-else"===e.nodeName)return d.removeAttribute(e.nodeName),"break";var a=C.on("BeforeGet",(function(t){-1===h.findIndex((function(e){return e.reactive.propertyName==t.propertyName}))&&h.push({attr:e,reactive:t})}));m.evaluator.exec({data:t,expression:e.value}),a&&C.off("BeforeGet",a.callback),d.removeAttribute(e.nodeName)},m=this;do{var g=v();if("object"==typeof g)return g.value;if("break"===g)break}while(d=d.nextElementSibling);return b(h,(function(e){return i.binder.binds.push(e.reactive.watch((function(){return p()}),e.attr))})),(p=function(){b(s,(function(e){e.element.parentElement&&(c.isConnected?u.removeChild(e.element):u.replaceChild(c,e.element))}));var e=s.map((function(e,t){var r=e.node.value;switch(e.node.name){case j.if:return"if("+r+"){ _cb("+t+"); }";case j.elseif:return"else if("+r+"){ _cb("+t+"); }";case j.else:return"else{ _cb("+t+"); }"}})).join(" ");i.evaluator.exec({data:t,isReturn:!1,expression:e,aditional:{_cb:function(e){var r=s[e].element;u.replaceChild(r,c),i.htmlHandler.compile({el:r,data:t})}}})})(),this.returner(s.map((function(e){return e.node})))},t.prototype.show=function(e,t){var r,o=this,i=this.toOwnerNode(e),a=f(null!==(r=e.nodeValue)&&void 0!==r?r:""),u=0!==this.delimiter.run(a).length;if(""===a)return this.returner(e,(function(){n.error(o.errorMsgEmptyNode(e))}));if(u)return this.returner(e,(function(){n.error(o.errorMsgNodeValue(e))}));var s=function(e){var r=o.evaluator.exec({expression:a,data:t});e.style.display=r?"":"none"},c=this.binder.create({data:t,node:e,fields:[{expression:a,field:a}],onChange:function(){return s(i)}});return s(i),i.removeAttribute(c.boundNode.nodeName),this.returner(e)},t.prototype.for=function(e,t){var r,o=this,i=this.toOwnerNode(e),u=i.parentElement,s=this.comment.create(),c=e.nodeName,l=f(null!==(r=e.nodeValue)&&void 0!==r?r:""),p=[],h=function(){};if(!u)return this.returner(e);if(""===l)return this.returner(e,(function(){n.error(o.errorMsgEmptyNode(e))}));if(!l.includes(" of ")&&!l.includes(" in "))return this.returner(e,(function(){n.error("Expected a valid “for” expression in “"+c+"” and got “"+l+'”.\nValid: e-for="item of items".')}));var v=this.delimiter.run(l);0!==v.length&&this.binder.create({data:t,fields:v,eReplace:!0,node:e,onChange:function(){return h()}}),i.removeAttribute(c);var m=i.cloneNode(!0);u.replaceChild(s,i),N(m,s),N(e,s);var y=C.on("AfterGet",(function(t){return o.binder.binds.push(t.watch((function(){return h()}),e))})),g=C.on("AfterArrayChanges",(function(e){return h()}));return this.binder.binds.push(new L(new S({propertyName:"_",sourceObject:{_:[]}}),(function(){}),{node:e,onDestroy:function(){return C.off("AfterArrayChanges",g.callback)}})),(h=function(){var r,i=(l=f(null!==(r=e.nodeValue)&&void 0!==r?r:"")).split("|").map((function(e){return f(e)})),h=i[0].replace("(","").replace(")","");i.shift();var v=" of ",y=h.split(v);0===y.length&&(v=" in ",y=h.split(v));var g=y[0],w=y[1],N=g.split(",").map((function(e){return f(e)})),A="let "+g+(g.includes(",")?"=0":"")+";",x=N.length>1;h=[x?N[0]:g,"_flt("+w+")"].join(v),b(p,(function(e){e.parentElement&&u.removeChild(e)})),p=[],o.evaluator.exec({data:t,isReturn:!1,expression:A+"for("+h+"){  _each("+g+(x?"++":"")+")}",aditional:{_each:function(e,r){var n=V.obj(t);n[N[0]]=e,x&&(n[N[1]]=r);var i=u.insertBefore(m.cloneNode(!0),s);o.htmlHandler.compile({el:i,data:n})},_flt:function(e){var r=V.array(e),u=function(e){return i.find((function(t){return t.substr(0,e.length)===e}))},s=u("filter");if(s){var p=s.split(":").map((function(e){return f(e)}));1==p.length?n.error("Invalid “"+c+"” filter expression “"+l+"”, at least a filter-value and filter-keys, or a filter-function must be provided"):r=function(e,r){var i=r[1],u=r[2];if(a(i)||""===i)return n.error("Invalid filter-value in “"+c+"” with “"+l+"” expression."),e;if("function"==typeof(i=o.evaluator.exec({data:t,expression:i})))e=i(e);else{if(a(u)||""===u)return n.error("Invalid filter-keys in “"+c+"” with “"+l+"” expression, at least one filter-key to be provided."),e;var s=[];b(e,(function(e){for(var t=0,r=u.split(",").map((function(e){return f(e)}));t<r.length;t++){var n=r[t];if(!d(o.evaluator.exec({data:e,expression:n})).includes(i))break;s.push(e)}})),e=s}return e}(r,p)}var h=u("order");if(h){var v=h.split(":").map((function(e){return f(e)}));1==v.length?n.error("Invalid “"+c+"” order  expression “"+l+"”, at least the order type must be provided"):r=function(e,t,r){return t||(t="asc"),e.sort((function(e,o){var i=function(e,r){if(a(e)||a(r))return 0;switch(t.toLowerCase()){case"asc":return e?1:-1;case"desc":return r?-1:1;default:return n.log("The “"+t+"” order type is invalid: “"+l+"”. Available types are: “asc”  for order ascendent and “desc” for order descendent."),0}};return r?i(e[r]>o[r],o[r]<e[r]):i(e>o,o<e)}))}(r,v[1],v[2])}return r}}})})(),C.off("AfterGet",y.callback),this.returner(e)},t.prototype.def=function(e,t){var r,o=this,i=this.toOwnerNode(e),a=f(null!==(r=e.nodeValue)&&void 0!==r?r:""),s=0!==this.delimiter.run(a).length;if(""===a)return this.returner(e,(function(){n.error(o.errorMsgEmptyNode(e))}));if(s)return this.returner(e,(function(){n.error(o.errorMsgNodeValue(e))}));var c=this.evaluator.exec({data:t,expression:a});if(!u(c))return this.returner(e,(function(){n.error("Expected a valid Object Literal expression in “"+e.nodeName+"” and got “"+a+"”.")}));this.bouer.setData(c,t),i.removeAttribute(e.nodeName)},t.prototype.content=function(e){var t,r=this,o=this.toOwnerNode(e),i=f(null!==(t=e.nodeValue)&&void 0!==t?t:"");if(""===i)return this.returner(e,(function(){n.error(r.errorMsgEmptyNode(e))}));o.innerText=i,o.removeAttribute(e.nodeName)},t.prototype.bind=function(e,t){var r,o=this,i=this.toOwnerNode(e),a=f(null!==(r=e.nodeValue)&&void 0!==r?r:""),u=0!==this.delimiter.run(a).length;return""===a?this.returner(e,(function(){n.error(o.errorMsgEmptyNode(e))})):u?this.returner(e,(function(){n.error(o.errorMsgNodeValue(e))})):(this.binder.create({node:e,fields:[{field:a,expression:a}],data:t}),i.removeAttribute(e.nodeName),this.returner(e))},t.prototype.property=function(e,t){var r,o=this,i=this.toOwnerNode(e),a=f(null!==(r=e.nodeValue)&&void 0!==r?r:""),s=0!==this.delimiter.run(a).length,c=function(e){},l=function(e){var t;return"Invalid value, expected an Object/Object Literal in “"+e.nodeName+"” and got “"+(null!==(t=e.nodeValue)&&void 0!==t?t:"")+"”."};if(""===a)return this.returner(e,(function(){n.error(l(e))}));if(s)return this.returner(e);var p=this.evaluator.exec({data:t,expression:a});return u(p)?(this.binder.create({data:t,node:e,eReplace:!1,fields:[{expression:a,field:a}],onChange:function(){return c(o.evaluator.exec({data:t,expression:a}))}}),i.removeAttribute(e.nodeName),(c=function(t){var r=e.nodeName.substr(j.property.length),n=i.attributes[r];if(n||(i.setAttribute(r,""),n=i.attributes[r]),b(Object.keys(t),(function(e){if(!t[e])return n.value=f(n.value.replace(e,""));n.value=n.value.includes(e)?n.value:f(n.value+" "+e)})),""===n.value)return i.removeAttribute(r)})(p),this.returner(e)):this.returner(e,(function(){n.error(l(e))}))},t.prototype.req=function(e,t){return n.info(e,t),this.returner(e)},t.prototype.data=function(e,t){return V.obj(t,{$this:t}),this.returner(e)},t.prototype.href=function(t,r){var o,i,a=this,u=this.toOwnerNode(t),s=f(null!==(o=t.nodeValue)&&void 0!==o?o:"");if(""===s)return this.returner(t,(function(){n.error(a.errorMsgEmptyNode(t))}));u.removeAttribute(t.nodeName);var c=x(null===(i=(this.bouer.config||{}).usehash)||void 0===i||i?"#":"",s);u.setAttribute("href",c);var l=u.attributes.href,p=this.delimiter.run(s);return 0!==p.length&&this.binder.create({data:r,node:l,fields:p}),u.addEventListener("click",(function(t){t.preventDefault(),e.Resolve("Routing").navigate(l.value)}),!1),this.returner(l)},t.prototype.skeleton=function(e,t){n.warn("e-skeleton not implemented yet.")},t.prototype.wait=function(e,t){n.warn("wait-data not implemented yet.")},t.prototype.copy=function(e){n.warn("e-copy not implemented yet.")},t.prototype.component=function(e,t){n.warn("<component /> not implemented yet.")},t}(),M=function(){function t(t){this.NODES_TO_IGNORE_IN_COMPILATION={SCRIPT:1,"#comment":8},e.Register(this),this.bouer=t,this.delimiter=e.Resolve("DelimiterHandler"),this.eventHandler=e.Resolve("EventHandler"),this.binder=e.Resolve("Binder"),this.component=e.Resolve("ComponentHandler"),this.directive=new _(t,this)}return t.prototype.toJsObj=function(e,t,r){var o=void 0,i=this;if(e instanceof Element)o=e;else{if(u(e))return e;if(s(e))try{o=this.bouer.el.querySelector(e)}catch(t){return e}}if(a(o))throw n.error("Invalid element passed in app.toJsObj(...)");var p=function(e){return e.split(",").map((function(e){return f(e.replace("[","").replace("]",""))}))},d=p((t=t||{}).names||"[name]"),h=p(t.values||"[value]"),v=function(e,t){return t in e?e[t]:e.getAttribute(t)||e.innerText},m=function(e){var t={},n={BUTTON:!0},o={checkbox:!0,radio:!0};return function e(a){var u=y(a,d);if(u){var s=u.value;if(!0===n[a.tagName])return;if(a instanceof HTMLInputElement&&!0===o[a.type]&&!1===a.checked)return;var c=t[s],f=a.hasAttribute(j.array),p=function(e){var t=void 0;return h.find((function(r){return!!(t=v(e,r))})),t}(a);t[s]=f?c?V.array(c,p):[p]:c?V.array(c,p):p,l(r)&&r.call(i,t,s,p,a)}b([].slice.call(a.children),(function(t){y(t,[j.build])||e(t)}))}(e),t},g=m(o);return b([].slice.call(o.querySelectorAll("["+j.build+"]")),(function(e){var t=v(e,j.build),n=e.hasAttribute(j.array),o=m(e);(function(e){if(c(e))return!1;for(var t=!1,r=Object.keys(e),n=0;n<r.length;n++)if(!a(r[n])){t=!0;break}return t})(o)&&function t(s,f){var p=s.split("."),d=p[0];p.shift();var h=f[d];return a(h)&&(f[d]={}),0===p.length?(n?u(h)&&!c(h)?f[d]=[V.obj(h,o)]:Array.isArray(h)?h.push(o):f[d]=[o]:a(h)?f[d]=o:f[d]=V.obj(h,o),void(l(r)&&r.call(i,f,d,o,e))):Array.isArray(h)?b(h,(function(e){t(p.join("."),e)})):void t(p.join("."),f[d])}(t,g)})),g},t.prototype.compile=function(e){var t=this,r=e.el,o=e.data||this.bouer.data;if(this.analizer(r.outerHTML)){var i=function(e,o){if(!(e.nodeName in t.NODES_TO_IGNORE_IN_COMPILATION)){if(e instanceof Element){if(j.ignore in e.attributes)return t.directive.ignore(e);if(j.def in e.attributes&&t.directive.def(e.attributes[j.def],o),j.wait in e.attributes)return t.directive.wait(e.attributes[j.wait],o);if(j.copy in e.attributes&&t.directive.copy(e),j.for in e.attributes)return t.directive.for(e.attributes[j.for],o).connect(r);if(j.if in e.attributes)return t.directive.if(e.attributes[j.if],o);if((j.elseif in e.attributes||j.else in e.attributes)&&n.warn('The "'+j.elseif+'" or "'+j.else+'" requires an element with "'+j.if+'" above.'),j.show in e.attributes)return t.directive.show(e.attributes[j.show],o).connect(r);var a=null;if((a=e.attributes[j.req])||(a=[].slice.call(e.attributes).find((function(e){return j.check(e,j.req)}))))return t.directive.req(a,o);if(t.component.check(e.localName))return t.component.order(e,o);if(j.data in e.attributes)return t.directive.data(e.attributes[j.data],o);b([].slice.call(e.attributes),(function(e){i(e,o)}))}if(j.check(e,j.href)||j.check(e,j.ihref))return t.directive.href(e,o).connect(r);if(j.check(e,j.content))return t.directive.content(e);if(j.check(e,j.bind))return t.directive.bind(e,o).connect(r);if(j.check(e,j.property)&&!j.isConstant(e.nodeName)&&t.directive.property(e,o).connect(r),j.check(e,j.on))return t.eventHandler.handle(e,o);var u;s(e.nodeValue)&&(u=t.delimiter.run(e.nodeValue))&&0!==u.length&&t.binder.create({node:N(e,r),fields:u,data:o}),b([].slice.call(e.childNodes),(function(e){return i(e,o)}))}};i(r,o),l(e.onDone)&&e.onDone.call(this.bouer,r)}},t.prototype.analizer=function(e){return!0},t}(),B=function(){function e(e){this.url=e}return e.prototype.params=function(){return{}},e.prototype.add=function(e){return e},e.prototype.remove=function(e){return e},e}(),H=function(e){var t=this;this.composedPath=function(){return t.source.composedPath()},this.initEvent=function(e,r,n){return t.source.initEvent(e,r,n)},this.preventDefault=function(){return t.source.preventDefault()},this.stopImmediatePropagation=function(){return t.source.stopImmediatePropagation()},this.stopPropagation=function(){return t.source.stopPropagation()};var r=e.source,n=e.type;this.source=r||new Event(n),Object.assign(this,e),this.bubbles=this.source.bubbles,this.cancelBubble=this.source.cancelBubble,this.cancelable=this.source.cancelable,this.composed=this.source.composed,this.currentTarget=this.source.currentTarget,this.defaultPrevented=this.source.defaultPrevented,this.eventPhase=this.source.eventPhase,this.isTrusted=this.source.isTrusted,this.target=this.source.target,this.timeStamp=this.source.timeStamp,this.type=this.source.type,this.returnValue=this.source.returnValue,this.srcElement=this.source.srcElement,this.AT_TARGET=this.source.AT_TARGET,this.BUBBLING_PHASE=this.source.BUBBLING_PHASE,this.CAPTURING_PHASE=this.source.CAPTURING_PHASE,this.NONE=this.source.NONE},q=function(){function e(e){this.scripts=[],this.styles=[],this.events={},this.name=e.name,this.path=e.path,Object.assign(this,e),this.data=S.transform(this.data||{})}return Object.defineProperty(e.prototype,"isReady",{get:function(){return!a(this.template)},enumerable:!1,configurable:!0}),e.prototype.export=function(e){var t=this;return u(e)?b(Object.keys(e),(function(r){v(t.data,e,r)})):n.log('Invalid object for component.export(...), only "Object Literal" is allowed.')},e.prototype.destroy=function(){if(!this.el)return!1;this.emit("beforeDestroy");var e=this.el.parentElement;e&&e.removeChild(this.el),this.emit("destroyed"),this.events={},b(this.styles,(function(e){return b([].slice.call(E.head.children),(function(t){t===e&&E.removeChild(e)}))}))},e.prototype.params=function(){new B(this.route||"")},e.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var o=this;e in o&&"function"==typeof o[e]&&o[e](new H({type:e,targert:this}));var i=this.events[e];return!!i&&(b(i,(function(n){return n.apply(void 0,r([new H({type:e})],t,!1))})),!0)},e.prototype.on=function(e,t){return this.events[e]||(this.events[e]=[]),this.events[e].push(t),{eventName:e,callback:t}},e.prototype.off=function(e,t){if(!this.events[e])return!1;var r=this.events[e].indexOf(t);return this.events[e].splice(r,1),!0},e}(),G=function(){function r(t,r){this.components={},this.requests={},e.Register(this),this.bouer=t,r&&this.prepare(r)}return r.prototype.check=function(e){return e in this.components},r.prototype.request=function(e,t){var r=this;if(!a(this.requests[e]))return this.requests[e].push(t);this.requests[e]=[t],o(x(A(T.baseURI).baseURI,e),{headers:{"Content-Type":"text/plain"}}).then((function(e){return e.text()})).then((function(t){b(r.requests[e],(function(r){r.success(t,e)}))})).catch((function(t){b(r.requests[e],(function(r){r.fail(t,e)}))})).finally((function(){delete r.requests[e]}))},r.prototype.prepare=function(t,r){var o=this;b(t,(function(t){var u;return a(t.name)&&(t.name=i(9,"component-").toLowerCase()),a(t.path)?n.warn("The component with name “"+t.name+"” and the route “"+t.route+"” has not “path” property defined, then it was ignored."):(Array.isArray(t.children)&&o.prepare(t.children,t),a(t.route)||(t.route="/"+x(a(r)?"":r.route,t.route)),a(o.components[t.name])?(e.Resolve("Routing").configure(o.components[t.name]=t),void((null===(u=(o.bouer.config||{}).preload)||void 0===u||u)&&o.request(t.path,{success:function(e){t.template=e},fail:function(){}}))):n.warn("The component name “"+t.name+"” is already define, try changing the name."))}))},r.prototype.order=function(e,t){var r=this,o=e.nodeName.toLowerCase(),i=this.components,a=i[o];if(!a)return n.error("No component with name “"+o+"” registered.");var u=a,s=V.obj(t,{$this:t});if(u.template){var c=new q(u);return c.bouer=this.bouer,this.insert(e,c,s),void(!0===c.keepAlive&&(i[o]=c))}"function"==typeof u.requested&&u.requested(new H({type:"requested"})),this.request(u.path,{success:function(t){u.template=t;var n=new q(u);n.bouer=r.bouer,r.insert(e,n,s),!0===n.keepAlive&&(i[o]=n)},fail:function(e){n.error(O(e)),"function"==typeof u.failed&&u.failed(new H({type:"failed"}))}})},r.prototype.insert=function(r,u,s){var c,l=r.nodeName.toLowerCase(),p=r.parentElement;if(r.isConnected&&p){if(!u.isReady)return n.error("The <"+l+"></"+l+"> component is not ready yet to be inserted.");(!1===(null!==(c=u.keepAlive)&&void 0!==c&&c)||a(u.el))&&g("body",(function(e){return e.innerHTML=u.template,b([].slice.apply(e.querySelectorAll("script")),(function(t){u.scripts.push(t),e.removeChild(t)})),b([].slice.apply(e.querySelectorAll('link[rel="stylesheet"]')),(function(t){u.styles.push(t),e.removeChild(t)})),b([].slice.apply(e.querySelectorAll("style")),(function(t){u.styles.push(t),e.removeChild(t)})),0===e.children.length?n.error("The component <"+l+"></"+l+"> seems to be empty or it has not a root element.eg.: <div></div>, to be included."):e.children.length>1?n.error("The component <"+l+"></"+l+"> seems to have multiple root element, it must have only one root."):(u.el=e.children[0],void u.emit("created"))}));var d=u.el;b([].slice.call(r.attributes),(function(t){if(r.removeAttribute(t.name),"class"===t.nodeName)return r.classList.forEach((function(e){d.classList.add(e)}));if("data"===t.nodeName){var n=e.Resolve("Evalutator").exec({data:s,expression:""!==f(t.value)?t.value:"this.data"});return b(Object.keys(n),(function(e){v(u.data,n,e)}))}d.attributes.setNamedItem(t)})),u.emit("beforeMount"),p.replaceChild(d,r);var h={};d.classList.forEach((function(e){return h[e]=!0}));var m=function(e,t){var r="STYLE"===e.nodeName,n=[];if(e.sheet){for(var o=e.sheet.cssRules,i=0;i<o.length;i++){var a=o.item(i);if(a){var u=a,s=u.selectorText.substr(1),c=h[s]?"":" ";u.selectorText="."+t+c+u.selectorText,r&&n.push(u.cssText)}}r&&(e.innerText=n.join("\n"))}};b(u.styles,(function(e){var t=e.cloneNode(!0),r=i(7,"bouer-s");if(t instanceof HTMLLinkElement&&t.hasAttribute("scoped")&&(t.onload=function(e){return m(e.target,r)}),E.head.appendChild(t),t.hasAttribute("scoped"))return d.classList.add(r),t instanceof HTMLStyleElement?m(t,r):void 0}));var y=function(r){try{e.Resolve("Evalutator").execRaw(r||"",u),u.emit("mounted"),u.emit("beforeLoad"),e.Resolve("HtmlHandler").compile({data:u.data,el:d,onDone:function(){return u.emit("loaded")}}),t.observe(p,(function(){d.isConnected||u.destroy()}))}catch(e){n.error("Error in <"+l+"></"+l+"> component."),n.error(O(e))}};if(0===u.scripts.length)return y();var w=[],N={},A=[],x=[];return b(u.scripts,(function(e){""==e.src||e.innerHTML?w.push(e.innerHTML):x.push(e.src)})),0==x.length?y(w.join("\n\n")):b(x,(function(e,t){N[e]=!0,o(e,{headers:{"Content-Type":"text/plain"}}).then((function(e){return e.text()})).then((function(r){if(delete N[e],A[t]=r,0===Object.keys(N).length)return y(V.array(A,w).join("\n\n"))})).catch((function(t){t.stack="",n.error('Error loading the <script src="'+e+'"><\/script> in <'+l+"></"+l+"> component, remove it in order to be compiled."),n.log(t),u.emit("failed")}))}))}},r.prototype.find=function(e){for(var t=Object.keys(this.components),r=0;r<t.length;r++){var n=this.components[t[r]];if(e(n))return n}return null},r}(),F=function(){function t(t){this.delimiters=[],e.Register(this),this.delimiters=t}return t.prototype.add=function(e){this.delimiters.push(e)},t.prototype.remove=function(e){var t=this.delimiters.findIndex((function(t){return t.name===e}));this.delimiters.splice(t,1)},t.prototype.run=function(e){var t=this;if(a(e)||""===f(e))return[];var r=null,n=function(e,n){for(var o=0;o<t.delimiters.length;o++){var i=t.delimiters[o],a=e.match(RegExp(i.delimiter.open+"([\\S\\s]*?)"+i.delimiter.close,n||""));if(a)return r=i,a}},o=n(e,"g");return o?o.map((function(e){var t=n(e);return{field:t[0],expression:f(t[1]),delimiter:r}})):[]},t}(),U=function(){function t(t){e.Register(this),this.bouer=t,this.global=this.createWindow()}return t.prototype.createWindow=function(){var e;return g("iframe",(function(t,r){t.style.display="none!important",r.body.appendChild(t),e=t.contentWindow,r.body.removeChild(t)})),delete e.name,e},t.prototype.execRaw=function(e,t){try{var r="return(function(){"+e+"; }).apply(this, arguments)";k.Function(r).apply(t||this.bouer)}catch(e){n.error(O(e))}},t.prototype.exec=function(e){var t=this,r=e.data,o=e.args,i=e.expression,a=e.isReturn,u=e.aditional,s=this.global,c={},l=V.obj(u||{});b(Object.keys(r),(function(e){v(l,r,e)})),b(Object.keys(this.bouer.globalData),(function(e){if(e in l)return n.warn('It was not possible to use the globalData property "'+e+'" because it already defined in the current scope.');v(l,t.bouer.globalData,e)}));var f,p=Object.keys(l);b(p,(function(e){delete s[e],e in s&&!0===m(s,e).configurable&&(c[e]=s[e]),e in c&&(s[e]=l[e]),v(s,l,e)}));try{var d='return(function(){"use strict"; '+(!1===a?"":"return")+" "+i+" }).apply(this, arguments)";f=this.global.Function(d).apply(this.bouer,o)}catch(e){n.error(O(e))}return b(p,(function(e){return delete s[e]})),f},t}(),J=function(){function t(t){this.events=[],this.bouer=t,this.evaluator=e.Resolve("Evaluator"),this.input=g("input").build(),e.Register(this)}return t.prototype.handle=function(e,t){var r,o=this,i=e.ownerElement||e.parentNode,u=e.nodeName;if(a(i))return n.error("Invalid ParentElement of “"+u+"”");var s=f(null!==(r=e.nodeValue)&&void 0!==r?r:""),c=u.substr(j.on.length).split("."),d=c[0];c.shift(),""===s&&n.error("Expected an expression in the “"+u+"” and got an <empty string>.");var h=function(e,r){var i=-1!==c.indexOf("once");b(c,(function(t){b(Object.keys(e),(function(r){var n;(n=e[r]&&l(n)&&p(r)===p(t))&&n()}))}));var a=new H({source:e,type:e.type}),u=V.array(a,r),f=o.evaluator.exec({data:V.obj(t,{event:a}),expression:s,args:u});if(l(f))try{f.apply(o.bouer,u)}catch(e){n.error(O(e))}return i};if("on"+d in this.input){var v=function(e){h(e,[])&&i.removeEventListener(d,v,!1)};i.addEventListener(d,v,!1)}else this.on(d,h)},t.prototype.on=function(e,t){var r={eventName:e,callback:function(e,r){return t(e,r)}};return this.events.push(r),r},t.prototype.off=function(e,t){var r=-1,n=this.events.find((function(n,o){if(n.eventName===e&&t==n.callback)return r=o,!0}));return n&&this.events.splice(r,1),n},t.prototype.emit=function(e){var t=this,r=e.eventName,n=e.arguments;b(this.events,(function(e){r===e.eventName&&e.callback.call(t.bouer,new H({type:r}),n||[])}))},t}(),W=function(){function t(t){this.defaultPage=null,this.notFoundPage=null,this.routeView=null,this.base=null,e.Register(this),this.bouer=t,this.routeView=this.bouer.el.querySelector("[route-view]")}return t.prototype.init=function(){var e=this;if(!a(this.routeView)){this.routeView.removeAttribute("route-view");var t=E.head.querySelector("base");if(!t)return n.error('No <base href="/"/> element was found in the Document>Head, consider to defined it in order to use “Routing” service.');var r=t.attributes.href;if(!r)return n.error('The href="/" attribute is required in base element.');this.base=r.value,this.navigate(E.location.href),k.addEventListener("popstate",(function(t){t.preventDefault(),e.navigate((t.state||{}).url||E.location.href)}))}},t.prototype.navigate=function(t){var r;if(a(t))return n.log("Invalid url provided to the navigation method.");var o=A(t=f(t));this.clear();var i=null===(r=(this.bouer.config||{}).usehash)||void 0===r||r,u=i?o.hash:o.pathname,s=this.toPage(u);if(s&&(s||!t.endsWith(".html"))){var c=function(e,t){var r=E.createElement(e);l(t)&&t(r,E);var n={appendTo:function(e){return e.appendChild(r),n},build:function(){return r}};return n}(s.name).appendTo(this.routeView).build();e.Resolve("ComponentHandler").order(c,{});var p=x(o.baseURI,i?"#":"",s.route);E.title=s.title||E.title,this.pushState(p,E.title)}},t.prototype.pushState=function(e,t){k.history.pushState({url:e},t||"",e)},t.prototype.popState=function(e){a(e)&&(e=-1),k.history.go(e)},t.prototype.toPage=function(t){return""===t||"/"===t||t==="/"+x((this.base,"index.html"))?this.defaultPage:e.Resolve("ComponentHandler").find((function(e){if(!e.route)return!1;var r=e.route.replace(/{(.*?)}/gi,"[\\S\\s]{1,}");return!!Array.isArray(new RegExp("^"+r+"$").exec(t))}))||this.notFoundPage},t.prototype.clear=function(){this.routeView.innerHTML=""},t.prototype.configure=function(e){return!0!==e.isDefault||a(this.defaultPage)?!0!==e.isNotFound||a(this.notFoundPage)?(!0===e.isDefault&&(this.defaultPage=e),void(!0===e.isNotFound&&(this.notFoundPage=e))):n.warn("There are multiple “NotFound Page” provided, check the “"+e.route+"” route."):n.warn("There are multiple “Default Page” provided, check the “"+e.route+"” route.")},t}();return function(){function r(e,r){if(this.name="Bouer",this.version="3.0.0",this.components=[],this.dependencies=[],r=r||{},Object.assign(this,r),delete this.components,a(e)||""===f(e))throw n.error("Invalid selector provided to the instance.");var o=this,i=E.querySelector(e);if(a(i))throw n.error("Element with selector “"+e+"” not found.");this.el=i,o.beforeMount(o.el,o),new U(this),new D(this),this.data=S.transform(r.data||{}),this.globalData=S.transform(r.globalData||{}),o.mounted(o.el,o);var u=new F([{name:"bouer",delimiter:{open:"-e-",close:"-"}},{name:"common",delimiter:{open:"{{",close:"}}"}},{name:"html",delimiter:{open:"{{:html ",close:"}}"}}]);new J(this),new I(this);var s=this.routing=new W(this);new G(this,r.components);var c=new M(this);new D(this),o.beforeLoad(o.el,o),c.compile({el:this.el,data:this.data,onDone:function(){return o.loaded(o.el,o)}}),t.observe(this.el,(function(e){var t=e.mutation;!1===e.element.isConnected&&(o.destroyed(o.el,o),t.disconnect())})),s.init(),this.delimiters={add:u.add,remove:u.remove,get:function(){return[].slice.call(u.delimiters)}},E.head.querySelector("link[rel~='icon']")||g("link",(function(e){e.rel="icon",e.type="image/png",e.href="https://afonsomatelias.github.io/assets/bouer/img/short.png"})).appendTo(E.head)}return r.prototype.toJsObj=function(t,r,n){return e.Resolve("HtmlHandler").toJsObj(t,r,n)},r.prototype.setData=function(e,t){return u(e)?null!==t&&u(t)?(t=this.data,S.transform(e),b(Object.keys(e),(function(r){return v(t,e,r)})),t):n.error('Invalid targetObject value, expected an "Object Literal" and got "'+typeof t+'".'):n.error('Invalid inputData value, expected an "Object Literal" and got "'+typeof e+'".')},r.prototype.beforeMount=function(e,t){},r.prototype.mounted=function(e,t){},r.prototype.beforeLoad=function(e,t){},r.prototype.loaded=function(e,t){},r.prototype.destroyed=function(e,t){},r}()}));
