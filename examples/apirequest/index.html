<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Api Request</title>
	<link rel="stylesheet" href="../shared.css">
</head>

<body>
	<div id="app">
		<div class="center">

			<ul>
				<li e-req:[users-data]="item of users?_start={{ start }}&_limit={{ limit }}"
						on:request="requested"
						on:response="responded"
						on:fail="failed"
						on:done="done"
						e-content="{{ item.name }}">
					Loading...
				</li>
			</ul>

		</div>
	</div>

	<script src="../../dist/bouer.js"></script>

	<script>
		var app = new Bouer('#app', {
			data: {
				// Props
				userId: 1,

				start: 0,
				limit: 5,

				// Methods
				requested: function (evt) {
					console.log(evt);
				},
				responded: function (evt) {
					console.log(evt);
				},
				failed: function (evt) {
					console.log(evt);
				},
				done: function (evt) {
					console.log(evt);
				},
			},
			middleware: (configure, app) => {

				configure('req', (bind, update) => {
					bind(context => {
						const path = context.detail.requestPath;

						return fetch("https://jsonplaceholder.typicode.com/" + path, {
							headers: { 'Content-Type': "application/json" }
						}).then(response => {
							if (!response.ok)
								throw new Error(response.s);
							return response.json()
						}).then(json => {
							return {
								data: json
							}
						}).catch(error => {
							return error
						});
					});
				});

			}
		});
	</script>
</body>

</html>